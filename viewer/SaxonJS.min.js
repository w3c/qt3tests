var global,SaxonJS=function(){function showValue(t){if(null==t)return"#null";if("undefined"==typeof t)return"#undefined";var e;if(t instanceof Expr.XdmArray){e="[";var r;for(r=0;r<t.value.length&&3>r;r++)0!=r&&(e+=","),e+=showValue(t.value[r]);return t.value.length>=4&&(e+=",...("+t.value.length+")"),e+="]"}if(t instanceof HashTrie)return e="{",t.forAllPairs(function(t){e+=showValue(t.k),e+=": ",e+=showValue(t.v),e+=", "}),e+="}";if("object"==typeof t&&"length"in t){e="(";var n;for(n=0;n<t.length&&3>n;n++)0!=n&&(e+=","),e+=showValue(t[n]);return t.length>=4&&(e+=",...("+t.length+")"),e+=")"}if(t instanceof Node){if(e={1:"element <"+t.tagName+">",2:"attribute @"+t.name,3:"text",7:"pi",8:"comment",9:"document "+(t._saxonDocumentNumber?"#"+t._saxonDocumentNumber:"(No nr / #0)"),11:"docFrag"}[t.nodeType],"9"==t.nodeType){var o;for(o=0;o<t.childNodes.length;o++)e+="~>"+showValue(t.childNodes[o])}return e}return t instanceof NamespaceNode?"ns:"+t.prefix+"="+t.uri:t.type?"string"===t.type?'"'+t.toString()+'"':"integer"===t.type||"boolean"===t.type?t.toString():"xs:"+t.type+"("+t.toString()+")":"??? "+t}function NamespaceNode(t,e,r){this.prefix=null==t?"":t,this.uri=null==e?"":e,r&&(this.parentNode=r)}function XError(t,e,r){return this instanceof XError?(this.name="XError",this.message=t||"Default Message",this.code=e||"FORG0001",r&&this.setExpr(r),void(this.stack=(new Error).stack)):new XError(t,e,r)}function JWLTrie(){HashTrie.call(this),this.source=null}function makeSpaceStripper(t){function e(t){switch(t.nodeType){case DomUtils.DOCUMENT_NODE:e(t.documentElement);break;case DomUtils.DOCUMENT_FRAGMENT_NODE:case DomUtils.ELEMENT_NODE:for(var n=DomUtils.nameOfNode(t),o=DomUtils.getInheritedAttribute(t,"xml:space"),i=r(n.uri,n.local)&&!(o&&"preserve"==o),a=t.childNodes,u=0;u<a.length;){var s=a[u];if(s.nodeType==DomUtils.CDATA_SECTION){var c=DomUtils.ownerDocument(t).createTextNode(s.nodeValue);t.replaceChild(c,s),s=c}s.nodeType==DomUtils.TEXT_NODE?i&&""==Regex.trim(s.nodeValue)?t.removeChild(s):u++:(e(s),u++)}}}var r=new Function("uri","local",t?t.getAttribute("test"):"return false");return function(t){return e(t),t}}function makeSpaceStripperLazy(t){var e=new Function("uri","local",t.getAttribute("test"));return function(t){for(var r,n=Axis.descendant(t).filter(function(t){var r,n;return t.nodeType==DomUtils.ELEMENT_NODE&&(r=DomUtils.nameOfNode(t),e(r.uri,r.local))&&(n=DomUtils.getInheritedAttribute(t,"xml:space"),!(n&&"preserve"==n))});null!=(r=n.next());){var o,i=r.childNodes;for(o=0;o<i.length;o++){var a=i[o];0!=o&&a.nodeType==DomUtils.TEXT_NODE&&""==Regex.trim(a.nodeValue)&&r.removeChild(a)}}return t}}function setPlatform(t){platform=t}function applyStylesheet(t,e,r){var n=Axis.child(t.documentElement).filter(function(t){return"stripJS"==t.tagName}).next();spaceStripper=makeSpaceStripper(n),e&&spaceStripper&&(e=spaceStripper(e));var o=initializeContext(t,e,r);if(e){DomUtils.obtainDocumentNumber(e);var i=e._saxonDocumentUri;o.fixed.documentPool[i]=e,e._saxonBaseUri=i}var a,u=r.initialTemplate;null!=u&&u.indexOf("Q{")<0&&(u="Q{}"+u);var s=r.initialMode;if(null==s?s="":""!=s&&"Q{"!=s.substring(0,2)&&(s="Q{}"+s),u){var c=o.fixed.namedTemplates[u];if(!c)throw XError("Unknown initial template "+u,"XTDE0040");o.fixed.globalContextItem?(o.focus=Iter.Tracker(Iter.Singleton(e)),o.focus.next()):o.focus=null,a=Expr.evalChild1(c,o)}else{var l=o.fixed.modes[s];if(!l)throw XError("Unknown initial mode "+s,"XTDE0045");if(!e)throw"No source document, initial template, or initial mode supplied";var f=Iter.Singleton(e);o.focus=Iter.Tracker(f),a=l.applyTemplates(o)}Expr.makeComplexContent(o.resultRoot,a);var m=Axis.child(o.resultRoot).next(),p=r.destination;if(p&&!/^(appendToBody|prependToBody|replaceBody|application)$/.test(p)&&print("Warning: supplied transformation option not recognised - destination: "+p),m)if(inBrowser){var h=window.document.body;if("appendToBody"==p)h.appendChild(m);else if("prependToBody"==p)h.insertBefore(m,h.firstChild);else if("replaceBody"==p){for(;h.childNodes.length>0;)h.removeChild(h.childNodes[0]);h.appendChild(m)}else r.principalResult=o.resultRoot}else r.principalResult=o.resultRoot;inBrowser&&registerEventListeners(o)}function transform(t,e){"function"==typeof platform.initialize&&platform.initialize(t),t.stylesheetParams||(t.stylesheetParams={});var r,n;if(inBrowser){if(void 0===t.stylesheetLocation)throw"No stylesheet supplied";platform.asyncGetMultipleXml([t.stylesheetLocation,t.sourceLocation],function(o){r=o[t.stylesheetLocation],n=o[t.sourceLocation],applyStylesheet(r,n,t),e&&e(t.principalResult)})}else{if(r=t.stylesheetNode,!r){var o=t.stylesheetText;if(!o){var i=t.stylesheetFileName;if(!i)throw"No stylesheet supplied";o=platform.readFile(i)}r=platform.parseXmlFromString(o)}if(n=t.sourceNode,!n){var a=t.sourceText;if(!a){var u=t.sourceFileName;u&&(a=platform.readFile(u))}a&&(n=platform.parseXmlFromString(a))}applyStylesheet(r,n,t)}}function registerEventListeners(t){function e(e,r){var n=function(r){var n=r.target,o=t.newContext(!0);o.currentEvent=r,o.focus=Iter.Tracker(Iter.Singleton(Expr.convertFromJS(n))),e.applyTemplates(o).expand()};"hashchange"!=r?window.document.addEventListener(r,n,!1):window.addEventListener(r,n,!1)}var r=t.fixed.modes;for(var n in r)if(r.hasOwnProperty(n)){var o=n.split("}");"Q{http://saxonica.com/ns/interactiveXSLT"==o[0]&&e(r[n],o[1].replace(/^on/,""))}}function initializeContext(t,e,r){function n(e,r){Axis.descendant(t).filter(function(t){return t.nodeType==DomUtils.ELEMENT_NODE&&t.tagName==e}).forEachItem(r)}function o(t){if(!t.hasAttribute("name"))return null;var e=t.getAttribute("name");return/^Q\{/.test(e)?e:"Q{}"+e}var i=new Context;return i.fixed={options:r,stylesheet:t,globalContextItem:e,globalVars:{},namedTemplates:{},modes:{},userFunctions:{},attributeSets:{},keys:{},decimalFormats:{},resultDocUris:{},_nextDocumentNumber:0,currentDate:{}},n("template",function(t){var e=o(t);null!=e&&(i.fixed.namedTemplates[e]=t)}),n("mode",function(t){var e=o(t);i.fixed.modes[null==e?"":e]=new Mode(t)}),n("globalVariable",function(t){var e=o(t);i.fixed.globalVars[e]={decl:t,value:null,isParam:!1}}),n("globalParam",function(t){var e=o(t);i.fixed.globalVars[e]={decl:t,value:null,isParam:!0}}),n("function",function(t){Expr.hasFlag(t,"m")&&Expr.notImplemented("memo function");var e=o(t),r=Axis.child(t).filter(function(t){return"arg"==t.tagName}).count();i.fixed.userFunctions[e+"#"+r]=Expr.argRole(t,"body"),i.fixed.userFunctions[e+"#-1"]=!0}),n("attributeSet",function(t){var e=o(t);i.fixed.attributeSets[e]=t}),n("key",function(t){var e=o(t);i.fixed.keys[e]=t}),n("decimalFormat",function(t){var e=o(t);i.fixed.decimalFormats[null==e?"Q{}":e]=t}),i.fixed.documentPool={},i.fixed._nextDocumentNumber=0,i.fixed.currentDate=new Date,i.focus=Iter.Tracker(Iter.Singleton(e)),i.focus.next(),i.resultDocument=platform.inBrowser?document.implementation.createDocument(null,"html",null):new Document,i.resultRoot=new DocumentFragment,i.localVars=[],i.localParams={},i.tunnelParams={},i}function cleanCopyContext(t){function e(e,r){Axis.descendant(t.fixed.stylesheet).filter(function(t){return t.nodeType==DomUtils.ELEMENT_NODE&&t.tagName==e}).forEachItem(r)}function r(t){if(!t.hasAttribute("name"))return null;var e=t.getAttribute("name");return/^Q\{/.test(e)?e:"Q{}"+e}var n=new Context;return n.fixed={stylesheet:t.fixed.stylesheet,globalContextItem:t.fixed.globalContextItem,globalVars:{},namedTemplates:t.fixed.namedTemplates,modes:t.fixed.modes,userFunctions:t.fixed.userFunctions,attributeSets:t.fixed.attributeSets,keys:t.fixed.keys,decimalFormats:t.fixed.decimalFormats,resultDocUris:{},_nextDocumentNumber:0,currentDate:t.fixed.currentDate,options:t.fixed.options},e("globalVariable",function(t){var e=r(t);n.fixed.globalVars[e]={decl:t,value:null,isParam:!1}}),e("globalParam",function(t){var e=r(t);n.fixed.globalVars[e]={decl:t,value:null,isParam:!0}}),n.fixed.documentPool=t.fixed.documentPool,n.focus=Iter.Tracker(Iter.Singleton(t.fixed.globalContextItem)),n.focus.next(),n.resultDocument=new Document,n.resultRoot=new DocumentFragment,n.localVars=[],n.localParams={},n.tunnelParams={},n}function Context(){}function getProcessorInfo(){return{version:3,vendor:"Saxonica",vendorURL:"http://www.saxonica.com/",productName:"Saxon-JS",productVersion:"0.9",isSchemaAware:!1,supportsSerialization:!1,supportsBackwardsCompatibility:!0,supportsNamespaceAxis:!0,supportsStreaming:!1,supportsDynamicEvaluation:!1,supportsHigherOrderFunctions:!1,xPathVersion:3.1,xsdVersion:1.1}}var platform={},BrowserPlatform=function(){"use strict";function t(){Math.trunc=Math.trunc||function(t){return 0>t?Math.ceil(t):Math.floor(t)},Array.prototype.findIndex||(Array.prototype.findIndex=function(t){var e;for(e=0;e<this.length;e++)if(t(this[e]))return e;return-1}),String.prototype.includes||(String.prototype.includes=function(t,e){return"number"!=typeof e&&(e=0),e+t.length>this.length?!1:-1!==this.indexOf(t,e)}),SaxonJS.U.Atomic._init(),window.print=function(t){console.log(t)}}var e={inBrowser:!0,asyncGet:function(t,e){var r=new XMLHttpRequest;r.open("GET",t,!0),r.onload=function(t){if(4===r.readyState){if(200!==r.status)throw XError(r.statusText);e(r.responseText)}},r.onerror=function(t){throw XError(r.statusText)},r.send(null)},asyncGetXml:function(t,r){e.asyncGet(t,function(n){var o=e.parseXmlFromString(n);o._saxonDocumentUri=t,r(t,o)})},asyncGetMultipleXml:function(t,r){var n,o=t.length,i={};for(n=0;n<t.length;n++)t[n]?e.asyncGetXml(t[n],function(t,e){i[t]=e,--o<=0&&r(i)}):o--},parseXmlFromString:function(t){if(t=t.replace(/\r\n|\r(?!\n)/,"\n"),/^.+<\?xml/i.test(t))throw SaxonJS.XError("Misplaced or malformed XML or text declaration","FODC0006");return(new DOMParser).parseFromString(t,"application/xml")},readResource:function(t){var r=new XMLHttpRequest,n=e.resolveUri(t,e.baseUri());if(r.open("GET",n,!1),r.send(null),200==r.status)var o=r.responseText;else alert("Failed to read resource at "+t);if("\ufeff"==o.charAt(0))throw SaxonJS.XError(o.substring(1),"FODC0002");return o},readFile:function(t,e){var r=new XMLHttpRequest;try{r.open("GET",t,!1),r.send(null)}catch(n){throw SaxonJS.XError("Get failure "+t,"FODC0006")}if(200!=r.status)throw SaxonJS.XError("Failed to read file at "+t,"FODC0006");var o=r.responseText;if("\ufeff"==o.charAt(0))throw SaxonJS.XError(o.substring(1),"FODC0002");if(o.indexOf("\x00")>=0)throw SaxonJS.XError("External file contains non-XML characters","FOUT1190");return o},resolveUri:function(t,e){var r,n=document,o=n.getElementsByTagName("base")[0],i=o&&o.href,a=n.head||n.getElementsByTagName("head")[0],u=o||a.appendChild(n.createElement("base")),s=n.createElement("a");return u.href=e||"",s.href=t,r=s.href,o?o.href=i:a.removeChild(u),r},baseUri:function(){var t=document.getElementsByTagName("script"),e=t.length-1,r=t[e];return r.src},initialize:function(e){t(),"function"!=typeof e.deliverMessage&&(e.deliverMessage=function(t){console.log("xsl:message: "+t)})}};return{platform:e}}(),Atomic=function(){function t(t,e){return t==e||1==D[t+"<"+e]}function e(t,e){throw new XError("Casting from xs:"+t.type+" to xs:"+e+" is not allowed","XPTY0004")}function r(t,e){throw new XError("Cannot compare xs:"+t+" with xs:"+e,"XPTY0004")}function n(t,e){if(t=Regex.trim(t),/\.$/.test(t)&&(t+="0"),/^(\-|\+)?([0-9]+(\.[0-9]*)?|\.[0-9]+)([Ee](\-|\+)?[0-9]+)?$/.test(t))return parseFloat(t);if(/^(\-|\+)?NaN$/.test(t))return NaN;if(/^\-INF$/.test(t))return-(1/0);if(/^(\+)?INF$/.test(t))return 1/0;if(e)throw new XError("Cannot convert string '"+t+"' to a number","FORG0001");return NaN}function o(t){return t.toString(36)}function i(t){var e,r,n,o,i,a,u,s,c=0,l=0,f=[];if(!t)return t;do e=t.charCodeAt(c++),r=t.charCodeAt(c++),n=t.charCodeAt(c++),s=e<<16|r<<8|n,o=s>>18&63,i=s>>12&63,a=s>>6&63,u=63&s,f[l++]=O.charAt(o)+O.charAt(i)+O.charAt(a)+O.charAt(u);while(c<t.length);var m=f.join(""),p=t.length%3;return(p?m.slice(0,p-3):m)+"===".slice(p||3)}function a(t){if(t=t.replace(/\s/g,""),!/^((([A-Za-z0-9+\/]){4})*(([A-Za-z0-9+\/]){3}[A-Za-z0-9+\/]|([A-Za-z0-9+\/]){2}[AEIMQUYcgkosw048]=|[A-Za-z0-9+\/][AQgw]==))?$/.test(t))throw XError("Invalid base64 input '"+t+"'","FORG0001");var e,r,n,o,i,a,u,s,c=0,l=0,f=[];if(0==t.length)return t;t+="";do o=O.indexOf(t.charAt(c++)),i=O.indexOf(t.charAt(c++)),a=O.indexOf(t.charAt(c++)),u=O.indexOf(t.charAt(c++)),s=o<<18|i<<12|a<<6|u,e=s>>16&255,r=s>>8&255,n=255&s,64==a?f[l++]=String.fromCharCode(e):64==u?f[l++]=String.fromCharCode(e,r):f[l++]=String.fromCharCode(e,r,n);while(c<t.length);return f.join("")}function u(t){var e="";return Expr.stringToCodepoints(t).forEach(function(t){e+=(t+256).toString(16).substring(1).toUpperCase()}),e}function s(t){if(t=Regex.trim(t),!/^([a-fA-F0-9][a-fA-F0-9])*$/.test(t))throw XError("Invalid xs:hexBinary string","FORG0001");var e,r=[];for(e=0;e<t.length;e+=2)r.push(String.fromCharCode(parseInt(t.substring(e,e+2),16)));return r.join("")}function c(t,e){e||(e="string"),this.value=t,this.type=e,"string"!=typeof t&&Expr.internalError("bad input to string constructor "+showValue(t))}function l(t,e){this.value=t,this.type=e}function f(t,e){"number"!=typeof t&&Expr.internalError("type of value supplied to XdmDouble is not number: "+typeof t),this.value=t,this.type=e||"double"}function m(t,e){if("number"!=typeof t)throw"type of value supplied to XdmInteger is not number: "+typeof t;this.value=t,e&&(this.type=e)}function p(t,e){this.value=new Big(t),e&&(this.type=e)}function h(t){if(this.value=t,"boolean"!=typeof t)throw"Not a boolean!"}function d(t,e,r){if(this.prefix=t?t:"",this.uri=e?e:"",this.local=r,""!=t&&!Regex.isNCName(t))throw new XError("Invalid prefix: '"+t+"'","FORG0001");if(!Regex.isNCName(r))throw new XError("Invalid local name: '"+r+"'","FORG0001")}function g(t,e,r){this.UTCdate=t,this.timezoneOffset=e,this.type=r}function v(t){return(100+t).toString().substring(1)}function x(t){return(1e4+t).toString().substring(1)}function y(t,e,r){if(this.months=t,this.milliseconds=e,t>0&&0>e||0>t&&e>0)throw new XError("Months/seconds must both be negative or both positive","FORG0001");this.type=r}function b(t){var r=_[t]={};r.name=t,r.matches=function(e){return e instanceof g&&e.type==t},r.fromString=function(e){return w(e,t)},r.fromDate=function(e,r){return new g(e,r,t)},r.cast=function(r){if(_[t].matches(r))return r;if(Atomic.dateTime.matches(r)||Atomic.date.matches(r)){var n=_[t];return n.fromString(n.fromDate(r.UTCdate,r.timezoneOffset).toString())}return Atomic.string.matches(r)||Atomic.untypedAtomic.matches(r)?_[t].fromString(r.toString()):void e(r,t)}}function E(t){if(-1!=t.indexOf(".",t.length-4)){for(var e=t.split("."),r=e[1];r.length<3;)r+="0";t=e[0]+"."+r}return t}function N(t){var e=t[0],r=t[1],n=t[2],o=t[3],i=t[4],a=t[5],u=e%4==0&&!(e%100==0&&e%400!=0);return!(1>r||r>12||1>n||n>[31,u?29:28,31,30,31,30,31,31,30,31,30,31][r-1]||o>=24||i>=60||a>=60)}function S(t,e){var r=t.split(/[\-T:]/).map(function(t){return parseFloat(t,10)});if(!N(r))throw new XError("Invalid date "+e,"FORG0001")}function w(t,e){var r=t.match(C[e]);if(null==r)throw new XError("Cannot convert string '"+t+"' to a "+e,"FORG0001");var n=r[2]?r[2]:"",o=U[e](r[1])+n;/24:00:00(\.0+)?$/.test(o)&&(o=Calculate["t+u"](w(o.substring(0,10),"date"),T("P1D","dayTimeDuration")).toString()+"T00:00:00"),S(o.substring(0,19),t);var i=new Date(o);if(""==n){var a=new Date;i=new Date(i.getTime()+60*a.getTimezoneOffset()*1e3)}return new g(i,A(r[2]),e)}function A(t){if(t){if("Z"==t)return 0;var e=t.split(":"),r=parseInt(e[0]),n=/^\-.*/.test(e[0]),o=Math.abs(r),i=parseInt(e[1]);if(o>14||i>59)throw XError("Invalid timezone "+t);return(n?-1:1)*(60*o+i)}return null}function T(t,e){var r=t.match(C[e]);if(null==r||!/\d/.test(t)||/T$/.test(t))throw new XError("Cannot convert string '"+t+"' to a "+e,"FORG0001");return new y(X[k[e][0]](r,t),X[k[e][1]](r,t),e)}function I(){function e(t){for(var e=_[t];e.base;)D[t+"<"+e.base.name]=1,e=e.base}function r(r,n,o){var i=_[r]={},a=_[n];i.name=r,i.base=a,i.matches=function(e){return t(e.type,r)},i.downCast=function(t){if(!o(t))throw new XError('Supplied value "'+t.toString()+'" is not a valid xs:'+r,"FORG0001");return t.type=r,t},i.fromString=function(t){return i.downCast(a.fromString(t))},i.cast=function(t){return i.downCast(a.cast(t))},e(r)}function n(t,e,n){function o(e){if(!n(e))throw new XError('Supplied value "'+e.toString()+'" is not a valid xs:'+t);return e.type=t,e}r(t,e,n);var i=_[t],a=_[e];i.fromNumber=function(t){return o(a.fromNumber(t))}}function o(t,e,n,o){r(t,e,n);var i=_[t],a=_[e];i.downCast=function(e){var r=o(e.toString());if(!n(r))throw new XError('Supplied value "'+r+'" is not a valid xs:'+t);return new c(r,t)},i.fromString=function(t){return i.downCast(a.fromString(o(t)))}}function i(t,e,n){r(t,e,n);var o=_[t],i=_[e];o.downCast=function(e){if(e instanceof y)return new y("yearMonthDuration"==t?e.months:0,"dayTimeDuration"==t?e.milliseconds:0,t);if(!n(e))throw new XError('Supplied value "'+e.toString()+'" is not a valid xs:'+t);return e.type=t,e},o.fromMonthsMilliseconds=function(t,e){return o.downCast(i.fromMonthsMilliseconds(t,e))},o.cast=function(e){return i.matches(e)?o.downCast(e):Atomic.string.matches(e)||Atomic.untypedAtomic.matches(e)?T(e.toString(),t):o.downCast(i.cast(e))}}Atomic["double"].NaN=Atomic["double"].fromNumber(NaN),n("nonPositiveInteger","integer",function(t){return t.toNumber()<=0}),n("negativeInteger","nonPositiveInteger",function(t){return t.toNumber()<0}),n("long","integer",function(t){var e=t.toBig();return e.cmp(Big("-9223372036854775808"))>=0&&e.cmp(Big("9223372036854775807"))<=0}),n("int","long",function(t){return t.toNumber()>=-2147483648&&t.toNumber()<=2147483647}),n("short","int",function(t){return t.toNumber()>=-32768&&t.toNumber()<=32767}),n("byte","short",function(t){return t.toNumber()>=-128&&t.toNumber()<=127}),n("nonNegativeInteger","integer",function(t){return t.toNumber()>=0}),n("positiveInteger","nonNegativeInteger",function(t){return t.toNumber()>0}),n("unsignedLong","nonNegativeInteger",function(t){return t.toNumber()>=0&&t.toBig().cmp(Big("18446744073709551615"))<=0}),n("unsignedInt","nonNegativeInteger",function(t){return t.toNumber()>=0&&t.toBig().cmp(Big("4294967295"))<=0}),n("unsignedShort","unsignedInt",function(t){return t.toNumber()>=0&&t.toNumber()<=65535}),n("unsignedByte","unsignedShort",function(t){return t.toNumber()>=0&&t.toNumber()<=255});var a=function(t){return t.replace(/[ \r\t\n]/g," ")},u=function(t){return t.replace(/[ \r\t\n]+/g," ").replace(/^[ ]|[ ]$/g,"")},s=function(){return!0};o("normalizedString","string",s,a),o("token","normalizedString",s,u),o("language","token",function(t){return/^[a-zA-Z]{1,8}(-[a-zA-Z0-9]{1,8})*$/.test(t)},u),o("NMTOKEN","token",Regex.isNMTOKEN,u),o("Name","token",Regex.isName,u),o("NCName","Name",Regex.isNCName,u),o("ID","NCName",Regex.isNCName,u),o("IDREF","NCName",Regex.isNCName,u),o("ENTITY","NCName",Regex.isNCName,u),i("yearMonthDuration","duration",function(t){return 0==t.milliseconds}),i("dayTimeDuration","duration",function(t){return 0==t.months}),_.dayTimeDuration.fromNumberOfMinutes=function(t){return new y(0,60*t*1e3,"dayTimeDuration")},_.showValue=showValue,_._init=function(){}}var D={"integer<decimal":1,"decimal<numeric":1,"double<numeric":1,"float<numeric":1,"integer<numeric":1,"dayTimeDuration<duration":1,"yearMonthDuration<duration":1,"dateTimeStamp<dateTime":1},O="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";c.prototype={value:null,type:"string",_hash:0,toString:function(){return this.value},toDouble:function(){return n(this.value,!0)},compareTo:function(t){return t instanceof c?this.value<t.value?-1:this.value==t.value?0:1:"untypedAtomic"==this.type?Atomic[t.type].cast(this).compareTo(t):void r(this.type,t.type)},equals:function(t){return 0==this.compareTo(t)},hashCode:function(){if(this.value.length<=4)return this.value;var t=this._hash,e=this.value.length;if(0==t&&e>0){var r;for(r=0;e>r;r++)t=31*t+this.value.charAt(r++);this._hash=t}return o(t)}},l.prototype={value:null,type:"hexBinary",toString:function(){return"hexBinary"==this.type?u(this.value):i(this.value)},compareTo:function(t){return t instanceof l?this.value<t.value?-1:this.value==t.value?0:1:void r(this.type,t.type)},equals:function(t){return 0==this.compareTo(t)},hashCode:function(){return new c(this.value).hashCode()}},f.prototype={value:0,type:"double",_hash:0,toString:function(){if(0==this.value)return 1/this.value<0?"-0":"0";if(this.value==Number.POSITIVE_INFINITY)return"INF";if(this.value==Number.NEGATIVE_INFINITY)return"-INF";var t=this.value,e=Math.abs(t);if(e>=1e6||1e-6>e){var r=t.toExponential(),n=r.indexOf("e"),o=r.substring(0,n);o.includes(".")||(o+=".0");var i=r.substring(n+1);return o+"E"+i.replace("+","")}return t.toString()},equals:function(t){return 0==this.compareTo(t)},compareTo:function(t){return"toNumber"in t?this.value<t.toNumber()?-1:this.value==t.toNumber()?0:1:void r(this.type,t.type)},hashCode:function(){return o(this.value)},toNumber:function(){return this.value},toDouble:function(){return this},abs:function(){return new f(Math.abs(this.value),this.type)},negate:function(){return new f(-this.value,this.type)},ceiling:function(){return new f(Math.ceil(this.value),this.type)},floor:function(){return new f(Math.floor(this.value),this.type)},round:function(t){var e;if(0==t)e=Math.round(this.value);else{var r=Math.pow(10,-t);e=Math.round(this.value/r)*r}return new f(e,this.type)},roundHalfToEven:function(t){return isNaN(this.value)||!isFinite(this.value)?this:Atomic[this.type].cast(new p(Big(this.value)).roundHalfToEven(t))}},m.prototype={value:0,type:"integer",_hash:0,toString:function(){return this.value.toString()},equals:function(t){return 0==this.compareTo(t)},compareTo:function(t){return"toNumber"in t?this.value-t.toNumber():void r(this.type,t.type)},hashCode:function(){return o(this.value)},toDouble:function(){return new f(this.value)},toNumber:function(){return this.value},toBig:function(){return new Big(this.value)},abs:function(){return new m(Math.abs(this.value))},negate:function(){return new m(-this.value)},ceiling:function(){return this},floor:function(){return this},round:function(t){if(0>t){var e=Math.pow(10,-t);return new m(Math.round(this.value/e)*e)}return this},roundHalfToEven:function(t){if(0>t){var e=Math.pow(10,-t);return new m(parseInt(Big(this.value).div(e).round(0,2).times(e)))}return this}},p.prototype={value:null,type:"decimal",_hash:0,toString:function(){return this.value.toFixed()},equals:function(t){return 0==this.compareTo(t)},compareTo:function(t){return t instanceof p?this.value.cmp(t.value):"toDouble"in t?this.value-t.toDouble().value:void r(this.type,t.type)},hashCode:function(){return o(this.toNumber())},toBig:function(){return this.value},toDouble:function(){return new f(parseFloat(this.value))},toNumber:function(){return parseFloat(this.value)},abs:function(){return new p(this.value.abs(),this.type)},negate:function(){var t=Big(this.value);return t.s=-t.s,new p(t,"decimal"==this.type?"decimal":"integer")},ceiling:function(){return new p(this.value.round(0,this.value.s<0?0:3),this.type)},floor:function(){return new p(this.value.round(0,this.value.s<0?3:0),this.type)},round:function(t){function e(t,e){var r=new Big(t);return r.e+=e,r}var r=this.value,n=0;0>t&&(n=t,t=0,r=e(r,n));var o=r.s>0?Big(0):this.floor().abs();return r=r.plus(o).round(t,1).minus(o),0!=e&&(r=e(r,-n)),new p(r,"decimal"==this.type?"decimal":"integer")},roundHalfToEven:function(t){var e;if(0>t){var r=Big(10).pow(-t);e=this.value.div(r).round(0,2).times(r)}else e=this.value.round(t,2);return new p(e,"decimal"==this.type?"decimal":"integer")}},h.prototype={value:null,type:"boolean",_hash:0,toString:function(){return this.value.toString()},toBoolean:function(){return this.value},compareTo:function(t){return t instanceof h?(this.value?1:0)-(t.value?1:0):void 0},equals:function(t){return t instanceof h&&this.value==t.value},hashCode:function(){return this.value.toString()}},d.prototype={prefix:null,uri:null,local:null,type:"QName",toEQName:function(){return"Q{"+this.uri+"}"+this.local},toString:function(){return(this.prefix.length>0?this.prefix+":":"")+this.local},equals:function(t){return t instanceof d&&this.local==t.local&&this.uri==t.uri},compareTo:function(){throw new XError("QNames are not ordered","FORG0006")},hashCode:function(){return this.uri.substring(this.uri.length-3)+":"+this.local.substring(0,3)}},g.prototype={type:"dateTime",_hash:0,UTCdate:null,timezoneOffset:0,proxy:function(){var t=new Date,e=null!=this.timezoneOffset?this.timezoneOffset:-t.getTimezoneOffset();return new Date(this.UTCdate.getTime()+60*e*1e3)},_ISOEdit:function(t){if(t=t.substr(0,t.length-1),0==this.UTCdate.getUTCMilliseconds())t=t.replace(".000","");else for(;"0"==t.charAt(t.length-1);)t=t.substr(0,t.length-1);return t},toString:function(){function t(t){switch(t){case"dateTime":case"dateTimeStamp":return e;case"date":return e.substring(0,10);case"time":return e.substring(11);case"gYearMonth":return e.substring(0,7);case"gYear":return e.substring(0,4);case"gMonthDay":return"-"+e.substring(4,10);case"gMonth":return"-"+e.substring(4,7);case"gDay":return"--"+e.substring(7,10);default:throw"type not recognised "+t}}var e=this._ISOEdit(this.proxy().toISOString());return t(this.type)+this.tzOffsetToString()},compareTo:function(t){return t instanceof g&&this.type==t.type?+this.UTCdate.getTime()-t.UTCdate.getTime():(print("Not implemented comparing "+this.type+" "+this.toString()+", "+t.type+" "+t.toString()),void r(this.type,t.type))},equals:function(t){return t instanceof g&&this.type==t.type&&this.UTCdate.getTime()==t.UTCdate.getTime()},hashCode:function(){return o(this.UTCdate.getTime()-1454346732296)},adjustByMinutes:function(t){return Atomic.dateTime.fromDate(new Date(this.UTCdate.getTime()+60*t*1e3),this.timezoneOffset)},addMonths:function(t){var e=this.toString(),r=parseInt(e.substring(0,4),10),n=parseInt(e.substring(5,7),10),o=parseInt(e.substring(8,10),10),i=r+Math.floor((n+t-1)/12);if(0>i)throw new XError("Dates with negative year not supported","FODT0001");var a=(n+t-1)%12+1;for(0>=a&&(a+=12);!N(i,a,o);)o-=1;return Atomic[this.type].fromString(x(i)+"-"+v(a)+"-"+v(o)+e.substring(10))},tzOffsetToString:function(){var t=this.timezoneOffset;if(null==t)return"";if(0==t)return"Z";var e=Math.abs(t);return(0>t?"-":"+")+v(Math.floor(e/60))+":"+v(e%60)}},y.prototype={type:"duration",_hash:0,months:0,milliseconds:0,parts:function(){var t=[],e=function(e,r){r.forEach(function(r){1e3!=r?(t.push(Math.floor(e/r)),e%=r):t.push(e/r)})};return e(Math.abs(this.months),[12,1]),e(Math.abs(this.milliseconds),[864e5,36e5,6e4,1e3]),t},signum:function(){var t=this.months+this.milliseconds;return 0>t?-1:t>0?1:0},toString:function(){var t,e=this.signum();return 0==e?t="yearMonthDuration"==this.type?"P0M":"PT0S":(t=0>e?"-P":"P",this.parts().forEach(function(e,r){3==r&&(t+="T"),0!=e&&(t+=6==r?e/1e3+"S":e+["Y","M","D","H","M","S"][r])}),t=t.replace(/T$/,"")),t},compareTo:function(t){if(Atomic.yearMonthDuration.matches(this)&&Atomic.yearMonthDuration.matches(t))return this.months-t.months;if(Atomic.dayTimeDuration.matches(this)&&Atomic.dayTimeDuration.matches(t))return this.milliseconds-t.milliseconds;throw new XError("Cannot compare durations that mix months and seconds","XPTY0004")},equals:function(t){return t instanceof y&&this.months==t.months&&this.milliseconds==t.milliseconds},hashCode:function(){return this.months.toString()+":"+this.milliseconds.toString()}};var _={isSubtype:t,untypedAtomic:{name:"untypedAtomic",fromString:function(t){return new c(t,"untypedAtomic")},matches:function(t){return"untypedAtomic"==t.type},cast:function(t){return new c(t.toString(),"untypedAtomic")}},string:{name:"string",fromString:function(t){return new c(t,"string")},matches:function(e){return t(e.type,"string")},cast:function(t){return new c(t.toString(),"string")}},anyURI:{name:"anyURI",fromString:function(t){return new c(t.replace(/[ \r\t\n]+/g," ").replace(/^[ ]|[ ]$/g,""),"anyURI")},fromURI:function(t){var e;return t instanceof URI?e=t.toString():(print("URI expected!!!"),e=t.toString()),new c(e,"anyURI")},matches:function(t){return"anyURI"==t.type},cast:function(t){return t instanceof c?Atomic.anyURI.fromString(t.toString()):void e(t,"anyURI")}},"double":{name:"double",fromString:function(t){return new f(n(t,!0))},fromStringUnfailing:function(t){return new f(n(t,!1))},fromNumber:function(t){return new f(t)},matches:function(t){return"double"==t.type},cast:function(t){return Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic["double"].fromString(t.toString()):Atomic.numeric.matches(t)?Atomic["double"].fromNumber(t.toNumber()):Atomic["boolean"].matches(t)?Atomic["double"].fromNumber(t.toBoolean()?1:0):"number"==typeof t?Atomic["double"].fromNumber(t):void e(t,"double")}},decimal:{name:"decimal",fromString:function(t){if(t=Regex.trim(t),/^(\+|-)?([0-9]+(\.[0-9]*)?|\.[0-9]+)$/.test(t))return new p(new Big(t));throw new XError("Invalid xs:decimal '"+t+"'","FORG0001")},fromBig:function(t){return new p(t)},fromNumber:function(t){if(isNaN(t)||!isFinite(t))throw new XError("xs:decimal cannot be NaN or infinite");return new p(new Big(t))},matches:function(t){return t instanceof p||t instanceof m},cast:function(t){return Atomic.decimal.matches(t)?new p(t.value,"decimal"):Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic.decimal.fromString(t.toString()):Atomic.numeric.matches(t)?Atomic.decimal.fromNumber(t.toNumber()):Atomic["boolean"].matches(t)?Atomic.decimal.fromString(t.toBoolean()?"1":"0"):void e(t,"decimal")}},"float":{name:"float",fromString:function(t){return new f(n(t,!0),"float")},fromNumber:function(t){return Math.fround&&(t=Math.fround(t)),new f(t,"float")},matches:function(t){return"float"==t.type},cast:function(t){return Atomic["float"].fromNumber(Atomic["double"].cast(t).toNumber())}},"boolean":{name:"boolean",fromString:function(t){switch(Regex.trim(t)){case"true":case"1":return new h(!0);case"false":case"0":return new h(!1);default:throw new XError("Cannot convert string '"+t+"' to xs:boolean","FORG0001")}},fromBoolean:function(t){return new h(t)},matches:function(t){return t instanceof h},cast:function(t){return Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic["boolean"].fromString(t.toString()):Atomic.numeric.matches(t)?Atomic["boolean"].fromBoolean(0!=t.toNumber()&&!isNaN(t.toNumber())):Atomic["boolean"].matches(t)?t:"boolean"==typeof t?Atomic["boolean"].fromBoolean(t):void e(t,"boolean")}},integer:{name:"integer",base:"decimal",matches:function(e){return t(e.type,"integer")},fromString:function(t){if(/^\s*(\-|\+)?[0-9]+\s*$/.test(t))return t.length>9?new p(t,"integer"):new m(parseInt(t,10));throw new XError("Cannot convert string '"+t+"' to an integer","FORG0001")},fromNumber:function(t){if(isNaN(t)||t==Number.NEGATIVE_INFINITY||t==Number.POSITIVE_INFINITY)throw new XError("Cannot convert NaN or INF to an integer","FORG0001");return new m(Math.trunc(t))},fromBig:function(t){return new p(t,"integer")},valid:function(t){return 0==t.value.mod(1)},cast:function(t){return Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic.integer.fromString(t.toString()):Atomic.numeric.matches(t)?Atomic.integer.fromNumber(t.toNumber()):Atomic["boolean"].matches(t)?Atomic.integer.fromNumber(t.toBoolean()?1:0):void e(t,"boolean")},convertFromJS:function(t){return"number"==typeof t?Atomic.integer.fromNumber(t):"boolean"==typeof t?Atomic.integer.fromNumber(t?1:0):"string"==typeof t?Atomic.integer.fromString(t):Atomic.integer.fromString(t.toString())}},numeric:{name:"numeric",members:["double","decimal","float"],matches:function(t){return t instanceof f||t instanceof m||t instanceof p},cast:function(t){return Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic["double"].fromString(t.toString()):Atomic.numeric.matches(t)?Atomic["double"].fromNumber(t.toNumber()):Atomic["boolean"].matches(t)?Atomic["double"].fromNumber(t.toBoolean()?1:0):void e(t,"numeric");
}},QName:{name:"QName",matches:function(t){return t instanceof d},fromParts:function(t,e,r){return new d(t,e,r)},fromString:function(t,e){if(t=Regex.trim(t),"Q{"==t.substring(0,2))return Atomic.QName.fromEQName(t);if(!Regex.isQName(t))throw XError("Invalid QName "+t,"FORG0001");var r=t.split(":");if(1==r.length)return Atomic.QName.fromParts("",e(""),r[0]);var n=e(r[0]);if(null==n)throw XError("Undeclared prefix: "+r[0],"FONS0004");return Atomic.QName.fromParts(r[0],n,r[1])},fromEQName:function(t){var e=t.indexOf("{"),r=t.indexOf("}");return new d("",t.substring(e+1,r),t.substring(r+1))},cast:function(t,r){if(Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)){if(r)return Atomic.QName.fromString(t.toString(),r);throw XError("Casting to QName requires a namespace resolver","FORG0001")}return Atomic.QName.matches(t)?t:void e(t,"QName")}},dateTime:{name:"dateTime",matches:function(t){return t instanceof g&&("dateTime"==t.type||"dateTimeStamp"==t.type)},fromString:function(t){return w(t,"dateTime")},fromDate:function(t,e){return new g(t,e,"dateTime")},cast:function(t){return Atomic.dateTime.matches(t)?t:Atomic.date.matches(t)?Atomic.dateTime.fromDate(t.UTCdate,t.timezoneOffset):Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic.dateTime.fromString(t.toString()):void e(t,"dateTime")}},date:{name:"date",matches:function(t){return t instanceof g&&"date"==t.type},fromString:function(t){return w(t,"date")},fromDate:function(t,e){var r=new g(t,e,"date"),n=Atomic.dateTime.fromString(r.toString().substring(0,10)+"T00:00:00"+r.toString().substring(10));return new g(n.UTCdate,e,"date")},cast:function(t){return Atomic.date.matches(t)?t:Atomic.dateTime.matches(t)?Atomic.date.fromDate(t.UTCdate,t.timezoneOffset):Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic.date.fromString(t.toString()):void e(t,"date")}},time:{name:"time",matches:function(t){return t instanceof g&&"time"==t.type},fromString:function(t){return w(t,"time")},fromDate:function(t,e){var r=new g(t,e,"time"),n=Atomic.dateTime.fromString("1972-01-01T"+r.toString());return new g(n.UTCdate,e,"time")},cast:function(t){return Atomic.time.matches(t)?t:Atomic.dateTime.matches(t)?Atomic.time.fromDate(t.UTCdate,t.timezoneOffset):Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic.time.fromString(t.toString()):void e(t,"time")}},dateTimeStamp:{name:"dateTimeStamp",matches:function(t){return t instanceof g&&"dateTimeStamp"==t.type},fromString:function(t){return w(t,"dateTimeStamp")},fromDate:function(t,e){return new g(t,e,"dateTimeStamp")},cast:function(t){return Atomic.time.matches(t)?t:Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic.dateTimeStamp.fromString(t.toString()):void e(t,"dateTimeStamp")}},duration:{name:"duration",matches:function(e){return t(e.type,"duration")},fromString:function(t){return T(t,"duration")},fromMonthsMilliseconds:function(t,e){return new y(t,e,"duration")},cast:function(t){return Atomic.duration.matches(t)?t:Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?Atomic.duration.fromString(t.toString()):void e(t,"duration")}},hexBinary:{name:"hexBinary",matches:function(t){return"hexBinary"===t.type},fromString:function(t){return new l(s(t),"hexBinary")},cast:function(t){return t instanceof l?new l(t.value,"hexBinary"):Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?new l(s(t.toString()),"hexBinary"):void e(t,"hexBinary")}},base64Binary:{name:"base64Binary",matches:function(t){return"base64Binary"===t.type},fromString:function(t){return new l(a(t),"base64Binary")},cast:function(t){return t instanceof l?new l(t.value,"base64Binary"):Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?new l(a(t.toString()),"base64Binary"):void e(t,"base64Binary")}}};b("gYearMonth"),b("gYear"),b("gMonthDay"),b("gMonth"),b("gDay");var C={dateTime:/^\s*([0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(?:\.[0-9]+)?)(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,date:/^\s*([0-9]{4}-[0-9]{2}-[0-9]{2})(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,time:/^\s*([0-9]{2}:[0-9]{2}:[0-9]{2}(?:\.[0-9]+)?)(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,dateTimeStamp:/^\s*([0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(?:\.[0-9]+)?)(Z|(\+|-)[0-9]{2}:[0-9]{2})\s*$/,gYearMonth:/^\s*([0-9]{4}-[0-9]{2})(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,gYear:/^\s*([0-9]{4})(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,gMonthDay:/^\s*--([0-9]{2}-[0-9]{2})(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,gMonth:/^\s*--([0-9]{2})(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,gDay:/^\s*---([0-9]{2})(Z|(\+|-)[0-9]{2}:[0-9]{2})?\s*$/,duration:/^\s*\-?P(?:([0-9]+)Y)?(?:([0-9]+)M)?(?:([0-9]+)D)?(?:T(?:([0-9]+)H)?(?:([0-9]+)M)?(?:([0-9]+(?:\.[0-9]*)?)S)?)?\s*$/,dayTimeDuration:/^\s*\-?P(?:([0-9]+)D)?(?:T(?:([0-9]+)H)?(?:([0-9]+)M)?(?:([0-9]+(?:\.[0-9]*)?)S)?)?\s*$/,yearMonthDuration:/^\s*\-?P(?:([0-9]+)Y)?(?:([0-9]+)M)?\s*$/},U={dateTime:function(t){return E(t)},date:function(t){return t+"T00:00:00"},time:function(t){return"1972-01-01T"+E(t)},dateTimeStamp:function(t){return E(t)},gYearMonth:function(t){return t+"-01T00:00:00"},gYear:function(t){return t+"-01-01T00:00:00"},gMonthDay:function(t){return"1972-"+t+"T00:00:00"},gMonth:function(t){return"1972-"+t+"-01T00:00:00"},gDay:function(t){return"1972-01-"+t+"T00:00:00"}},M=function(t,e){return e*(null==t?0:parseInt(t,10))},P=function(t,e){return e*(null==t?0:Math.round(1e3*parseFloat(t)))},F=function(t,e){return e?-t:t},X=[function(t,e){return F(M(t[1],12)+M(t[2],1),e.match(/^\s*\-.*/))},function(t,e){return F(M(t[3],864e5)+M(t[4],36e5)+M(t[5],6e4)+P(t[6],1),e.match(/^\s*\-.*/))},function(t,e){return F(M(t[1],864e5)+M(t[2],36e5)+M(t[3],6e4)+P(t[4],1),e.match(/^\s*\-.*/))},function(){return 0}],k={duration:[0,1],dayTimeDuration:[3,2],yearMonthDuration:[0,3]};return _._init=I,_}(),Compare=function(){"use strict";function t(t,e){return null==t?null==e:null==e?!1:t.equals(e)}function e(t,e,r,n){for(var o,i=Atomic.untypedAtomic.matches;null!=(o=t.next());)for(var a,u=Iter.ForArray(e);null!=(a=u.next());){var s=i(o)?Atomic[a.type].cast(o):o,c=i(a)?Atomic[o.type].cast(a):a;if(h(r,n.compare(s,c)))return Iter.oneBoolean(!0)}return Iter.oneBoolean(!1)}function r(t,r,n){var o=Expr,i=o.evalChild1(t,r),a=o.evalChild2(t,r).expand(),u=m(t.getAttribute("comp"));return n||(n=t.getAttribute("op")),e(i,a,n,u)}function n(t,e){return t.compareTo(e)}function o(t){return function(e,r){return null==e||null==r?null==e?null==r?0:-1:1:t(e,r)}}function i(t){return function(e,r){return g(e)||g(r)?g(e)?g(r)?0:-1:1:t(e,r)}}function a(t){var e=Atomic.untypedAtomic,r=Atomic.string;return function(o,i){return r.matches(o)||e.matches(i)?t(o,i):n(o,i)}}function u(t,e){for(var r=Expr,n=r.stringToCodepoints(t.toString()),o=r.stringToCodepoints(e.toString()),i=0;;){if(i==n.length)return i==o.length?0:-1;if(i==o.length)return 1;if(n[i]!=o[i])return n[i]-o[i];i++}}function s(t,e){var r=DomUtils,n=Iter.Tracker(Expr.evalChild1(t,e)),o=[],i=r.getChildElements(t,"sortKey"),a=i.map(function(t){return p(t,e)}),u=e.newContext(!1);u.tempOutputState="sort key",u.focus=n;var s=i.map(function(t){var r=Expr.argRole(t,"dataType"),n=null==r?null:Expr.evaluate(r,e).next();return"number"==n?function(t){return null==t?null:Atomic["double"].fromStringUnfailing(t.toString())}:"text"==n?function(t){return null==t?null:Atomic.string.cast(t)}:function(t){return t}});return n.forEachItem(function(t){var e=i.map(function(t,e){return s[e](Expr.evalChild1(t,u).next())});o.push({item:t,keys:e})}),o.sort(function(t,e){var r;for(r=0;r<a.length;r++){var n=a[r](t.keys[r],e.keys[r]);if(0!=n)return n}return 0}),Iter.ForArray(o).mapOneToOne(function(t){return t.item})}function c(t){return null==t?Atomic["double"].NaN:Atomic.numeric.matches(t)?t.toNumber():Atomic["double"].fromStringUnfailing(t.toString()).toNumber()}function l(t,e){var r=c(t),n=c(e);return g(r)?g(n)?0:-1:g(n)?1:r-n}function f(t,e){return function(r,n){var o=r.toString(),i=n.toString(),a=o.toLowerCase(),u=i.toLowerCase(),s=t(a,u);if(0==s){for(var c=0;c<o.length;c++)if(o.charAt(c)!=i.charAt(c))return e==(o.charAt(c)==o.charAt(c).toLowerCase())?-1:1;return 0}return s}}function m(e){var r=e.split("|");if("DESC"==r[0]){var a=m(e.slice(5));return{equals:a.equals,compare:function(t,e){return a.compare(e,t)}}}var u={};switch(r[0]){case"NC":return u.compare=l,u.equals=function(t,e){var r=c(t),n=c(e);return isNaN(r)?isNaN(n):isNaN(n)?!1:r-n==0},u;case"DblSC":return u.compare=i(function(t,e){return t.toNumber()-e.toNumber()}),u.equals=function(t,e){var r=t.toNumber(),n=e.toNumber();return isNaN(r)?isNaN(n):isNaN(n)?!1:r-n==0},u;case"CCC":case"TEXT":return u.compare=o(function(t,e){return t.value.toString()<e.value.toString()?-1:t.value.toString()==e.value.toString()?0:1}),u.equals=function(t,e){return null==t?null==e:null==e?!1:t.value.toString()==e.value.toString()},u;case"CAVC":case"DecSC":case"GAC":case"AtSC":case"CalVC":return{compare:o(i(n)),equals:t};case"EQC":return u.equals=t,u.compare=function(t,e){return u.equals(t,e)?0:1},u;default:throw"Unknown comparer "+e}}function p(t,e){function r(t){return"descending"==m?function(e,r){return t(r,e)}:t}var s=Expr,c=null;t.hasAttribute("comp")&&(c=t.getAttribute("comp"),c=c.replace(/^DESC\|/,""));var m=s.evaluateIfPresent(s.argRole(t,"order"),e).next(),p=s.evaluateIfPresent(s.argRole(t,"lang"),e).next(),h=s.evaluateIfPresent(s.argRole(t,"caseOrder"),e).next(),d=s.evaluateIfPresent(s.argRole(t,"dataType"),e).next();m=null==m?"ascending":m.toString();try{p=null==p||""==p?null:Atomic.language.fromString(p.toString())}catch(g){throw XError("xsl:sort/@lang: "+g.message,"XTDE0030")}h=null==h?"#default":h.toString(),d=null==d?null:d.toString();var v=u;if("#default"!=h&&(v=f(v,"lower-first"==h)),"number"==d)return r(l);if("text"==d){var x=function(t,e){return v(Atomic.string.cast(t),Atomic.string.cast(e))};return r(o(x))}if(c){if("DblSC"==c)return r(o(i(n)));if("CalVC"==c||"DecSC"==c)return r(o(n));if("CCC"==c)return r(o(v))}return r(a(v))}function h(t,e){switch(t){case"=":case"eq":return 0==e;case"<":case"lt":return 0>e;case">":case"gt":return e>0;case">=":case"ge":return e>=0;case"<=":case"le":return 0>=e;case"!=":case"ne":return 0!=e;default:throw"unknown operator "+t}}function d(t,e){switch(t){case"=":case"eq":return e;case"!=":case"ne":return!e;case"<":case"lt":case">":case"gt":case">=":case"ge":case"<=":case"le":throw"operator "+t+" not allowed for unordered types";default:throw"unknown operator "+t}}function g(t){return(Atomic["double"].matches(t)||Atomic["float"].matches(t))&&isNaN(t.toNumber())}function v(t,e){return g(t)&&g(e)}function x(t,e){var r=t.expand(),n=e.expand();t=Iter.ForArray(r),e=Iter.ForArray(n);for(var o,i;;){if(o=t.next(),i=e.next(),null==o)return null==i;if(null==i)return!1;if(!b(o,i))return!1}}function y(t,e){var r=DomUtils;return t==e||t==r.DOCUMENT_NODE&&e==r.DOCUMENT_FRAGMENT_NODE||e==r.DOCUMENT_NODE&&t==r.DOCUMENT_FRAGMENT_NODE}function b(t,e){var r=DomUtils;if(t===e)return!0;if(t instanceof Node){if(!(e instanceof Node&&y(t.nodeType,e.nodeType)))return!1;switch(t.nodeType){case r.DOCUMENT_NODE:case r.DOCUMENT_FRAGMENT_NODE:return x(Axis.child(t),Axis.child(e));case r.ELEMENT_NODE:if(!r.nameOfNode(t).equals(r.nameOfNode(e)))return!1;var n=Axis.attribute(t).expand();if(n.length!=Axis.attribute(e).count())return!1;var o;for(o=0;o<n.length;o++){var i=n[o],a=r.nameOfNode(i),u=a.uri?a.uri:null;if(!e.hasAttributeNS(u,a.local))return!1;if(e.getAttributeNS(u,a.local)!=i.value)return!1}return x(Axis.child(t),Axis.child(e));case r.ATTRIBUTE_NODE:return r.nameOfNode(t).equals(r.nameOfNode(e))&&t.value==e.value;case r.PROCESSING_INSTRUCTION_NODE:return t.target==e.target&&t.textContent==e.textContent;case r.TEXT_NODE:case r.COMMENT_NODE:return t.textContent==e.textContent;default:throw"Unknown node type "+t.nodeType}}else{if(t instanceof NamespaceNode)return e instanceof NamespaceNode&&t.prefix==e.prefix&&t.uri==e.uri;if(t instanceof Expr.XdmArray){if(!(e instanceof Expr.XdmArray&&e.value.length==t.value.length))return!1;for(var s=0;s<t.value.length;s++)if(!x(Iter.ForArray(t.value[s]),Iter.ForArray(e.value[s])))return!1;return!0}if(t instanceof HashTrie){if(!(e instanceof HashTrie))return!1;var c=t.keys(),l=e.keys();return c.length!=l.length?!1:Iter.ForArray(c).every(function(r){return e.containsKey(r)&&x(Iter.ForArray(t.get(r)),Iter.ForArray(e.get(r)))})}if(g(t)&&g(e))return!0;try{return t.equals(e)}catch(f){return!1}}}function E(t,e){for(var r=t.next(),n=e.next();;){if(null===r)return null===n?0:-1;if(null===n)return 1;if(!b(r,n))return g(r)?-1:r.compareTo(n);r=t.next(),n=e.next()}}function N(t,e){function r(t){var e=[];return n.forEachItem(function(r){t(e,r)}),e}var n=Iter.Tracker(Expr.evaluate(Expr.argRole(t,"select"),e)),o=e.newContext(!1);o.focus=n;var i={starting:function(){var e=makePattern(Expr.argRole(t,"match"));return r(function(t,r){1==n.position||e(r,o)?t.push({group:[r]}):t[t.length-1].group.push(r)})},ending:function(){var e=makePattern(Expr.argRole(t,"match")),i=!1;return r(function(t,r){1==n.position||i?t.push({group:[r]}):t[t.length-1].group.push(r),i=e(r,o)})},adjacent:function(){var e=Expr.argRole(t,"key"),i=null;return r(function(t,r){var a=Expr.evaluate(e,o).expand();1!=n.position&&x(Iter.ForArray(a),Iter.ForArray(i))?t[t.length-1].group.push(r):(t.push({group:[r],key:a}),i=a)})},by:function(){var e=Expr.argRole(t,"key"),n=new HashTrie;return r(function(t,r){var i=[];Expr.evaluate(e,o).forEachItem(function(e){if(n.containsKey(e)){var o=n.get(e);i.findIndex(function(t){return t==o})<0&&(t[o].group.push(r),i.push(o))}else o=t.length,t.push({group:[r],key:[e]}),n.inSituPut(e,o),i.push(o)})})},by_c:function(){var e=Expr.argRole(t,"key"),n=new HashTrie;return n.options={sameKey:function(t,e){return x(Iter.ForArray(t),Iter.ForArray(e))},hash:function(t){return t.map(function(t){return t.hashCode()}).join()}},r(function(t,r){var i=Expr.evaluate(e,o).expand();if(n.containsKey(i)){var a=n.get(i);t[a].group.push(r)}else a=t.length,t.push({group:[r],key:i}),n.inSituPut(i,a)})}};i.adjacent_c=i.adjacent;var a=t.getAttribute("algorithm")+(Expr.hasFlag(t,"c")?"_c":""),u=i[a](),s=DomUtils.getChildElements(t,"sortKey");if(s.length>0){var c=Iter.Tracker(Iter.ForArray(u)),l=e.newContext(!1);l.focus=c;var f=s.map(function(t){return p(t,e)});c.forEachItem(function(t,e){t.sortKeys=s.map(function(r){var n=l.focus;return n.current=t.group[0],n.position=e+1,n.currentGroup=t.group,n.currentGroupingKey=t.key,Expr.evalChild1(r,l).next()})}),u.sort(function(t,e){for(var r=0;r<f.length;r++){var n=f[r](t.sortKeys[r],e.sortKeys[r]);if(0>n)return-1;if(n>0)return 1}return 0})}var m=e.newContext(!1);m.focus=Iter.Tracker(Iter.ForArray(u));for(var h,d=Expr.argRole(t,"content"),g=[],v=0;null!=(h=m.focus.next());){var y=u[v++],b=m.focus;b.current=y.group[0],b.position=v,b.currentGroup=y.group,b.currentGroupingKey=y.key,g.push(Expr.evaluate(d,m))}return Iter.Join(g)}var S={"=":function(t,e){return t.equals(e)},"!=":function(t,e){return!t.equals(e)},"<":function(t,e){return e>t},">":function(t,e){return t>e},"<=":function(t,e){return e>=t},">=":function(t,e){return t>=e}};return S.eq=S["="],S.ne=S["!="],S.le=S["<="],S.ge=S[">="],S.lt=S["<"],S.gt=S[">"],{allocateCodedComparer:m,deepEqualItems:b,deepEqualSequences:x,gc:e,generalComparison:r,grouping:N,itemIsNaN:g,lexicographicCompare:E,bothItemsAreNaN:v,sortSequence:s,testComparison:h,testEquality:d}}(),NAMESPACE_NODE=13;NamespaceNode.prototype={prefix:null,uri:null,parentNode:null,nodeType:NAMESPACE_NODE};var DomUtils=function(){"use strict";var t=1;return{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION:4,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NAMESPACE_NODE:13,shallowCopy:function(t,e,r,n){if(DomUtils.isNode(t)){var o,i;switch(t.nodeType){case DomUtils.DOCUMENT_NODE:case DomUtils.DOCUMENT_FRAGMENT_NODE:o=new DocumentFragment;var a=e.newContext(!1);Expr.makeComplexContent(o,n(a),e);break;case DomUtils.ELEMENT_NODE:i=DomUtils.nameOfNode(t),o=e.createElement(i.uri,i.toString()),r.indexOf("c")>=0&&!(SaxonJS.getPlatform().inBrowser&&o instanceof HTMLElement)&&DomUtils.inScopeNamespaces(t).forEach(function(t){DomUtils.declareNS(o,t.prefix,t.uri)}),Expr.makeComplexContent(o,n(e),e);break;case DomUtils.ATTRIBUTE_NODE:i=DomUtils.nameOfNode(t),o=e.resultDocument.createAttributeNS(i.uri,i.toString()),o.value=t.value;break;case DomUtils.TEXT_NODE:o=e.resultDocument.createTextNode(t.textContent);break;case DomUtils.COMMENT_NODE:o=e.resultDocument.createComment(t.textContent);break;case DomUtils.PROCESSING_INSTRUCTION_NODE:o=e.resultDocument.createProcessingInstruction(t.target,t.textContent);break;case DomUtils.NAMESPACE_NODE:o=new NamespaceNode(t.prefix,t.uri);break;default:throw"unknown node type "+t.nodeType}return Iter.Singleton(o)}return Iter.Singleton(t)},copyItem:function(t,e,r){if(!DomUtils.isNode(t))return t;var n,o;switch(t.nodeType){case DomUtils.DOCUMENT_NODE:case DomUtils.DOCUMENT_FRAGMENT_NODE:return n=DomUtils.obtainDocumentNumber(new DocumentFragment),n._saxonBaseUri=t._saxonBaseUri,Expr.makeComplexContent(n,Axis.child(t).mapOneToOne(function(t){return DomUtils.copyItem(t,e,r)}),e),n;case DomUtils.NAMESPACE_NODE:return new NamespaceNode(t.prefix,t.uri);case DomUtils.ELEMENT_NODE:return o=DomUtils.shallowCopy(t,e,r,function(e){var n=[];return n[0]=Axis.attribute(t),n[1]=Axis.child(t),Iter.Join(n).mapOneToOne(function(t){return DomUtils.copyItem(t,e,r)})}).next();case DomUtils.DOCUMENT_TYPE_NODE:return null;default:return SaxonJS.getPlatform().inBrowser?window.document.importNode(t,!0):cloneNode(e.resultDocument,t,!0)}},ownerDocument:function(t){return Axis.ancestorOrSelf(t).expand().pop()},obtainDocumentNumber:function(e){return"_saxonDocumentNumber"in e||(e._saxonDocumentNumber=t++),e},documentNumber:function(t){return DomUtils.obtainDocumentNumber(t)._saxonDocumentNumber},nameOfNode:function(t){if(!t||!t.nodeType)return null;var e;switch(t.nodeType){case DomUtils.ELEMENT_NODE:return SaxonJS.getPlatform().inBrowser&&t instanceof HTMLElement&&"http://www.w3.org/1999/xhtml"==t.namespaceURI?Atomic.QName.fromParts("","",t.localName):Atomic.QName.fromParts(t.prefix,t.namespaceURI,t.localName);case DomUtils.ATTRIBUTE_NODE:return e=t.name.indexOf(":"),e>=0&&(t.prefix||(t.prefix=t.name.substring(0,e)),t.namespaceURI||(t.namespaceURI="xml"==t.prefix?"http://www.w3.org/XML/1998/namespace":t.lookupNamespaceURI(t.prefix))),Atomic.QName.fromParts(t.prefix,t.namespaceURI,t.localName);case DomUtils.PROCESSING_INSTRUCTION_NODE:return Atomic.QName.fromParts("","",t.target);case NAMESPACE_NODE:return t.prefix?Atomic.QName.fromParts("","",t.prefix):null;default:return null}},hasLocalName:function(t,e){if("undefined"!=typeof HTMLElement){if(t instanceof HTMLElement)return t.localName.toUpperCase()===e.toUpperCase();if(t.nodeType==DomUtils.ATTRIBUTE_NODE&&t.ownerElement instanceof HTMLElement)return t.localName.toUpperCase()===e.toUpperCase()}if(t instanceof Attr){var r=t.name.indexOf(":");return 0>r?t.name==e:t.name.substring(r+1)==e}return t.localName===e},hasNamespace:function(t,e){return e==(t instanceof Attr?DomUtils.nameOfNode(t).uri:t.namespaceURI||"")},getChildElements:function(t,e){for(var r=[],n=t.firstChild;null!=n;)n.nodeType!=Node.ELEMENT_NODE||e&&e!=n.tagName||r.push(n),n=n.nextSibling;return r},inDocumentOrder:function(t){var e=t.expand();return e.sort(DomUtils.compareDocumentOrder),Iter.ForArray(e).mapOneToOne(function(t,r){return r>0&&t===e[r-1]?null:t})},compareDocumentOrder:function(t,e){function r(t){return Axis.ancestor(t).count()}if(DomUtils.isSameNode(t,e))return 0;var n=DomUtils.xdmParentNode(t),o=DomUtils.xdmParentNode(e);if(null==n){if(null==o){var i=DomUtils.obtainDocumentNumber;return i(t)._saxonDocumentNumber<i(e)._saxonDocumentNumber?-1:1}return t===o?-1:DomUtils.compareDocumentOrder(t,o)}if(null==o)return e===n?1:DomUtils.compareDocumentOrder(n,e);if(n!==o){if(t===o)return-1;if(e===n)return 1;var a=r(n),u=r(o);return a==u?DomUtils.compareDocumentOrder(n,o):a>u?DomUtils.compareDocumentOrder(n,e):DomUtils.compareDocumentOrder(t,o)}var s=t.nodeType,c=e.nodeType;if(s==DomUtils.ATTRIBUTE_NODE){if(c==DomUtils.ATTRIBUTE_NODE){var l,f=n.attributes;for(l=0;l<f.length;l++){var m=f[l].name;if(m.indexOf(":")<0){if(m==t.localName)return-1;if(m==e.localName)return 1}else{if(m=DomUtils.nameOfNode(f[l]),m.equals(DomUtils.nameOfNode(t)))return-1;if(m.equals(DomUtils.nameOfNode(e)))return 1}}throw"Att not found in parent"}return c==DomUtils.NAMESPACE_NODE?1:-1}if(c==DomUtils.ATTRIBUTE_NODE)return 1;if(s==DomUtils.NAMESPACE_NODE)return c==DomUtils.NAMESPACE_NODE?t.prefix<e.prefix?-1:1:-1;for(var p=t,h=e;;){if(p=p.previousSibling,null==p)return-1;if(p===e)return 1;if(h=h.previousSibling,null==h)return 1;if(h===t)return-1}},xdmParentNode:function(t){switch(t.nodeType){case DomUtils.ATTRIBUTE_NODE:return t.ownerElement;default:return t.parentNode}},declareNS:function(t,e,r){t.setAttributeNS("http://www.w3.org/2000/xmlns/",""===e?"xmlns":"xmlns:"+e,r)},inScopeNamespaces:function(t){for(var e,r=[{prefix:"xml",uri:"http://www.w3.org/XML/1998/namespace"}],n={xml:!0},o=Axis.ancestorOrSelf(t);null!=(e=o.next())&&e.nodeType==DomUtils.ELEMENT_NODE;){var i,a=e.attributes;for(i=0;i<a.length;i++){var u=a[i].name;if("xmlns"==u.substring(0,5))if(5!=u.length||n[""]){if(":"==u.charAt(5)){var s=u.substring(6);n[s]||(n[s]=!0,r.push({prefix:s,uri:a[i].value}))}}else n[""]=!0,""!=a[i].value&&r.push({prefix:"",uri:a[i].value})}}return r},getInheritedAttribute:function(t,e){for(var r=t;r&&r.nodeType==DomUtils.ELEMENT_NODE;){if(r.hasAttribute(e))return r.getAttribute(e);r=r.parentNode}return null},getAttribute:function(t,e,r){return t.hasAttribute(e)?t.getAttribute(e):arguments.length>2?r:null},getAttributeAsEQName:function(t,e,r){var n=DomUtils.getAttributeAsQName(t,e,r);return null==n?null:"Q{"+n.uri+"}"+n.local},getAttributeAsQName:function(t,e,r){return t.hasAttribute(e)?DomUtils.resolveLexicalQName(t,t.getAttribute(e),r):null},resolveLexicalQName:function(t,e,r){var n=Atomic.QName;if(/^Q\{/.test(e))return n.fromEQName(e);if(/:/.test(e)){var o=function(e){return"xml"==e?"http://www.w3.org/XML/1998/namespace":t.lookupNamespaceURI(e)};return n.fromString(e,o)}var i=r?t.lookupNamespaceURI(null)||"":"";return n.fromParts("",i,e)},isNode:function(t){return t instanceof Node&&!(t.nodeType==DomUtils.PROCESSING_INSTRUCTION_NODE&&"xml"==t.target)||t instanceof Attr||t instanceof NamespaceNode},isSameNode:function(t,e){return t===e||t instanceof NamespaceNode&&e instanceof NamespaceNode&&t.parentNode&&e.parentNode&&t.parentNode==e.parentNode&&t.prefix==e.prefix},baseURI:function(t){function e(t){var e=DomUtils.xdmParentNode(t);return e?DomUtils.baseURI(e):t._saxonBaseUri}if(null==t||t instanceof NamespaceNode)return null;if(t.nodeType==DomUtils.ELEMENT_NODE&&t.hasAttribute("xml:base")){var r=t.getAttribute("xml:base");return new URI(r).is("absolute")?r:new URI(r,e(t)).toString()}return e(t)},xmlToString:function(t,e,r,n){var e="undefined"!=typeof e?e:"",o=new Set;"undefined"!=typeof r&&r.forEach(function(t){o.add(t)});var i,a,u,s,c="undefined"!=typeof n?n:"",l="",f=!1,m=!1,p=!1;switch(t.nodeType){case DomUtils.DOCUMENT_NODE:u=t.documentElement,null!=u&&(l=DomUtils.xmlToString(u));break;case DomUtils.DOCUMENT_FRAGMENT_NODE:for(a=t.childNodes,s=0;s<a.length;++s)u=a[s],l+="\n"+DomUtils.xmlToString(u,e);break;case DomUtils.ELEMENT_NODE:i=DomUtils.nameOfNode(t),l+=("none"==e?"":e)+"<"+i;var h=t.namespaceURI;h!=c&&(null!=h&&""!=h&&(l+=' xmlns="'+h+'"'),c=h);var d=t.attributes;for(s=0;s<d.length;++s){var g=d[s],v=DomUtils.nameOfNode(g).toString();v.match(/^xmlns:xml/)||(v.match(/^xmlns/)?o.has(v)||(o.add(v),("xmlns"!=v||null!=c&&""!=c)&&(l+=" "+DomUtils.xmlToString(g,0))):l+=" "+DomUtils.xmlToString(g,0))}if(a=t.childNodes,0==a.length)l+="/>";else{for(l+=">",s=0;s<a.length;++s)u=a[s],f=u.nodeType==DomUtils.TEXT_NODE,p="none"==e||f||m,l+=p?"":"\n",l+=DomUtils.xmlToString(u,p?"none":e+"    ",o,c),m=f;p||(l+="\n"+e),l+="</"+i+">"}break;case DomUtils.ATTRIBUTE_NODE:i=DomUtils.nameOfNode(t),l+=i+'="'+t.value+'"';break;case DomUtils.TEXT_NODE:l=t.nodeValue;break;case DomUtils.COMMENT_NODE:l+="<!--"+t.value+"-->";break;case DomUtils.PROCESSING_INSTRUCTION_NODE:break;case DomUtils.NAMESPACE_NODE:break;case DomUtils.CDATA_SECTION:return t.data;default:throw"unknown node type "+t.nodeType}return l}}}(),HashTrie=function(){function t(e,r){if(""==r)return e.leafKVPs;var n=r.charAt(0);return e.subTries.hasOwnProperty(n)?t(e.subTries[n],r.substring(1)):[]}function e(e,r){for(var n=t(e,e.options.hash(r)),o=0;o<n.length;o++)if(e.options.sameKey(n[o].k,r))return n[o];return null}function r(t,e,n,o){if(""==o){for(var u=0;u<t.leafKVPs.length;u++)if(t.options.sameKey(t.leafKVPs[u].k,e))return void(t.leafKVPs[u]={k:e,v:n});t.leafKVPs.push({k:e,v:n})}else{var s,c=o.charAt(0);t.subTries.hasOwnProperty(c)?s=t.subTries[c]:(s=new i(t.options),s.id=a++,t.subTries[c]=s),r(s,e,n,o.substring(1))}}function n(t,e,r,o){var a=new i(t.options),u=!1;if(""==o)return a.leafKVPs=t.leafKVPs.map(function(n){return t.options.sameKey(n.k,e)?(u=!0,{k:e,v:r}):n}),u||a.leafKVPs.push({k:e,v:r}),a.subTries=this.subTries,a;var s=o.charAt(0);for(var c in t.subTries)t.subTries.hasOwnProperty(c)&&(c==s?(a.subTries[c]=n(t.subTries[c],e,r,o.substring(1)),u=!0):a.subTries[c]=t.subTries[c]);if(!u){var l=new i(t.options);l=n(l,e,r,o.substring(1)),a.subTries[s]=l}return a.leafKVPs=t.leafKVPs,a}function o(t,e,r){var n=new i(t.options);if(""==r)return n.leafKVPs=t.leafKVPs.filter(function(r){return!t.options.sameKey(r.k,e)}),n.subTries=this.subTries,n;var a=r.charAt(0);for(hc in t.subTries)t.subTries.hasOwnProperty(hc)&&(hc==a?n.subTries[hc]=o(t.subTries[hc],e,r.substring(1)):n.subTries[hc]=t.subTries[hc]);return n.leafKVPs=t.leafKVPs,n}function i(t){this.leafKVPs=[],this.subTries={},t?this.options=t:this.options={hash:u.hash,sameKey:u.sameKey}}var a=0,u={hash:function(t){return t.hashCode()},sameKey:function(t,e){function r(t){return"timezoneOffset"in t&&null!=t.timezoneOffset}try{return(t.equals(e)||Compare.itemIsNaN(t)&&Compare.itemIsNaN(e))&&r(t)==r(e)}catch(n){return print(n),!1}}};return i.prototype={leafKVPs:[],subTries:{},options:u,containsKey:function(t){return null!=e(this,t)},get:function(t){var r=e(this,t);return null==r?[]:r.v},inSituPut:function(t,e){r(this,t,e,this.options.hash(t))},put:function(t,e){return n(this,t,e,this.options.hash(t))},remove:function(t){return o(this,t,this.options.hash(t))},forAllPairs:function(t){this.leafKVPs.forEach(t);for(var e in this.subTries)this.subTries.hasOwnProperty(e)&&this.subTries[e].forAllPairs(t)},display:function(){function t(e,r){r>0&&print("Subtrie "+r),e.leafKVPs.forEach(function(t){print(showValue(t.k)+": "+showValue(t.v))});for(var n in e.subTries)e.subTries.hasOwnProperty(n)&&t(e.subTries[n],r+1)}print("HashTrie:"),t(this,0)},keys:function(){var t=[];return this.forAllPairs(function(e){t.push(e.k)}),t},conforms:function(t,e,r){var n=this;return Iter.ForArray(n.keys()).every(function(o){var i=n.get(o);return t(o)&&r(i.length)&&Iter.ForArray(i).every(e)})}},i}(),Axis=function(){"use strict";var t=DomUtils,e={ancestor:function(e){var r;switch(e.nodeType){case t.DOCUMENT_NODE:case t.DOCUMENT_FRAGMENT_NODE:return Iter.Empty;case t.ATTRIBUTE_NODE:return e.ownerElement?Iter.Stepping(e.ownerElement,function(t){return t.parentNode}):Iter.Empty;default:return r=e.parentNode,r?Iter.Stepping(r,function(t){return t.parentNode}):Iter.Empty}},ancestorOrSelf:function(t){return Iter.Join([Iter.Singleton(t),Axis.ancestor(t)])},attribute:function(e){if(e.nodeType==t.ELEMENT_NODE){var r,n,o=e.attributes,i=[];for(r=0;r<o.length;r++)n=o[r].name,("xmlns"!=n.substring(0,5)||5!=n.length&&":"!=n.charAt(5))&&(i.push(o[r]),o[r].ownerElement||(o[r].ownerElement=e));return Iter.ForArray(i)}return Iter.Empty},child:function(e){function r(t){return Iter.Stepping(t.firstChild,function(t){return t.nextSibling})}switch(e.nodeType){case t.DOCUMENT_NODE:return r(e).filter(function(e){return!(e.nodeType==t.PROCESSING_INSTRUCTION_NODE&&"xml"==e.target)});case t.DOCUMENT_FRAGMENT_NODE:case t.ELEMENT_NODE:return r(e);default:return Iter.Empty}},descendant:function(t){return Axis.child(t).mapOneToMany(function(t){return Axis.descendantOrSelf(t)})},descendantOrSelf:function(t){return Iter.Join([Iter.Singleton(t),Axis.descendant(t)])},following:function(e){switch(e.nodeType){case t.DOCUMENT_NODE:case t.DOCUMENT_FRAGMENT_NODE:return Iter.Empty;case t.ATTRIBUTE_NODE:case t.NAMESPACE_NODE:var r=DomUtils.xdmParentNode(e);return null==r?Iter.Empty:Iter.Join([Axis.descendant(r),Axis.following(r)]);default:return Axis.ancestorOrSelf(e).mapOneToMany(function(t){return Axis.followingSibling(t).mapOneToMany(Axis.descendantOrSelf)})}},followingSibling:function(e){switch(e.nodeType){case t.DOCUMENT_NODE:case t.DOCUMENT_FRAGMENT_NODE:case t.ATTRIBUTE_NODE:case t.NAMESPACE_NODE:return Iter.Empty;default:return Iter.Stepping(e.nextSibling,function(t){return t.nextSibling})}},namespace:function(e){return e.nodeType==t.ELEMENT_NODE?Iter.ForArray(t.inScopeNamespaces(e).map(function(t){return new NamespaceNode(t.prefix,t.uri,e)})):Iter.Empty},parent:function(e){return Iter.Singleton(t.xdmParentNode(e))},preceding:function(t){return Axis.ancestorOrSelf(t).mapOneToMany(function(t){return Axis.precedingSibling(t).mapOneToMany(function(t){return Iter.ForArray(Axis.descendantOrSelf(t).expand().reverse())})})},precedingSibling:function(e){switch(e.nodeType){case t.DOCUMENT_NODE:case t.DOCUMENT_FRAGMENT_NODE:case t.ATTRIBUTE_NODE:case t.NAMESPACE_NODE:return Iter.Empty;default:return Iter.Stepping(e.previousSibling,function(t){return t.previousSibling})}},self:function(t){return Iter.Singleton(t)}};return e["ancestor-or-self"]=e.ancestorOrSelf,e["descendant-or-self"]=e.descendantOrSelf,e["following-sibling"]=e.followingSibling,e["preceding-sibling"]=e.precedingSibling,e}();XError.prototype=Object.create(Error.prototype),XError.prototype.constructor=XError,XError.prototype.code=null,XError.prototype.xsltLineNr=null,XError.prototype.xsltModule=null,XError.prototype.compiledLineNr=null,XError.prototype.isGlobal=!1,XError.prototype.setExpr=function(t){this.xsltLineNr=DomUtils.getInheritedAttribute(t,"line"),this.xsltModule=DomUtils.getInheritedAttribute(t,"module"),this.compiledLineNr=t.lineNumber,null!=this.xsltLineNr&&(this.message+=" at "+this.xsltModule+"#"+this.xsltLineNr)},XError.test=function(t){if(t)throw XError.call(this,arguments[1],arguments[2],arguments[3])};var Expr=function(){function t(t){var e=t.split("|"),r=e[0],n=e[1],o=""==e[2]?"XPTY0004":e[2],i=e[3],a=function(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}},u=function(){switch(parseInt(r)){case 0:return a(+n+1)+" argument of "+(""==i?"anonymous function":i+"()");case 1:return a(+n+1)+" operand of '"+i+"'";case 9:return"operand of '-'";case 2:return"value in '"+i+"' expression";case 3:return"saxon:context-item"==i?"context item":"value of variable $"+i;case 4:var t=i.split("/");return"@"+t[1]+" attribute of "+("LRE"==t[0]?"a literal result element":t[0]);case 5:return"result of call to "+(""==i?"anonymous function":"function "+i);case 7:return"result of template "+i;case 6:return a(+n+1)+" sort key";case 8:return"value of parameter $"+i;case 11:return"value of the grouping key";case 13:return"the context item";case 14:return"the context item for the "+AxisInfo.axisName[n]+" axis";case 15:return"the value of the "+i+" option";case 17:return"document-order sorter";default:return""}};return{required:u(),code:o}}function e(t,e,r,n){var o=Regex.prepareRegex(e,r+"g",t);if(!n&&o.test(""))throw new XError("Regular expression matches zero-length string","FORX0003");for(var i,a=[],u=0,s=0;null!=(i=o.exec(t));)if(i.index>u&&a.push({matching:!1,string:Atomic.string.fromString(t.substring(u,i.index))}),a.push({matching:!0,groups:i,string:Atomic.string.fromString(i[0])}),u=o.lastIndex,s++>1e3)throw XError("looping???");return t.length>u&&a.push({matching:!1,string:Atomic.string.fromString(t.substring(u,t.length))
}),a}function r(t){if(Q.isNode(t))return Iter.Singleton(n(t));if(t instanceof F)return Iter.Join(t.value.map(function(t){return Iter.ForArray(t)})).mapOneToMany(r);if(t instanceof HashTrie)throw new XError("Cannot atomize a map","FOTY0013");return Iter.Singleton(t)}function n(t){var e=Atomic.string.fromString,r=Atomic.untypedAtomic.fromString;switch(t.nodeType){case Q.DOCUMENT_NODE:return r(t.documentElement.textContent);case Q.DOCUMENT_FRAGMENT_NODE:case Q.ELEMENT_NODE:case Q.TEXT_NODE:return r(t.textContent||"");case Q.ATTRIBUTE_NODE:return r(t.value);case Q.COMMENT_NODE:return e(t.textContent);case Q.PROCESSING_INSTRUCTION_NODE:return e(t.data);case Q.NAMESPACE_NODE:return e(t.uri);default:throw"Unknown node type "+t.nodeType}}function o(t,e){function r(t){throw new XError("Effective boolean value is not defined for "+t,"FORG0006")}function n(){return null==t.next()?!0:void r("an atomic sequence of length > 1")}var o=t.next();if(null==o)return!1;if(Q.isNode(o))return!0;if(Atomic["boolean"].matches(o))return n()&&o.toBoolean();if(Atomic.numeric.matches(o)){var i=o.toNumber();return n()&&!isNaN(i)&&0!=i}return Atomic.string.matches(o)||Atomic.untypedAtomic.matches(o)||Atomic.anyURI.matches(o)?n()&&0!=o.toString().length:void r("type "+o.type)}function i(t){return"untypedAtomic"===t.type?Atomic["double"].cast(t):t}function a(t,e){var r=Calculate["i+i"],n=Atomic.integer.fromNumber(1);return Iter.Stepping(t,function(t){var o=r(t,n);return o.compareTo(e)>0?null:o})}function u(t,e,r){var n=Q.getChildElements(t,"withParam"),o=[{},{}];for(var i in e.tunnelParams)o[1][i]=e.tunnelParams[i];var a=e.tempOutputState;e.tempOutputState="template parameter",n.forEach(function(t){var r=Q.getAttributeAsEQName(t,"name"),n=x(t,"t")?1:0;o[n][r]=d(t,e).expand()}),e.tempOutputState=a,r.localParams=o[0],r.tunnelParams=o[1]}function s(t,e,r){var n,o="compAtt"==t.tagName,i=Regex.trim(q(v(t,"name"),e).next().toString()),a=v(t,"namespace");if(null==a){if(o&&"xmlns"==i)throw new XError("Attribute must not be named xmlns","XTDE0855",t);var u=b(t,i,!1);n=u.uri}else n=q(a,e).next().value,o&&""==n&&i.includes(":")&&(i=i.replace(/^.*:/,""));if("http://www.w3.org/2000/xmlns/"==n)throw XError("Disallowed namespace "+n,"XTDE0835");return Iter.Singleton(r(n,i))}function c(t,e,r){var n=d(t,e).next(),o=g(t,e).next();return null==n||null==o?(print("binary operator has a null arg: "+n+" "+o),null):r(n,o)}function l(t){if("xs:"==t.substring(0,3)){var e=Atomic[t.substring(3)];if(!e)throw"unimplemented type: "+t;return e}throw"unknown type "+t}function f(t,e){if(null!=e.fixed.staticBaseURI)return e.fixed.staticBaseURI;for(var r=t;;){if(r.hasAttribute("baseUri"))return r.getAttribute("baseUri");if(r=Q.xdmParentNode(r),null==r||r.nodeType!=Q.ELEMENT_NODE)return null}}function m(t,e){var r=t.lookupNamespaceURI(e);if(null!=r)return r;if(r=Q.getInheritedAttribute(t,"ns"),null==r)return null;var n,o=r.split(" ");for(n=0;n<o.length;n++){var i=o[n].split("=");if(i[0]==e)return i[1]}return null}function p(t,e,r){var n=Q.obtainDocumentNumber(new DocumentFragment);n._saxonBaseUri=f(t,e);var o=e.newContext(!1);return r&&(o.resultDocument=r),P(n,q(t,o),o),n}function h(t,e){throw new XError("The "+t+" construct has not been implemented in Saxon-JS","",e)}function d(t,e){return q(Q.getChildElements(t)[0],e)}function g(t,e){return q(Q.getChildElements(t)[1],e)}function v(t,e){var r,n=t.childNodes;for(r=0;r<n.length;r++){var o=n[r];if(o.nodeType==Q.ELEMENT_NODE&&o.getAttribute("role")==e)return o}return null}function x(t,e){return t.hasAttribute("flags")&&t.getAttribute("flags").indexOf(e)>=0}function y(t,e){var r=Q.getInheritedAttribute(t,"ns");if(null==r)throw new XError("Namespace context not available for "+t.tagName);return function(t){if(""==t&&!e)return"";var n,o=r.split(" ");for(n=0;n<o.length;n++){var i=o[n].split("=");if(i[0]==t)return i[1]}if(""==t)return"";throw new XError("Undeclared prefix: "+t,"XTDE0290")}}function b(t,e,r){return Atomic.QName.fromString(e,y(t,r))}function E(t){return"undefined"!=typeof t?N(t,"module",20)+"#"+N(t,"line",10):void 0}function N(t,e,r){if(null!=t&&r>0){var n=Q.getAttribute(t,e);return null!=n&&""!=n?n:N(t.parentNode,e,r-1)}}function S(t){throw print("*** Internal error: "+t),Error.dumpStack&&Error.dumpStack(),new XError("Internal error: "+t)}function w(t,e){var r=L[t.tagName];r||S("Unknown expr: "+t.tagName);try{return r(t,e)}catch(n){throw n instanceof XError?(e.currentError=n,null==n.compiledLineNr&&null==n.xsltLineNr&&(n.setExpr(t),null!=n.xsltLineNr),n):n}}function A(t){var e=L[t.tagName];return e||S("Unknown expr: "+t.tagName),function(r){try{return e(t,r)}catch(n){throw n instanceof XError&&(r.currentError=n,null==n.compiledLineNr&&n.setExpr(t)),n}}}function T(t){return A(Q.getChildElements(t)[1])}function I(t,e){return null==t?Iter.Empty:q(t,e)}function D(t){if(1>t||t>55295&&57344>t||t>65533&&65536>t||t>1114111)throw new XError("Invalid XML character 0x"+t.toString(16),"FOCH0001")}function O(t){for(var e=0;e<t.length;e++){var r=t.charCodeAt(e);if(r>=55296&&56319>=r)return!0}return!1}function _(t){var e="";return t.forEach(function(t){return D(t),e+=65536>t?String.fromCharCode(t):String.fromCharCode((t-65536>>10)+55296)+String.fromCharCode((t-65536&1023)+56320)}),e}function C(t){for(var e=[],r=0;r<t.length;r++){var n=t.charCodeAt(r);e.push(n>=55296&&56319>=n?1024*(n-55296)+(t.charCodeAt(++r)-56320)+65536:n)}return e}function U(t,e){function r(t,e){return Atomic.decimal.matches(t)?"decimal"==e||"float"==e||"double"==e:Atomic["float"].matches(t)?"float"==e||"double"==e:!1}if(Atomic[e].matches(t))return t;if(r(t,e))return Atomic[e].cast(t);throw new XError("Incompatible operands: "+t.type+" and "+e,"XPTY0004")}function M(t){var e="";return t.forEachItem(function(t){""!=e&&(e+=" "),e+=t.toString()}),e}function P(t,e,r){function n(e,r){function n(t){return t instanceof NamespaceNode?"a namespace":"an attribute"}if(r)throw new XError("Cannot create "+n(e)+" node after creating children","XTDE0410");if(t.nodeType==Q.DOCUMENT_FRAGMENT_NODE||t.nodeType==Q.DOCUMENT_NODE)throw new XError("Cannot add "+n(e)+" to a document node","XTDE0410")}function o(t,e){if(Q.isNode(e))a=!1;else if(e instanceof F)e.value.forEach(function(e){e.forEach(function(e){o(t,e)})});else{if(e instanceof HashTrie)throw XError("A map can't be a child of an XML node","XPTY0004");e=r.resultDocument.createTextNode((a?" ":"")+e.toString()),a=!0}if(t.nodeType==Q.ELEMENT_NODE||t.nodeType==Q.DOCUMENT_FRAGMENT_NODE)if(e instanceof NamespaceNode&&!(SaxonJS.getPlatform().inBrowser&&t instanceof HTMLElement)){if(n(e,i),e.prefix==t.prefix&&e.uri!=t.namespaceURI)throw XError("Saxon-JS restriction: namespace nodes in content clash with the element prefix");if(""==e.prefix){if(""==t.namespaceURI)throw XError("Cannot add a default namespace to a no-namespace element","XTDE0440");if(t.hasAttributeNS("","xmlns")){if(t.getAttributeNS("","xmlns")!=e.uri)throw XError("Cannot have two different default namespaces","XTDE0430")}else SaxonJS.getPlatform().inBrowser&&t instanceof HTMLElement||t.setAttributeNS("","xmlns",e.uri)}else{var u="http://www.w3.org/2000/xmlns/",s="xmlns:"+e.prefix;if(t.hasAttributeNS(u,e.prefix)&&t.getAttributeNS(u,e.prefix)!=e.uri)throw XError("Cannot have two namespaces with the same prefix","XTDE0430");t.setAttributeNS(u,s,e.uri)}}else if(e.nodeType==Q.ATTRIBUTE_NODE){if(n(e,i),e.namespaceURI){var c=e.name.split(":");if(2!=c.length||t.lookupNamespaceURI(c[0])!=e.namespaceURI)if(2==c.length&&null==t.lookupNamespaceURI(c[0]))t.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:"+c[0],e.namespaceURI);else for(var l=2==c.length?c[0]:"ns";;){if(null==t.lookupNamespaceURI(l)){t.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:"+l,e.namespaceURI),e.name=l+":"+c[c.length-1];break}l+="_1"}}t.setAttributeNodeNS(e.cloneNode(!0))}else e.nodeType==Q.DOCUMENT_NODE||e.nodeType==Q.DOCUMENT_FRAGMENT_NODE?Axis.child(e).forEachItem(function(e){o(t,e)}):(i=!0,t.appendChild(e),t.nodeType!=Q.ELEMENT_NODE||e.nodeType!=Q.ELEMENT_NODE||SaxonJS.getPlatform().inBrowser&&e instanceof HTMLElement||e.lookupNamespaceURI(e.prefix||"")==(e.namespaceURI||"")||Q.declareNS(e,e.prefix||"",e.namespaceURI||""));else if(t.nodeType==Q.DOCUMENT_NODE)null!=e&&(t.documentElement=e);else{if(t.nodeType!=Q.DOCUMENT_FRAGMENT_NODE)throw"unknown parent node type";if(e.nodeType==Q.ATTRIBUTE_NODE)throw"Cannot add attribute to a document";t.appendChild(e)}}var i=!1,a=!1;e.forEachItem(function(e){o(t,e)})}function F(t){this.value=t}function X(t,e,r){return Array.isArray(t)?(e(t.length),t.map(r)):void 0===r?t:r(t)}function k(t){this.value=t}function R(t,e){if("undefined"==typeof t)return Atomic.untypedAtomic.fromString("");switch(typeof t){case"string":return Atomic.string.fromString(t);case"number":return Atomic["double"].fromNumber(t);case"boolean":return Atomic["boolean"].fromBoolean(t);case"function":return new k(t);case"object":if(t instanceof Node||t instanceof Attr)return t;if(t instanceof Date)return Atomic.dateTime.fromString(t.toISOString());if(Array.isArray(t)){var r=[];return e?(t.forEach(function(t){r.push([R(t,!0)])}),new Expr.XdmArray(r)):(t.forEach(function(t){r.push(R(t,!0))}),r)}if(t instanceof Location)return Atomic.string.fromString(t.toString());if(t instanceof Window)return new k(t);if(null==t)return[];var n=new HashTrie;for(var o in t){var i=R(t[o]);Array.isArray(i)||(i=[i]),n.inSituPut(Atomic.string.fromString(o),i)}return n;default:return t}}function B(t){if(Atomic.string.matches(t)||Atomic.anyURI.matches(t)||Atomic.duration.matches(t)||Atomic.hexBinary.matches(t)||Atomic.base64Binary.matches(t)||Atomic.untypedAtomic.matches(t))return t.toString();if(Atomic.numeric.matches(t))return t.toNumber();if(Atomic["boolean"].matches(t))return t.toBoolean();if(Atomic.dateTime.matches(t)||Atomic.date.matches(t)||Atomic.time.matches(t)||Atomic.dateTimeStamp.matches(t)||Atomic.gYearMonth.matches(t)||Atomic.gYear.matches(t)||Atomic.gMonthDay.matches(t)||Atomic.gMonth.matches(t)||Atomic.gDay.matches(t))return t.toString();if(Atomic.QName.matches(t))return t.toEQName();if(t instanceof Node)return t;if(t instanceof NamespaceNode)return t;if(t instanceof Expr.XdmArray){var e=[];return 0==t.value.length||t.value.forEach(function(t){e.push(B(t))}),e}if(Array.isArray(t)){var e=[];return 0==t.length?null:1==t.length?B(t[0]):(t.forEach(function(t){e.push(B(t))}),e)}if(t instanceof HashTrie){var r={};return t.forAllPairs(function(t){r[t.k.toString()]=B(t.v)}),r}if(t instanceof k)return t.value;throw new XError("convertToJS() not implemented for "+showValue(t)+", "+typeof t+", "+t.constructor.name)}function z(t){return t.mapOneToMany(function(t){return t instanceof F?Iter.Join(t.value.map(function(t){return z(Iter.ForArray(t))})):Iter.Singleton(t)})}function $(t,e){function r(t){if(t instanceof F){var e="[";return t.value.forEach(function(t){"["!=e&&(e+=","),e+=n(t)}),e+"]"}if(t instanceof HashTrie){var i="{";return t.forAllPairs(function(t){"{"!=i&&(i+=","),i+='"'+t.k+'":',i+=n(t.v)}),i+"}"}return Q.isNode(t)?Q.xmlToString(t,o):Atomic.string.matches(t)||Atomic.untypedAtomic.matches(t)?'"'+t.toString()+'"':Atomic.integer.matches(t)||Atomic.numeric.matches(t)||Atomic["boolean"].matches(t)?t.toString():t instanceof Iter.Singleton?r(t.next()):showValue(t)}function n(t){if(1==t.length)return r(t[0]);var e="(";return t.forEach(function(t){"("!=e&&(e+=","),e+=r(t)}),e+")"}var o=void 0==e?"":"none";return n(t.expand())}var Q=DomUtils,L={analyzeString:function(t,r){var n=q(v(t,"select"),r).next();if(null==n)return Iter.Empty;n=n.toString();var o=q(v(t,"regex"),r).next().toString(),i=q(v(t,"flags"),r).next().toString(),a=v(t,"matching"),u=v(t,"nonMatching"),s=e(n,o,i,!0),c=r.newContext(!1),l=s.map(function(t){return t.string});return c.focus=Iter.Tracker(Iter.ForArray(l)),c.focus.mapOneToMany(function(t){var e=s[c.focus.position-1];return e.matching?(c.focus.regexGroups=e.groups,a?q(a,c):Iter.Empty):(c.focus.regexGroups=[],u?q(u,c):Iter.Empty)})},and:function(t,e){return Iter.oneBoolean(o(d(t,e))&&o(g(t,e)))},among:function(t,e){var r=d(t,e).next(),n=g(t,e);return n.filter(function(t){return t===r})},applyImports:function(t,e){var r=e.currentMode;if(null==r)throw new XError("applyImports: no current mode","XTDE0560",t);if(null==e.focus.current)throw new XError("applyImports: no context item","XTDE0560",t);var n=e.newContext(!0);return u(t,e,n),n.focus=Iter.Tracker(Iter.Singleton(e.focus.current)),n.focus.next(),r.applyImports(n)},applyT:function(t,e){var r;if(x(t,"c"))r=e.currentMode;else{var n=Q.getAttributeAsEQName(t,"mode");null==n&&(n=""),r=e.fixed.modes[n],null==r&&S("Mode "+n+" not found")}var o=e.newContext(!0);return u(t,e,o),o.focus=Iter.Tracker(d(t,e)),r.applyTemplates(o)},arith:function(t,e){var r=Calculate[t.getAttribute("calc")];return r||h("arithmetic ("+t.getAttribute("calc")+")"),Iter.Singleton(c(t,e,r))},arith10:function(t,e){function r(t){var e=t.next();return null==e?Atomic["double"].fromNumber(NaN):Atomic["double"].cast(e)}var n=Calculate[t.getAttribute("calc")];return Iter.Singleton(n(r(d(t,e)),r(g(t,e))))},array:function(t,e){var r=Q.getChildElements(t).map(function(t){return q(t,e).expand()});return Iter.Singleton(new F(r))},arrayBlock:function(t,e){var r=Q.getChildElements(t).map(function(t){return q(t,e).expand()});return Iter.Singleton(new F(r))},atomic:function(t){var e=t.getAttribute("val"),r=t.getAttribute("type").substring(3);return Atomic[r]||S("Unknown type: "+r,t),Iter.Singleton(Atomic[r].fromString(e))},atomSing:function(e,n){var o=d(e,n).mapOneToMany(r);if(!e.hasAttribute("card")&&(o=Iter.LookAhead(o),null==o.peek())){var i=t(e.getAttribute("diag"));throw new XError("The "+i.required+" is empty",i.code,e)}return o},att:function(t,e){var r=d(t,e),n=M(r),o=Q.getAttributeAsQName(t,"name");if(null==o)throw new XError("Invalid attribute name "+t.getAttribute("name"));var i=e.resultDocument.createAttributeNS(o.uri,t.getAttribute("name"));return i.value=n,Iter.Singleton(i)},axis:function(t,e){var r=new Function("item",t.getAttribute("jsTest")),n=t.getAttribute("name");if(!e.focus.current)throw new XError("Context item is absent for "+n+" axis","XPDY0002",t);return Axis[n](e.focus.current).filter(r)},callT:function(t,e){var r=Q.getAttributeAsEQName(t,"name"),n=e.fixed.namedTemplates[r];null==n&&S("Template "+r+" not found",t);var o=e.newContext(!0);return u(t,e,o),d(n,o)},cast:function(t,e){var r=d(t,e).next();if(null==r)return Iter.Empty;var n=l(t.getAttribute("as")),o="QName"==n.name?y(t,!0):null;return Iter.Singleton(n.cast(r,o))},castable:function(t,e){var n,o=d(t,e).mapOneToMany(r).expand();if(0==o.length)n="1".equals(t.getAttribute("emptiable"));else if(o.length>1)n=!1;else{var i=l(t.getAttribute("as")),a="QName"==i.name?y(t,!0):null;try{i.cast(o[0],a),n=!0}catch(u){n=!1}}return Iter.oneBoolean(n)},cfn:function(t,e){var r,n=t.getAttribute("name");return"_format-number_1"==n?(r=[d(t,e),Iter.oneString(t.getAttribute("pic"))],t.hasAttribute("format")&&r.push(Iter.oneString(t.getAttribute("format"))),CoreFn["format-number"](r,e,t)):"_translate_1"==n?(r=[d(t,e),Iter.oneString(t.getAttribute("a1")),Iter.oneString(t.getAttribute("a2"))],CoreFn.translate(r,e)):void S("Unimplemented: cfn "+n,t)},check:function(e,r){function n(r){var n=t(e.getAttribute("diag"));throw new XError("Required cardinality of "+n.required+" is "+i[o]+"; supplied value "+r,n.code,e)}var o=e.getAttribute("card"),i={"*":"zero or more","+":"one or more","?":"zero or one","":"zero",1:"exactly one"},a=d(e,r);if("*"==o)return a;var u=Iter.LookAhead(a),s=u.peek();if(null==s){if("?"==o||""==o)return Iter.Empty;n("is empty")}else""==o&&n("is not empty (first item "+showValue(s)+")");if("+"==o)return u;u.next();var c=u.next();if(null!=c){var l=u.count()+2;n("contains "+l+" items ("+showValue(s)+", "+showValue(c)+(l>2?",... )":")"))}return Iter.Singleton(s)},choose:function(t,e){var r,n=Q.getChildElements(t);for(r=0;r<n.length;r+=2)if(o(q(n[r],e),t))return q(n[r+1],e);return Iter.Empty},comment:function(t,e){var r=d(t,e),n=e.resultDocument.createComment(M(r));return Iter.Singleton(n)},compareToInt:function(t,e){var r=d(t,e).next(),n=Atomic.integer.fromString(t.getAttribute("val"));return Iter.oneBoolean(Compare.testComparison(t.getAttribute("op"),r.compareTo(n)))},compAtt:function(t,e){return s(t,e,function(r,n){var o=e.resultDocument.createAttributeNS(r,n);return o.value=M(q(v(t,"select"),e)),o})},compElem:function(t,e){return s(t,e,function(r,n){var o=e.createElement(r,n);if(""!=r){var i=n.split(":");Q.declareNS(o,1==i.length?"":i[0],r)}return P(o,q(v(t,"content"),e),e),o})},condCont:function(t){h("xsl:where-populated")},condSeq:function(t){h("xsl:on-empty/on-non-empty")},conditionalSort:function(t,e){return o(d(t,e))?g(t,e):d(Q.getChildElements(t)[1],e)},convert:function(t,e){var r=(t.getAttribute("to"),l(t.getAttribute("to")));return d(t,e).mapOneToOne(x(t,"p")?function(t){return U(t,r.name)}:r.cast)},copy:function(t,e){var r=e.focus.current,n=t.getAttribute("flags");return Q.shallowCopy(r,e,n,function(e){return d(t,e)})},copyOf:function(t,e){var r=t.getAttribute("flags");return d(t,e).mapOneToOne(function(t){return Q.copyItem(t,e,r)})},currentGroup:function(t,e){if(e&&e.focus&&e.focus.currentGroup)return Iter.ForArray(e.focus.currentGroup);throw new XError("There is no current group","XTDE1061",t)},currentGroupingKey:function(t,e){if(e&&e.focus&&e.focus.currentGroupingKey)return Iter.ForArray(e.focus.currentGroupingKey);throw new XError("There is no current grouping key","XTDE1071",t)},cvUntyped:function(t,e){var r=d(t,e),n=l(t.getAttribute("to")).cast;return r.mapOneToOne(function(t){return Atomic.untypedAtomic.matches(t)?n(t):t})},data:function(t,e){return d(t,e).mapOneToMany(r)},dbl:function(t){var e=t.getAttribute("val");return Iter.Singleton(Atomic["double"].fromString(e))},dec:function(t){var e=t.getAttribute("val");return Iter.oneDecimal(Big(e))},doc:function(t,e){return Iter.Singleton(p(Q.getChildElements(t)[0],e))},docOrder:function(t,e){return Q.inDocumentOrder(d(t,e))},dot:function(t,e){if(!e.focus)throw XError("There is no context item","XPDY0002",t);return Iter.Singleton(e.focus.current)},elem:function(t,e){var r=!1,n=t.getAttribute("name"),o=n.split(":"),i=null;if(t.hasAttribute("nsuri")&&(i=t.getAttribute("nsuri"),r=!0),2==o.length&&null==i&&(i=m(t,o[0]),r=!0),null==i&&(i=""),"http://www.w3.org/2000/xmlns/"==i)throw XError("Disallowed namespace "+i,"XTDE0835");var a=e.createElement(i,n);if(t.hasAttribute("namespaces")){var u,s=t.getAttribute("namespaces").split(" ");for(u=0;u<s.length;u++){var c=s[u].split("=");Q.declareNS(a,c[0],c[1]),c[0]==o[0]&&c[1]==i&&(r=!0)}}return r&&Q.declareNS(a,2==o.length?o[0]:"",i),P(a,d(t,e),e),Iter.Singleton(a)},empty:function(){return Iter.Empty},emptyTextNodeRemover:function(t,e){return d(t,e).filter(function(t){return!(t instanceof Node&&t.nodeType==Q.TEXT_NODE&&""==t.textContent)})},error:function(t){throw new XError(t.getAttribute("message"),t.getAttribute("code"),t)},evaluate:function(t,e){var r=q(v(t,"xpath"),e).next().toString(),n=q(v(t,"cxt"),e),o=q(v(t,"wp"),e),i=SaxonJS.XPath.evaluate(r,n,o);return i},every:function(t,e){var r=parseInt(t.getAttribute("slot")),n=d(t,e),i=T(t);return Iter.oneBoolean(!n.some(function(t){return e.localVars[r]=[t],!o(i(e))}))},except:function(t,e){var r=d(t,e),n=g(t,e);return Iter.Difference(r,n,Q.compareDocumentOrder)},"false":function(){return Iter.oneBoolean(!1)},filter:function(t,e){var r=d(t,e),n=T(t);if(x(t,"i")){var i=n(e).expand();if(1==i.length&&Atomic.numeric.matches(i[0])){var a=i[0].toNumber();if(r instanceof Iter.ForArray)return Iter.Singleton(r.expand()[a-1]);var u=Iter.Tracker(r);return u.filter(function(){return u.position==a})}return o(Iter.ForArray(i))?r:Iter.Empty}var s=e.newContext(!1);s.focus=Iter.Tracker(r);var c;return c=x(t,"p")?function(){var t=n(s).expand();return 1==t.length&&Atomic.numeric.matches(t[0])?s.focus.position==t[0].toNumber():o(Iter.ForArray(t))}:function(){return o(n(s))},s.focus.filter(c)},first:function(t,e){return Iter.Singleton(d(t,e).next())},fnRef:function(){throw new XError("Saxon-JS does not support higher-order functions","XTSE3540")},follows:function(t,e){return Iter.Singleton(c(t,e,function(t,e){return Atomic["boolean"].fromBoolean(Q.compareDocumentOrder(t,e)>0)}))},"for":function(t,e){var r=parseInt(t.getAttribute("slot")),n=T(t);return d(t,e).mapOneToMany(function(t){return e.localVars[r]=[t],n(e)})},forEach:function(t,e){var r=e.newContext(!1);r.focus=Iter.Tracker(d(t,e)),r.currentTemplate=null;var n=T(t),o=function(){return n(r)};return r.focus.mapOneToMany(o)},forEachGroup:function(t,e){return Compare.grouping(t,e)},fn:function(t,e){var r=CoreFn[t.getAttribute("name")];null==r&&h(t.getAttribute("name")+"()",t);var n=Q.getChildElements(t).map(function(t){return q(t,e)});return r(n,e,t)},functionCall:function(t,e){h(t.getAttribute("name")+"()",t)},gc:Compare.generalComparison,gc10:function(t,e){function n(t){return 1==t.length&&Atomic["boolean"].matches(t[0])}function i(t){return[Atomic["boolean"].fromBoolean(o(Iter.ForArray(t)))]}var a=d(t,e).expand(),u=g(t,e).expand();n(a)?u=i(u):n(u)?a=i(a):(a=Iter.ForArray(a).mapOneToMany(r).expand(),u=Iter.ForArray(u).mapOneToMany(r).expand());var s=Compare.allocateCodedComparer(t.getAttribute("comp"));return Compare.gc(Iter.ForArray(a),u,t.getAttribute("op"),s)},gcEE:Compare.generalComparison,gVarRef:function(t,e){var r=t.getAttribute("name"),n=e.fixed.globalVars[r];if(n.decl||S("Missing global $"+r,t),null==n.value){if("globalParam"==n.decl.tagName){var o=e.fixed.options.stylesheetParams[r];if(void 0===o&&/^Q\{\}/.test(r)&&(o=e.fixed.options.stylesheetParams[Atomic.QName.fromEQName(r).local]),void 0!==o){var i=new Function("val",n.decl.getAttribute("jsAcceptor")),a=new Function("n",n.decl.getAttribute("jsCardCheck")),u=X(o,a,i);n.value=Array.isArray(u)?u:[u]}else{if(x(n.decl,"r"))throw XError("Parameter "+r+" is required","XTDE0050",n);if(x(n.decl,"i"))throw XError("Parameter "+r+" cannot be empty","XTDE0700",n);0==Q.getChildElements(n.decl).length&&(n.value=[])}}if(null==n.value){var s=e.newContext(!0);s.tempOutputState="variable",s.currentMode=e.fixed.modes[""],s.currentTemplate=null,s.focus=Iter.Tracker(Iter.Singleton(e.fixed.globalContextItem)),s.focus.next();try{n.value=d(n.decl,s).expand()}catch(c){throw c instanceof XError&&(c.isGlobal=!0),c}}}return Iter.ForArray(n.value)},homCheck:function(t,e){var r=new Iter.LookAhead(d(t,e)),n=r.peek();if(null==n)return Iter.Empty;var o=Q.isNode(n),i=r.filter(function(e){if(Q.isNode(e)!=o)throw new XError("Cannot mix nodes and atomic values in the result of a path expression","XPTY0018",t);return!0});return o?Q.inDocumentOrder(i):i},ifCall:function(t,e){var r=Q.getAttributeAsQName(t,"name",!1);if("schedule-action"==r.local){var n=Q.getChildElements(t).length;if(3==n){var o=d(t,e).next().toNumber(),i=g(t,e).next();console.log("schedule action wait = "+o);var a=e.newContext(!1);e.focus&&(a.focus=new Iter.Tracker(new Iter.Singleton(e.focus.current)),a.focus.next());var u=function(){console.log("scheduled action triggered"),q(Q.getChildElements(t)[2],a).expand()};if(null!=i){var s=SaxonJS.getPlatform().resolveUri(i.toString(),Expr.staticBaseUri(t,e));SaxonJS.getPlatform().asyncGetXml(s,function(t,r){console.log("added document to pool "+t),e.fixed.documentPool[t]=r,u()})}else 0!=o&&setTimeout(u,o);return Iter.Empty}var o=d(t,e).next().toNumber();console.log("schedule action wait = "+o);var a=e.newContext(!1);e.focus&&(a.focus=new Iter.Tracker(new Iter.Singleton(e.focus.current)),a.focus.next());var u=function(){console.log("scheduled action triggered"),q(g(t,e).next(),a).expand()};return setTimeout(u,o),Iter.Empty}var c=Q.getChildElements(t).map(function(t,r){return q(t,e)});return ExtraFn(r.uri,r.local,c,e,t)},indexedFilter:function(t,e){var r=e.newContext(!1);r.focus=Iter.Tracker(d(t,e));var n=T(t),i=function(){return o(n(r))};return r.focus.filter(i)},indexedLookup:function(t,e){return Compare.generalComparison(t,e,"=")},inlineFn:function(t,e){h("inline function")},instance:function(t,e){var r={"*":{min:0,max:1/0},"+":{min:1,max:1/0},"?":{min:0,max:1},"":{min:0,max:0},1:{min:1,max:1}},n=d(t,e),o=t.getAttribute("of");if("empty-sequence()"==o)return Iter.oneBoolean(null==n.next());var i=o.charAt(o.length-1),a="*+?".indexOf(i)>=0,u=r[a?i:"1"];a&&(o=o.substring(0,o.length-1));for(var s,c=new Function("item",t.getAttribute("jsTest")),l=0;null!=(s=n.next());)if(++l>u.max||!c(s))return Iter.oneBoolean(!1);return Iter.oneBoolean(l>=u.min)},"int":function(t){var e=t.getAttribute("val");return Iter.Singleton(Atomic.integer.fromString(e))},intersect:function(t,e){var r=d(t,e),n=g(t,e);return Iter.Intersect(r,n,Q.compareDocumentOrder)},intRangeTest:function(t,e){var r=d(t,e),n=Q.getChildElements(t),o=q(n[1],e).next().toNumber(),i=q(n[2],e).next().toNumber(),a=r.some(function(t){var e=t.value;return e>=o&&i>=e});return Iter.oneBoolean(a)},is:function(t,e){return Iter.Singleton(c(t,e,function(t,e){return Atomic["boolean"].fromBoolean(Q.isSameNode(t,e))}))},isLast:function(t,e){return Iter.oneBoolean(e.focus.position==e.focus.last()==("1"==t.getAttribute("test")))},lastOf:function(t,e){var r=Iter.LookAhead(d(t,e));return r.filter(function(){return null==r.peek()})},let:function(t,e){var r=e.tempOutputState;e.tempOutputState="variable";var n=d(t,e).expand();e.tempOutputState=r;var o=parseInt(t.getAttribute("slot"));return e.localVars[o]=n,g(t,e)},literal:function(t,e){var r=Q.getChildElements(t).map(function(t){return q(t,e)});return Iter.Join(r)},map:function(t,e){var r=new HashTrie,n=null;return Q.getChildElements(t).forEach(function(t){null==n?n=q(t,e).next():(r.inSituPut(n,q(t,e).expand()),n=null)}),Iter.Singleton(r)},merge:function(t,e){h("xsl:merge")},mergeAdj:function(t,e){function r(t){return t instanceof Node&&t.nodeType==Q.TEXT_NODE}for(var n,o=[],i=d(t,e),a=!1;null!=(n=i.next());){var u=r(n);u&&""==n.nodeValue||(a&&u?o.push(e.resultDocument.createTextNode(o.pop().nodeValue+n.nodeValue)):(a=u,o.push(n)))}return Iter.ForArray(o)},message:function(t,e){var n="",o=e.tempOutputState;e.tempOutputState="variable",d(t,e).mapOneToMany(r).forEachItem(function(t){n+=" "+t.toString()});var i=q(v(t,"terminate"),e).next(),a=q(v(t,"error"),e).next();if("yes"==i||"true"==i||"1"==i)throw XError("Terminated with "+n,a.toString(),t);return e.fixed.options.deliverMessage&&e.fixed.options.deliverMessage(n),e.tempOutputState=o,Iter.Empty},minus:function(t,e){return d(t,e).mapOneToOne(function(t){return t.negate()})},namespace:function(t,e){var r=d(t,e).next().toString(),n=g(t,e).next().toString();if(""!=r&&!Regex.isNCName(r))throw XError("Prefix "+r+" is not an NCName","XTDE0920");if("xmlns"==r||"http://www.w3.org/2000/xmlns/"==n)throw XError("Disallowed prefix/namespace "+n,"XTDE0835");return Iter.Singleton(new NamespaceNode(r,n))},nextMatch:function(t,e){var r=e.currentMode,n=e.currentTemplate;if(!n)throw new XError("xsl:next-match: there is no current template","XTDE0560",t);var o=e.newContext(!0);return u(t,e,o),r.nextMatch(o)},or:function(t,e){return o(d(t,e))?Iter.oneBoolean(!0):Iter.oneBoolean(o(g(t,e)))},param:function(t,e){var r=Q.getAttributeAsEQName(t,"name"),n=parseInt(t.getAttribute("slot")),o=x(t,"t"),i=o?e.tunnelParams:e.localParams,a=i[r];if(!a){var u=v(t,"select");if(!u||x(t,"r"))throw new XError("Required parameter $"+r+" not supplied","XTDE0700",t);var s=e.tempOutputState;e.tempOutputState="xsl:param",a=q(u,e).expand(),e.tempOutputState=s}if(!("object"==typeof a&&"length"in a))throw"Param value of $"+r+" is not an array";e.localVars[n]=a;var c=v(t,"conversion");return null!=c&&(e.localVars[n]=q(c,e).expand()),Iter.Empty},precedes:function(t,e){return Iter.Singleton(c(t,e,function(t,e){return Atomic["boolean"].fromBoolean(Q.compareDocumentOrder(t,e)<0)}))},procInst:function(t,e){var r=d(t,e).next().value,n=g(t,e),o=e.resultDocument.createProcessingInstruction(r,M(n));return Iter.Singleton(o)},qName:function(t){var e=t.getAttribute("pre"),r=t.getAttribute("uri"),n=t.getAttribute("loc");return Iter.Singleton(Atomic.QName.fromParts(e,r,n))},range:function(t){var e=Atomic.integer.fromString(t.getAttribute("from")),r=Atomic.integer.fromString(t.getAttribute("to"));return a(e,r)},resultDoc:function(t,e){if(e.tempOutputState)throw XError("Cannot call xsl:result-document while evaluating "+e.tempOutputState,"XTDE1480");var r=v(t,"href"),n=null==r?"":q(r,e).next().toString(),o=!1;t.getAttribute("local").split(/\r?\n/).forEach(function(t){/^method=/.test(t)&&(o=/interactiveXSLT\}replace-content$/.test(t))});var i;if(i="#"==n.charAt(0)||"?"==n.charAt(0)?p(v(t,"content"),e,window.document):p(v(t,"content"),e),""==n)return Iter.Singleton(i);if("#"==n.charAt(0)){var a=window.document.getElementById(n.substring(1));if(!a)throw new XError("Result document href="+n+": no such node","XXXX9999",t);return o&&(a.innerHTML=""),Axis.child(i).forEachItem(function(t){var e=window.document.importNode(t,!0);a.appendChild(e)}),Iter.Empty}if("?"!=n.charAt(0)){if(e.fixed.resultDocUris[n])throw new XError("A result document with URI "+n+" has already been created","XTDE1490");return e.fixed.resultDocUris[n]=!0,e.fixed.options.deliverResultDocument(n,i),Iter.Empty}for(var a,u=n.substr(1),s=window.document.evaluate(u,e.focus.current,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null),c=0;c<s.snapshotLength;c++)a=s.snapshotItem(c),o&&(a.innerHTML=""),Axis.child(i).forEachItem(function(t){var e=window.document.importNode(t,!0);a.appendChild(e)})},root:function(t,e){var r=e.focus.current;if(!Q.isNode(r))throw new XError("Context item for '/' must be a node","XPTY0020");var n=Q.ownerDocument(r);if(n.nodeType!=Q.DOCUMENT_NODE&&n.nodeType!=Q.DOCUMENT_FRAGMENT_NODE)throw new XError("Root node for '/' must be a document node","XPDY0050");return Iter.Singleton(Q.ownerDocument(r))},sequence:function(t,e){var r=Q.getChildElements(t),n=r.map(function(t){return q(t,e)});return Iter.Join(n)},slash:function(t,e){var r=e.newContext(!1);r.focus=Iter.Tracker(d(t,e));var n=T(t),o=function(){return n(r)};return r.focus.mapOneToMany(o)},some:function(t,e){var r=parseInt(t.getAttribute("slot")),n=d(t,e),i=T(t);return Iter.oneBoolean(n.some(function(t){return e.localVars[r]=[t],o(i(e))}))},sort:Compare.sortSequence,str:function(t){var e=t.getAttribute("val");return Iter.oneString(e)},subscript:function(t,e){var r=d(t,e),n=g(t,e).next().value;if(r instanceof Iter.ForArray)return Iter.Singleton(r.expand()[n-1]);var o=r.mapOneToOne(function(t,e){return e+1==n?t:null}).next();return Iter.Singleton(o)},supplied:function(t,e){var r=parseInt(t.getAttribute("slot"));return Iter.ForArray(e.localVars[r])},"switch":function(t,e){var r=d(t,e).next();if(null==r)return Iter.oneBoolean(!1);for(var n=Q.getChildElements(t,"case"),o=0;o<n.length;o++){var i=d(n[o],e).next();if(i.equals(r))return g(n[o],e)}return q(v(t,"default"),e)},tail:function(t,e){var r=parseInt(t.getAttribute("start"))-1;return d(t,e).filter(function(t){return r--<=0})},tailCallLoop:function(t,e){return d(t,e)},to:function(t,e){var r=d(t,e).next(),n=g(t,e).next();return null==r||null==n||r.compareTo(n)>0?Iter.Empty:a(r,n)},treat:function(e,r){var n=new Function("item",e.getAttribute("jsTest"));return d(e,r).mapOneToOne(function(r){if(n(r))return r;var o=t(e.getAttribute("diag"));throw new XError("Required item type of "+o.required+" is "+e.getAttribute("as")+"; supplied value is "+showValue(r),o.code,e)})},"true":function(){return Iter.oneBoolean(!0)},"try":function(t,e){var r=!0;if(!r)return d(t,e);try{return Iter.ForArray(d(t,e).expand())}catch(n){if(n instanceof XError&&!n.isGlobal){e.currentError=n,null==n.compiledLineNr&&n.setExpr(t);for(var o,i=Atomic.QName.fromParts("","http://www.w3.org/2005/xqt-errors",n.code),a=Iter.ForArray(Q.getChildElements(t,"catch"));null!=(o=a.next());){var u=new Function("q","return "+o.getAttribute("test")+";");if(u(i))return d(o,e)}throw n}throw n instanceof XError?n:(Error.dumpStack&&Error.dumpStack(),n)}},ufCall:function(t,e){var r=Q.getAttributeAsEQName(t,"name"),n=Q.getChildElements(t),o=e.fixed.userFunctions[r+"#"+n.length];
null==o&&S("Function "+r+"#"+n.length+" not found");var i=e.newContext(!0);return i.tempOutputState="function",i.currentMode=e.fixed.modes[""],i.currentTemplate=null,i.localVars=n.map(function(t){return q(t,e).expand()}),i.localParams={},q(o,i)},union:function(t,e){var r=d(t,e),n=g(t,e);return Iter.Union(r,n,Q.compareDocumentOrder)},useAS:function(t,e){var r=Q.getAttributeAsEQName(t,"name"),n=e.fixed.attributeSets[r];null==n&&S("Attribute set "+r+" not found",t);var o=e.newContext(!0);return o.tempOutputState="attribute set",d(n,o)},vc:function(t,e){function r(t){return null==t?null:Atomic.untypedAtomic.matches(t)?Atomic.string.cast(t):t}var n=r(d(t,e).next()),o=r(g(t,e).next());if(null==n||null==o)return Iter.Empty;var i=Compare.allocateCodedComparer(t.getAttribute("comp")),a=t.getAttribute("op");return"="==a||"eq"==a||"!="==a||"ne"==a?Iter.oneBoolean(Compare.testEquality(a,i.equals(n,o))):Iter.oneBoolean(Compare.testComparison(a,i.compare(n,o)))},valueOf:function(t,e){var r=d(t,e),n=e.resultDocument.createTextNode(M(r));return Iter.Singleton(n)},varRef:function(t,e){var r=parseInt(t.getAttribute("slot")),n=e.localVars[r];return Iter.ForArray(n)},xslNumber:function(t,e){return Numberer.xslNumber(t,e)},styleValue:function(t,e){var r=t.getAttribute("name");return Iter.oneString(e.focus.current.style[r])}},q=w;return F.prototype={value:[],get:function(t){if("number"!=typeof t)throw new XError("Array subscript is not numeric","XPTY0004");if(1>t||t>=value.length)throw new XError("Array index ("+t+") out of bounds (1 to "+value.length+")","FOAY0001");return value[t-1]}},k.prototype={value:null},{atomize:r,analyze:e,ebv:o,untypedToDouble:i,hasFlag:x,evaluate:q,evalChild1:d,evalChild2:g,evaluateIfPresent:I,argRole:v,makeComplexContent:P,staticBaseUri:f,stylesheetResolver:y,internalError:S,notImplemented:h,XdmArray:F,flatten:z,promote:U,serialize:$,isAstral:O,codepointsToString:_,stringToCodepoints:C,convertToJS:B,convertFromJS:R,JSValue:k,getSourceLoc:E}}(),Mode=function(){function t(t,e){return t.prec==e.prec?t.prio==e.prio?t.seq-e.seq:t.prio-e.prio:t.prec-e.prec}function e(t){return JSON.stringify({prec:t.prec,prio:t.prio,seq:t.seq,line:t.line,match:t.pattern})}function r(t){return makePattern(Expr.argRole(t,"match"))}function n(e){this._expr=e,this.onNoMatch=e.getAttribute("onNo"),this._rules=DomUtils.getChildElements(e).map(function(t){return{rule:t,prec:parseInt(t.getAttribute("prec")),prio:parseFloat(t.getAttribute("prio")),seq:parseInt(t.getAttribute("seq")),minImp:parseInt(t.getAttribute("minImp")),pattern:r(t),action:Expr.argRole(t,"action")}}).sort(t).reverse()}var o={TC:function(t,e,r){if(!DomUtils.isNode(t))return Iter.Singleton(t);switch(t.nodeType){case DomUtils.DOCUMENT_NODE:case DomUtils.DOCUMENT_FRAGMENT_NODE:case DomUtils.ELEMENT_NODE:var n=r.newContext(!1);return n.focus=Iter.Tracker(Axis.child(t)),e.applyTemplates(n);case DomUtils.TEXT_NODE:case DomUtils.CDATA_SECTION:return Iter.Singleton(DomUtils.copyItem(t,r));case DomUtils.ATTRIBUTE_NODE:return Iter.Singleton(r.resultDocument.createTextNode(t.value));default:return Iter.Empty}},SC:function(t,e,r){function n(r){var n=r.newContext(!1),o=new Array;return o[0]=Iter.Tracker(Axis.attribute(t)),o[1]=Iter.Tracker(Axis.child(t)),n.focus=Iter.Join(o),e.applyTemplates(n)}return DomUtils.shallowCopy(t,r,"c",n)},DC:function(t,e,r){return Iter.Singleton(DomUtils.copyItem(t,r,"c"))},DS:function(t,e,r){return Iter.Empty},SS:function(t,e,r){if(!DomUtils.isNode(t))return Iter.Singleton(t);switch(t.nodeType){case DomUtils.DOCUMENT_NODE:case DomUtils.DOCUMENT_FRAGMENT_NODE:case DomUtils.ELEMENT_NODE:var n=r.newContext(!1),o=[];return o[0]=Iter.Tracker(Axis.attribute(t)),o[1]=Iter.Tracker(Axis.child(t)),n.focus=Iter.Join(o),e.applyTemplates(n);default:return Iter.Empty}},bubble:function(t,e,r){if(!DomUtils.isNode(t))return Iter.Singleton(t);switch(t.nodeType){case DomUtils.ELEMENT_NODE:var n=r.newContext(!1);return n.focus=Iter.Tracker(Axis.parent(t)),e.applyTemplates(n);default:return Iter.Empty}}};return n.prototype={_expr:null,_rules:null,onNoMatch:"TC",applyTemplates:function(t){var e=this;return t.focus.mapOneToMany(function(r){return e._processItem(r,t)})},applyImports:function(t){var e=t.currentTemplate;if(!e)throw XError("No current template rule","XTDE0560");return this._processItem(t.focus.current,t,function(t){return t.prec>=e.minImp&&t.prec<e.prec})},nextMatch:function(e){var r=e.currentTemplate;if(!r)throw XError("No current template rule","XTDE0560");return this._processItem(e.focus.current,e,function(e){return t(e,r)<0})},findBestRule:function(e,r,n){var o=this._rules,i=null;return o.forEach(function(o){n&&!n(o)||i&&!(t(o,i)>0)||!o.pattern(e,r)||(i=o)}),i},isNonDOMmode:function(t){return null!==this.findBestRule(Expr.JSValue(window),t)},_processItem:function(t,e,r){var n=this.findBestRule(t,e,r);if(null!=n)return e.currentTemplate=n,e.currentMode=this,Expr.evaluate(n.action,e);var i,a=this._expr.getAttribute("name");i=null!=a&&"Q{http://saxonica.com/ns/interactiveXSLT"==a.split("}")[0]?"bubble":this.onNoMatch.split("+")[0];var u=o[i];if(u)return u(t,this,e);throw XError("No matching template rule for "+showValue(t)+" onNoMatch = "+this.onNoMatch,"XTDE0555")},printRules:function(){var t=this._rules,r="";return t.forEach(function(t){r+=e(t)}),r}},n}(),Iter=function(){function t(){}function e(r){return this instanceof e?(t.call(this),void(this._item=r)):new e(r)}function r(e){return this instanceof r?(t.call(this),void(this._array=e)):new r(e)}function n(e,r){if(!(this instanceof n))return new n(e,r);if(t.call(this),this._base=e,this._predicate=r,!r)throw"Undefined predicate"}function o(e,r){return this instanceof o?(t.call(this),this._base=e,void(this._mapper=r)):new o(e,r)}function i(e,r){if(!(this instanceof i))return new i(e,r);if(t.call(this),this._base=e,!("object"==typeof e&&"next"in e))throw"not an iterator";this._mapper=r}function a(e,r){return this instanceof a?(t.call(this),this._next=e,void(this._step=r)):new a(e,r)}function u(e){if(!(this instanceof u))return new u(e);if(t.call(this),!Array.isArray(e))throw Error.dumpStack(),"JoinIterator expects array";this._iterators=e}function s(e,r,n){return this instanceof s?(t.call(this),this._iter1=Iter.LookAhead(e),this._iter2=Iter.LookAhead(r),void(this._compare=n)):new s(e,r,n)}function c(e,r,n){return this instanceof c?(t.call(this),this._iter1=Iter.LookAhead(e),this._iter2=Iter.LookAhead(r),void(this._compare=n)):new c(e,r,n)}function l(e,r,n){return this instanceof l?(t.call(this),this._iter1=Iter.LookAhead(e),this._iter2=Iter.LookAhead(r),void(this._compare=n)):new l(e,r,n)}function f(e){return"peek"in e?e:this instanceof f?(t.call(this),this._base=e,void(this._nextButOne=e.next())):new f(e)}function m(e){return this instanceof m?(t.call(this),void(this._base=e)):new m(e)}t.prototype={filter:function(t){return n(this,t)},mapOneToOne:function(t){return i(this,t)},mapOneToMany:function(t){return new o(this,t)},forEachItem:function(t){for(var e;null!=(e=this.next());)t(e)},some:function(t){for(var e;null!=(e=this.next());)if(t(e))return!0;return!1},every:function(t){for(var e;null!=(e=this.next());)if(!t(e))return!1;return!0},count:function(t){var e=0;return this.forEachItem(function(){e++}),e},expand:function(){var t=[];return this.forEachItem(function(e){t.push(e)}),t}},e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype._item=null,e.prototype.next=function(){var t=this._item;return this._item=null,t},e.prototype.peek=function(){return this._item},e.prototype.expand=function(){return null==this._item?[]:[this._item]};var p={next:function(){return null},peek:function(){return null},expand:function(){return[]},count:function(){return 0},filter:function(){return p},mapOneToOne:function(){return p},mapOneToMany:function(){return p},forEachItem:function(){},some:function(){return!1}};return r.prototype=Object.create(t.prototype),r.prototype.constructor=r,r.prototype._array=null,r.prototype._index=0,r.prototype.next=function(){return this._index<this._array.length?this._array[this._index++]:null},r.prototype.peek=function(){return this._index<this._array.length?this._array[this._index]:null},r.prototype.expand=function(){return this._array},r.prototype.count=function(){return this._array.length},n.prototype=Object.create(t.prototype),n.prototype.constructor=n,n.prototype._base=null,n.prototype._predicate=null,n.prototype.next=function(){for(;;){var t=this._base.next();if(!t)return null;if(this._predicate(t))return t}},o.prototype=Object.create(t.prototype),o.prototype.constructor=o,o.prototype._base=null,o.prototype._mapper=null,o.prototype._currentIter=null,o.prototype.next=function(){for(;;){if(null!=this._currentIter){var t=this._currentIter.next();if(t)return t}var e=this._base.next();if(null==e)return null;if(this._currentIter=this._mapper(e),this._currentIter&&!this._currentIter.next)throw Error.dumpStack(),"Result of mapper is not an iterator, mapper = "+this._mapper}},i.prototype=Object.create(t.prototype),i.prototype.constructor=i,i.prototype._base=null,i.prototype._mapper=null,i.prototype._position=0,i.prototype.next=function(){for(;;){var t=this._base.next();if(!t)return null;var e=this._mapper(t,this._position++);if(e)return e}},a.prototype=Object.create(t.prototype),a.prototype.constructor=a,a.prototype._step=null,a.prototype._next=null,a.prototype.next=function(){var t=this._next;return t?(this._next=this._step(t),t):null},a.prototype.peek=function(){return this._next},u.prototype=Object.create(t.prototype),u.prototype.constructor=u,u.prototype._iterators=[],u.prototype.current=null,u.prototype.next=function(){for(;;){if(0==this._iterators.length)return this.current=null,null;var t=this._iterators[0].next();if(null!=t)return this.current=t,t;this._iterators.shift()}},s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype._iter1=null,s.prototype._iter2=null,s.prototype._compare=null,s.prototype.current=null,s.prototype.next=function(){var t=this._iter1.peek(),e=this._iter2.peek();if(t&&e){var r=this._compare(t,e);return 0>r?(current=this._iter1.next(),current):r>0?(current=this._iter2.next(),current):(current=this._iter1.next(),current=this._iter2.next(),current)}return t?(current=this._iter1.next(),current):e?(current=this._iter2.next(),current):(current=null,null)},c.prototype=Object.create(t.prototype),c.prototype.constructor=c,c.prototype._iter1=null,c.prototype._iter2=null,c.prototype._compare=null,c.prototype.next=function(){for(var t=this._iter1.peek(),e=this._iter2.peek();t&&e;){var r=this._compare(t,e);if(0>r)this._iter1.next(),t=this._iter1.peek();else{if(!(r>0))return this._iter1.next(),this._iter2.next();this._iter2.next(),e=this._iter2.peek()}}return null},l.prototype=Object.create(t.prototype),l.prototype.constructor=l,l.prototype._iter1=null,l.prototype._iter2=null,l.prototype._compare=null,l.prototype.next=function(){for(var t=this._iter1.peek(),e=this._iter2.peek();t&&e;){var r=this._compare(t,e);if(0>r)return this._iter1.next();r>0?(this._iter2.next(),e=this._iter2.peek()):(this._iter1.next(),this._iter2.next(),t=this._iter1.peek(),e=this._iter2.peek())}return t&&!e?this._iter1.next():null},f.prototype=Object.create(t.prototype),f.prototype.constructor=f,f.prototype._base=null,f.prototype.next=function(){var t=this._nextButOne;return t&&(this._nextButOne=this._base.next()),t},f.prototype.peek=function(){return this._nextButOne},m.prototype=Object.create(t.prototype),m.prototype.constructor=m,m.prototype._base=null,m.prototype._last=-1,m.prototype.position=0,m.prototype.current=null,m.prototype.next=function(){return this.position++,this.current=this._base.next(),null==this.current&&(this.position=-1),this.current},m.prototype.last=function(){if(this._last<0)if(this._base instanceof r)this._last=this._base.expand().length;else{for(var t,e=[];null!=(t=this._base.next());)e.push(t);this._last=this.position+e.length,this._base=Iter.ForArray(e)}return this._last},{Empty:p,Singleton:e,Join:u,Stepping:a,LookAhead:f,Tracker:m,ForArray:r,Union:s,Intersect:c,Difference:l,trace:function(t,e,r){for(var n,o=[];null!=(n=e.next());){var i;i="object"==typeof n?n instanceof Node?r?n.toString():n.nodeType+":"+(n.tagName||n.textContent):n instanceof NamespaceNode?"xmlns:"+n.prefix+"="+n.uri:n.toString():typeof n,print(t+": "+i),o.push(n)}return 0==o.length&&print(t+": <empty>"),Iter.ForArray(o)},oneString:function(t){return Iter.Singleton(null==t?null:Atomic.string.fromString(t))},oneInteger:function(t){return Iter.Singleton(Atomic.integer.fromNumber(t))},oneDouble:function(t){return Iter.Singleton(Atomic["double"].fromNumber(t))},oneFloat:function(t){return Iter.Singleton(Atomic["float"].fromNumber(t))},oneDecimal:function(t){return Iter.Singleton(Atomic.decimal.fromBig(t))},oneBoolean:function(t){return Iter.Singleton(Atomic["boolean"].fromBoolean(t))}}}(),makePattern=function(t){var e={"p.any":function(t){return function(){return!0}},"p.booleanExp":function(t){return function(e,r){var n=r.newContext();return n.focus=Iter.Tracker(Iter.Singleton(e)),n.focus.next(),Expr.ebv(Expr.evalChild1(t,n))}},"p.genNode":function(t){var e=DomUtils.getChildElements(t)[0];return function(t,r){if(!DomUtils.isNode(t))return!1;for(var n,o=Axis.ancestorOrSelf(t);null!=(n=o.next());){var i=r.newContext(!1);i.focus=Iter.Tracker(Iter.Singleton(n)),i.focus.next();for(var a,u=Expr.evaluate(e,i);null!=(a=u.next());)if(a==t)return!0}return!1}},"p.nodeSet":function(t){return function(e,r){for(var n,o=Expr.evalChild1(t,r);null!=(n=o.next());)if(n==e)return!0;return!1}},"p.nodeTest":function(t){return new Function("item",t.getAttribute("jsTest"))},"p.simPos":function(t){var e=new Function("item",t.getAttribute("jsTest")),r=parseInt(t.getAttribute("pos"));return function(t,n){return e(t)&&Axis.precedingSibling(t).filter(e).count()==r-1}},"p.venn":function(t){var e=DomUtils.getChildElements(t),r=makePattern(e[0]),n=makePattern(e[1]),o=t.getAttribute("op");switch(o){case"union":return function(t,e){return r(t,e)||n(t,e)};case"intersect":return function(t,e){return r(t,e)&&n(t,e)};case"except":return function(t,e){return r(t,e)&&!n(t,e)};default:throw"unknown op "+o}},"p.withCurrent":function(t){var e=makePattern(DomUtils.getChildElements(t)[0]);return function(t,r){var n=r.newContext(!0);return n.localVars[0]=[t],e(t,n)}},"p.withPredicate":function(t){var e=DomUtils.getChildElements(t),r=makePattern(e[0]),n=e[1];return function(t,e){if(!r(t,e))return!1;var o=e.newContext(!1);o.focus=Iter.Tracker(Iter.Singleton(t)),o.focus.next();var i=Expr.ebv(Expr.evaluate(n,o));return i}},"p.withUpper":function(t){var e=DomUtils.getChildElements(t),r=makePattern(e[0]),n=makePattern(e[1]),o=t.getAttribute("axis");return"parent"==o?"true"==t.getAttribute("upFirst")?function(t,e){var o=DomUtils.xdmParentNode(t);return o&&n(o,e)&&r(t,e)}:function(t,e){var o=DomUtils.xdmParentNode(t);return o&&r(t,e)&&n(o,e)}:function(t,e){if(!r(t,e))return!1;for(var i,a=Axis[o](t);null!=(i=a.next());)if(n(i,e))return!0;return!1}}},r=e[t.tagName];if(r)return r(t);throw"Unimplemented pattern "+t.tagName},Regex=function(){function t(){if(null==n){print("Loading categories.json");var t=SaxonJS.getPlatform().readResource("opt/categories.json");n=JSON.parse(t),print("Finished loading categories.json")}return n}function e(e,r,n){function o(e,r){function n(t){for(var e=t.toString(16);e.length<4;)e="0"+e;return"\\u"+e}function o(t){for(var e="",r=0;r<t.length;r+=2)t[r+1]<65536&&(e+=n(t[r]),t[r+1]>t[r]&&(e+="-"+n(t[r+1])));return e}function s(t){var e=[];0!=t[0]&&(e.push(0),e.push(t[0]-1));for(var r=2;r<t.length;r+=2)e.push(t[r-1]+1),e.push(t[r]-1);var n=t[t.length-1];return 65535>n&&(e.push(n+1),e.push(65535)),e}function c(t,e,r){r&&(t=s(t));var n=o(t);return e||(n="["+n+"]"),n}function h(t,e,r){var n=[];return t.forEach(function(t){n.push(parseInt(t[0],16)),n.push(parseInt(t[1],16))}),c(n,e,r)}var g=e.charAt(r+1);if(u&&"nrt\\|.-^?*+{}()[]pPsSiIcCdDwW".indexOf(g)<0&&(0!=f||!/[0-9]/.test(g))&&a("\\"+g+" is not allowed in XPath regular expressions"),"p"==g||"P"==g){var v=e.indexOf("}",r),x=e.substring(r+3,v);i("x")&&(x=x.replace(/[ \n\r\t]+/g,""));var y=t(),b=y[x];b||a("Unknown category "+x);var E;1==x.length?(E=[],b.split("|").forEach(function(t){E=E.concat(y[t])})):E=b,l+=h(E,f>0,"P"==g),r=v}else"d"==g?(l+=h(t().Nd,f>0,!1),r++):"i"==g?(l+=c(m,f>0,!1),r++):"c"==g?(l+=c(p,f>0,!1),r++):"I"==g?(l+=c(m,f>0,!0),r++):"C"==g?(l+=c(p,f>0,!0),r++):/[0-9]/.test(g)?f>0?a("Numeric escape within charclass"):(d[parseInt(g)]?print("Capture #"+g+" ok"):a("No capturing expression #"+g),l+="\\"+g,r++):(l+="\\"+g,r++);return{output:l,i:r}}function i(t){return r.indexOf(t)>=0}function a(t){throw new XError("Invalid XPath regular expression: "+t,"FORX0002")}var u=!0;if(r=r?r.toString():"",n&&Expr.isAstral(n))throw new XError("Cannot handle non-BMP characters with regular expressions","SXJS0001");var s=(i("i")?"i":"")+(i("m")?"m":"")+(i("g")?"g":"");if(i("j"))return new RegExp(e,r.replace("j",""));if(i("q"))return new RegExp(e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),s);var c,l="",f=0,m=[58,58,65,90,95,95,97,122,192,214,216,246,248,767,880,893,895,8191,8204,8205,8304,8591,11264,12271,12289,55295,63744,64975,65008,65533,65536,983039],p=[45,46,48,58,65,90,95,95,97,122,183,183,192,214,216,246,248,893,895,8191,8204,8205,8255,8256,8304,8591,11264,12271,12289,55295,63744,64975,65008,65533,65536,983039],h=[],d=[],g=1;for(c=0;c<e.length;c++){var v=e.charAt(c);switch(v){case"[":u&&f>0&&a("-"==e.charAt(c-1)?"Regex subtraction not implemented":"Nested square brackets"),"]"==e.charAt(c+1)&&a("Character group is empty"),f++,l+=v;break;case"]":0==f&&a("Unmatched ']'"),f--,l+=v;break;case"(":var x=!0;c+2<e.length&&"?"==e.charAt(c+1)&&(":"!=e.charAt(c+2)?a("'(?' must be followed by ':'"):x=!1),h.push(x?g++:-1),l+=v;break;case")":0==h.length&&a("Unmatched ')'");var y=h.pop();y>0&&(d[y]=!0),l+=v;break;case".":l+=0==f&&i("s")?"[^]":v;break;case"{":if(u&&","==e.charAt(c+1))throw XError("{,x} not allowed in XPath regex dialect","FORX0002");l+=v;break;case" ":case"\n":case"\r":case"	":(!i("x")||f>0)&&(l+=v);break;case"\\":if(i("q"))l+="\\\\";else if(c+1<e.length){var b=o(e,c);l=b.output,c=b.i}break;default:l+=v}}f>0&&a("Unmatched '['"),0!=h.length&&a("Unmatched '(");try{return new RegExp(l,s)}catch(E){throw/^[imsxjqg]*$/.test(r)?new XError("Invalid regular expression /"+e+"/: "+E.message,"FORX0002"):new XError("Invalid regex flags: "+r,"FORX0001")}}function r(t,e){if(e=e.toString(),/j/.test(e))return t;if(/q/.test(e))return/\$['`]/.test(t)&&(t=t.replace(/\$'/g,"$$$$'").replace(/\$`/g,"$$$$`")),t.replace(/\$/g,"$$");if(/(^|[^\\])\$([^0-9]|$)/.test(t)||/(^|[^\\])\\([^\\\$]|$)/.test(t))throw new XError("Invalid replacement string: "+t,"FORX0004");return t.replace(/\\\\/g,"\\").replace(/\\\$/g,"$$$$").replace(/\$0/g,"$$&")}var n=null,o=e("^\\i\\c*$",""),i=e("^\\c+$","");return{obtainCategoryEscapes:t,prepareRegex:e,convertReplacement:r,isNCName:function(t){return o.test(t)&&!/:/.test(t)},isName:function(t){return o.test(t)},isNMTOKEN:function(t){return i.test(t)},isQName:function(t){return o.test(t)&&/^[^:]+(:[^:]+)?$/.test(t)},trim:function(t){return t.replace(/^[ \t\r\n]+|[ \t\r\n]+$/g,"")}}}(),CoreFn=function(){"use strict";function t(t,e,r){var n=e.fixed.documentPool[t];return n||(n=r(),e.fixed.documentPool[t]=n),n}function e(e,r){if(e.indexOf("#")>=0)throw XError("Fragments not supported in external document URIs","FODC0002");return t(e,r,function(){var t=SaxonJS.getPlatform().readFile(e),r=v.obtainDocumentNumber(SaxonJS.getPlatform().parseXmlFromString(t));return r._saxonDocumentUri=e,r._saxonBaseUri=e,r})}function r(t,e,r){var n=g.staticBaseUri(r,e),o=t[0].next();return null===o?null:SaxonJS.getPlatform().resolveUri(o.toString(),n)}function n(e,n,o){var i=r(e,n,o),a="";if(e[1]&&(a=s(e[1]),"utf-8"!=a&&"utf-16"!=a))throw XError("Unrecognized encoding "+a,"FOUT1190");return null===i?null:t(i,n,function(){return SaxonJS.getPlatform().readFile(i,a)})}function o(t){try{return t(),Iter.oneBoolean(!0)}catch(e){return Iter.oneBoolean(!1)}}function i(t,e,r,n){var o=t.next();if(o){var i=Regex.trim(o.toString());if(n&&Regex.isNCName(i))return"Q{"+n+"}"+i;var a=Atomic.QName.fromString(i,g.stylesheetResolver(e,!1));if(null==a)throw new XError("Invalid QName "+i,r,e);return"Q{"+a.uri+"}"+a.local}return null}function a(t,e){var r=s(t[0]),n="";return Expr.stringToCodepoints(r).forEach(function(t){var r=Expr.codepointsToString([t]);n+=e(t,r)?encodeURIComponent(r):r}),Iter.oneString(n)}function u(t){if(t&&"http://www.w3.org/2005/xpath-functions/collation/codepoint"!=t.next().toString())throw XError("Unrecognized collation","FOCH0002")}function s(t){var e=t.next();return e?e.value:""}function c(t){return g.stringToCodepoints(s(t))}function l(t,e,r){var n=Math.round(e.next().toNumber()),o=r?n+Math.round(r.next().toNumber()):t.length+1;return t.filter(function(t,e){return e+1>=n&&o>e+1})}function f(t,e,r){var n=e;return t.forEachItem(function(t){n=r(t,n)}),n}function m(t){var e="max"==t?function(t){return t>0}:function(t){return 0>t};return function(t,r,n){var o=t[0];g.hasFlag(n,"i")&&(o=o.filter(function(t){return!Compare.itemIsNaN(t)}));var i=Atomic.untypedAtomic.matches,a=Atomic["double"].cast;o=o.mapOneToOne(function(t){return i(t)?a(t):t});var u=o.next();if(null==u)return Iter.Empty;var s=Compare.allocateCodedComparer("GAC");return Iter.Singleton(f(o,u,function(t,r){return e(s.compare(t,r))?t:r}))}}function p(t,e){var r=t[0].next();if(null==r)return Iter.Empty;if("timezone"==e)return null==r.timezoneOffset?Iter.Empty:Iter.Singleton(Atomic.dayTimeDuration.fromNumberOfMinutes(r.timezoneOffset));if("seconds"==e){var n=r.proxy();return Iter.oneDecimal(n.getUTCSeconds()+n.getUTCMilliseconds()/1e3)}var o=r.proxy()[e]();return"getUTCMonth"==e&&o++,Iter.oneInteger(o)}function h(t,e){var r=t[0].next();return null==r?Iter.Empty:5!=e?Iter.oneInteger(r.parts()[e]*r.signum()):Iter.oneDecimal(r.parts()[e]*r.signum())}function d(t,e,r){function n(t,r){return Iter.Singleton(Atomic[e].fromDate(t,r))}var o=t[0].next();if(!o)return Iter.Empty;var i,a=r.fixed.currentDate.getTimezoneOffset();if(t[1]){var u=t[1].next();if(i=null!=u?u.milliseconds/6e4:null,null!=i&&(-840>i||i>840))throw new XError("timezone out of bounds "+u,"FODT0003")}else i=-a;var s=o.timezoneOffset;return null==s&&null==i?Iter.Singleton(o):null==s&&null!=i?n(o.adjustByMinutes(-a-i).UTCdate,i):null!=s&&null==i?n(o.adjustByMinutes(a+s).UTCdate,null):null!=s&&null!=i?n(o.UTCdate,i):void 0}var g=Expr,v=DomUtils;return{abs:function(t){var e=t[0].next();return null==e?Iter.Empty:Iter.Singleton(e.abs())},"adjust-date-to-timezone":function(t,e){return d(t,"date",e)},"adjust-dateTime-to-timezone":function(t,e){return d(t,"dateTime",e)},"adjust-time-to-timezone":function(t,e){return d(t,"time",e)},"analyze-string":function(t,e){var r=s(t[0]),n=new DocumentFragment,o="http://www.w3.org/2005/xpath-functions",i=e.resultDocument.createElementNS(o,"analyze-string-result");if(n.appendChild(i),""==r)return Iter.Singleton(i);var a=t[1].next().toString(),u=t[2]?t[2].next().toString():"",c=Expr.analyze(r,a,u,!1);return c.forEach(function(t){if(t.matching){var r,n=t.groups,a=e.resultDocument.createElementNS(o,"match"),u=0;for(r=1;r<n.length;r++)if(n[r]){var s=n[0].indexOf(n[r],u);if(s>u){var c=e.resultDocument.createTextNode(n[0].substring(u,s));a.appendChild(c)}var l=e.resultDocument.createElementNS(o,"group");l.setAttribute("nr",r);var f=e.resultDocument.createTextNode(n[r]);l.appendChild(f),a.appendChild(l),u=s+n[r].length}if(u<n[0].length){var c=e.resultDocument.createTextNode(n[0].substring(u,s));a.appendChild(c)}i.appendChild(a)}else{var a=e.resultDocument.createElementNS(o,"non-match"),c=e.resultDocument.createTextNode(t.string);a.appendChild(c),i.appendChild(a)}}),Iter.Singleton(i)},apply:function(t){var e=t[0].next(),r=t[1].next();return Iter.ForArray(e.get(r.value[0][0]))},"available-environment-variables":function(t){return Iter.Empty},avg:function(t){var e=t[0].mapOneToOne(g.untypedToDouble),r=e.next();if(null==r)return Iter.Empty;var n={sum:r,count:1},o=Calculate["a+a"],i=f(e,n,function(t,e){return{sum:o(e.sum,t),count:e.count+1}});return Iter.Singleton(Calculate["a/a"](i.sum,Atomic.integer.fromNumber(i.count)))},"base-uri":function(t){return t[0].mapOneToOne(function(t){var e=v.baseURI(t);return null==e?null:Atomic.anyURI.fromString(e)})},"boolean":function(t){return Iter.oneBoolean(g.ebv(t[0]))},ceiling:function(t){var e=t[0].next();return Iter.Singleton(null==e?null:e.ceiling())},"codepoint-equal":function(t){var e=t[0].next(),r=t[1].next();return null==e||null==r?Iter.Empty:Iter.oneBoolean(e.toString()===r.toString())},"codepoints-to-string":function(t){return Iter.oneString(g.codepointsToString(t[0].expand().map(function(t){return t.toNumber()})))},"collation-key":function(t){return Iter.Singleton(t[0].next())},collection:function(t){return Iter.Empty},compare:function(t){var e=t[0].next(),r=t[1].next();return null==e||null==r?Iter.Empty:(u(t[2]),Iter.oneInteger(e.compareTo(r)))},concat:function(t){return Iter.oneString(t.map(function(t){var e=t.next();return null==e?"":Atomic.string.cast(e)}).join(""))},contains:function(t){var e=s(t[0]),r=s(t[1]);return u(t[2]),Iter.oneBoolean(-1!=e.indexOf(r))},"contains-token":function(t){var e=s(t[0]),r=s(t[1]);return u(t[2]),Iter.oneBoolean(e.split(/\s+/).findIndex(function(t){return t==r})>=0)},count:function(t){return Iter.oneInteger(t[0].count())},"current-date":function(t,e){return Iter.Singleton(Atomic.date.fromDate(e.fixed.currentDate,-e.fixed.currentDate.getTimezoneOffset()))},"current-dateTime":function(t,e){return Iter.Singleton(Atomic.dateTime.fromDate(e.fixed.currentDate,-e.fixed.currentDate.getTimezoneOffset()))},"current-time":function(t,e){return Iter.Singleton(Atomic.time.fromDate(e.fixed.currentDate,-e.fixed.currentDate.getTimezoneOffset()))},data:function(t){return t[0].mapOneToOne(g.atomize)},dateTime:function(t){var e=t[0].next(),r=t[1].next();if(null==e||null==r)return Iter.Empty;var n="";if(null!=e.timezoneOffset)if(null==r.timezoneOffset)n=e.tzOffsetToString();else if(null!=r.timezoneOffset&&e.timezoneOffset!=r.timezoneOffset)throw new XError("timezones are incompatible ","FORG0005");return Iter.Singleton(Atomic.dateTime.fromString(e.toString().substring(0,10)+"T"+r.toString()+n))},"day-from-date":function(t){return p(t,"getUTCDate")},"day-from-dateTime":function(t){return p(t,"getUTCDate")},"days-from-duration":function(t){return h(t,2)},"deep-equal":function(t,e){return u(t[2]),Iter.oneBoolean(Compare.deepEqualSequences(t[0],t[1]))},"default-collation":function(t,e){return Iter.oneString("http://www.w3.org/2005/xpath-functions/collation/codepoint")},"default-language":function(t,e){return Iter.oneString("en")},"distinct-values":function(t,e){u(t[1]);var r=new HashTrie;return r.options.sameKey=Compare.deepEqualItems,t[0].filter(function(t){return r.containsKey(t)?!1:(r.inSituPut(t,!0),!0)})},doc:function(t,n,o){var i=r(t,n,o);if(null==i)return Iter.Singleton(null);var a=e(i,n),u=SaxonJS.getSpaceStripper();return null!=u&&(a=u(a)),Iter.Singleton(a)},"doc-available":function(t,n,i){var a=r(t,n,i);return null===a?Iter.oneBoolean(!1):o(function(){e(a,n)})},document:function(t,r,n){var o;if(t[1]){var i=v.baseURI(t[1].next());i&&(o=i)}return null==o&&(o=g.staticBaseUri(n,r)),t[0].mapOneToMany(function(t){var n=v.isNode(t)?v.baseURI(t):o;return g.atomize(t).mapOneToOne(function(t){if(null==n)throw new XError("No base URI for document('"+t+"')");return e(SaxonJS.getPlatform().resolveUri(t.toString(),n),r)})})},"document-uri":function(t){var e=t[0].next();return null!=e&&e.nodeType==v.DOCUMENT_NODE&&e._saxonDocumentUri?Iter.Singleton(Atomic.anyURI.fromString(e._saxonDocumentUri)):Iter.Empty},"element-available":function(t,e){i(t[0],expr,"XTDE1440").split("}");return Iter.oneBoolean(!0)},"element-with-id":function(t,e){var r=s(t[0]);return Iter.Singleton(ownerDocument(e.focus.current).getElementById(r))},empty:function(t){return Iter.oneBoolean(null==t[0].next())},"encode-for-uri":function(t){var e=encodeURIComponent(s(t[0])).replace(/[!'()*]/g,function(t){return"%"+t.charCodeAt(0).toString(16).toUpperCase()});return Iter.oneString(e)},"ends-with":function(t){var e=s(t[0]),r=s(t[1]);return u(t[2]),Iter.oneBoolean(e.substring(e.length-r.length)==r)},"environment-variable":function(t){return Iter.Empty},error:function(t){throw new XError("fn:error() invoked","FOER0000")},"escape-html-uri":function(t){return a(t,function(t){return 32>t||t>126})},"exactly-one":function(t){var e=t[0].expand();if(1!=e.length)throw new XError("Required length 1, actual length "+e.length,"FORG0005");return Iter.Singleton(e[0])},exists:function(t){return Iter.oneBoolean(null!=t[0].next())},"false":function(t){return Iter.oneBoolean(!1)},floor:function(t){return t[0].mapOneToOne(function(t){return t.floor()})},"format-date":function(t,e){return t[2]?Iter.oneString(Numberer.formatDateTime("date",t[0].next(),t[1].next().toString(),t[2].next(),t[3].next(),t[4].next())):Iter.oneString(Numberer.formatDateTime("date",t[0].next(),t[1].next().toString()))},"format-dateTime":function(t,e){return t[2]?Iter.oneString(Numberer.formatDateTime("dateTime",t[0].next(),t[1].next().toString(),t[2].next(),t[3].next(),t[4].next())):Iter.oneString(Numberer.formatDateTime("dateTime",t[0].next(),t[1].next().toString()))},"format-integer":function(t){var e=t[0].next();return null==e?Iter.oneString(""):Iter.oneString(Numberer.formatInteger(e,t[1].next().toString()))},"format-number":function(t,e,r){var n=null;t[2]&&(n=i(t[2],r,"XTDE1260"));var o=t[0].next();return o=null==o?Number.NaN:o.toDouble().value,Iter.oneString(Numberer.formatNumber(o,t[1].next().toString(),n,e))},"format-time":function(t,e){return t[2]?Iter.oneString(Numberer.formatDateTime("time",t[0].next(),t[1].next().toString(),t[2].next(),t[3].next(),t[4].next())):Iter.oneString(Numberer.formatDateTime("time",t[0].next(),t[1].next().toString()))},"function-available":function(t,e,r){var n=!1,o=i(t[0],r,"XTDE1400","http://www.w3.org/2005/xpath-functions"),a=t[1]?t[1].next().toNumber():-1;if(e.fixed.userFunctions[o+"#"+a])n=!0;else{var u=Atomic.QName.fromEQName(o),s=SaxonJS.getPlatform().readResource("opt/functions.json"),c=JSON.parse(s),l=c[u.uri];n=l&&l[u.local]?a>=0?l[u.local].indexOf(a)>=0:!0:!1}return Iter.oneBoolean(n)},"generate-id":function(t,e){var r=t[0].next();if(null==r)return Iter.oneString("");var n,o=Axis.ancestorOrSelf(r).expand().reverse(),i="";for(n=0;n<o.length;n++){var a;o[n]instanceof NamespaceNode?i+="N"+o[n].prefix:o[n].nodeType==v.ATTRIBUTE_NODE?i+="A"+v.nameOfNode(o[n]).local:(a=Axis.precedingSibling(o[n]).count()+1,i+=Numberer.formatInteger(a,n%2==0?"a":"A"))}return i="d"+v.documentNumber(o[0],e)+i,Iter.oneString(i)},"has-children":function(t){return Iter.oneBoolean(null!=Axis.child(t[0].next()).next())},head:function(t){return Iter.Singleton(t[0].next())},"hours-from-dateTime":function(t){return p(t,"getUTCHours")},"hours-from-duration":function(t){return h(t,3)},"hours-from-time":function(t){return p(t,"getUTCHours")},id:function(t,e){var r=s(t[0]),n=t[1]?t[1].next():v.ownerDocument(e.focus.current);return Iter.Singleton(n.getElementById(r))},idref:function(){return Iter.Empty},"implicit-timezone":function(t,e){return Iter.Singleton(Atomic.dayTimeDuration.fromNumberOfMinutes(-e.fixed.currentDate.getTimezoneOffset()))},"index-of":function(t){var e=Iter.Tracker(t[0]),r=t[1].next();return e.mapOneToOne(function(t){try{return t.equals(r)?Atomic.integer.fromNumber(e.position):null}catch(n){return null}})},innermost:function(t){var e=[];return t[0].forEachItem(function(t){e.length>0&&Axis.ancestor(t).some(function(t){return t==e[e.length-1]})&&e.pop(),e.push(t)}),Iter.ForArray(e)},"in-scope-prefixes":function(t){var e=t[0].next();return Iter.ForArray(v.inScopeNamespaces(e).map(function(t){return Atomic.string.fromString(t.prefix)}))},"insert-before":function(t,e){var r=t[1].next().value,n=t[2],o=Iter.Tracker(t[0]);
return 1>r?Iter.Join([n,o]):r>o.last()?Iter.Join([o,n]):o.mapOneToMany(function(e){return o.position==r?Iter.Join([t[2],Iter.Singleton(e)]):Iter.Singleton(e)})},"iri-to-uri":function(t){return a(t,function(t,e){return 32>=t||t>126||/[<>"{}|\\\^`]/.test(e)})},"json-doc":function(t,e,n){var o=r(t,e,n);if(!o)return Iter.Empty;var i=SaxonJS.getPlatform().readFile(o,"utf-8"),a=t[1]?t[1].next():null;return Iter.Singleton(ConvertJson.parseToMap(i,a))},"json-to-xml":function(t,e,r){var n=t[0].next().toString(),o=t[1]?t[1].next():null,i=ConvertJson.parseToXml(n,o,e),a=new DocumentFragment;return a.appendChild(i),Iter.Singleton(a)},key:function(t,e,r){var n=i(t[0],r,"XTDE1260"),o=e.fixed.keys[n];if(!o)throw new XError("Unknown key "+n,"XTDE1260",r);var a,u;if(t[2]?(a=t[2].next(),u=v.ownerDocument(a)):(a=v.ownerDocument(e.focus.current),u=a),null==u)throw new XError("No containing document for key()","XTDE1270",r);"_saxonIndexes"in u||(u._saxonIndexes={});var s=u._saxonIndexes,c=s[n];if(!c){c=new HashTrie,s[n]=c;var l,f=v.getChildElements(o)[0];if("p.nodeSet"==f.tagName){var m=e.newContext(!0);m.focus=Iter.Tracker(Iter.Singleton(u)),m.focus.next(),l=g.evaluate(v.getChildElements(f)[0],m)}else{var p=makePattern(f);l=Axis.descendantOrSelf(u).filter(function(t){return p(t,e)})}for(var h,d=v.getChildElements(o)[1],x=e.newContext(!0);null!=(h=l.next());){x.focus=Iter.Tracker(Iter.Singleton(h)),x.focus.next();for(var y,b=g.evaluate(d,x);null!=(y=b.next());){if(c.containsKey(y)){var E=c.get(y);-1==E.indexOf(h)&&c.get(y).push(h)}else c.inSituPut(y,[h])}}}var N=t[1];return N.mapOneToMany(function(t){if(c.containsKey(t)){var e=Iter.ForArray(c.get(t));return u==a?e:e.filter(function(t){return null!=Axis.ancestorOrSelf(t).filter(function(t){return t==a}).next()})}return Iter.Empty})},lang:function(t,e){var r=e.focus.current,n=t[0].next().value.toLowerCase(),o=Axis.ancestorOrSelf(r).filter(function(t){return t.nodeType==v.ELEMENT_NODE&&t.hasAttribute("xml:lang")}),i=o.next();if(!i)return Iter.oneBoolean(!1);var a=i.getAttribute("xml:lang").toLowerCase(),u=n==a||a.length>n.length+1&&a.substring(0,n.length)==n&&"-"==a.charAt(n.length);return Iter.oneBoolean(u)},last:function(t,e){return Iter.oneInteger(e.focus.last())},"load-xquery-module":function(){throw new XError("No XQuery processor available","FOQM0006")},"local-name":function(t,e){var r=v.nameOfNode(t[0].next());return Iter.oneString(r?r.local:"")},"local-name-from-QName":function(t){var e=t[0].next();return null==e?Iter.Empty:Iter.oneString(e.local)},"lower-case":function(t){return Iter.oneString(s(t[0]).toLowerCase())},matches:function(t,e){var r=s(t[0]),n=t[1].next().toString(),o=Regex.prepareRegex(n,t[2]?t[2].next():null,r);return Iter.oneBoolean(r.search(o)>=0)},max:m("max"),min:m("min"),"minutes-from-dateTime":function(t){return p(t,"getUTCMinutes")},"minutes-from-duration":function(t){return h(t,4)},"minutes-from-time":function(t){return p(t,"getUTCMinutes")},"month-from-date":function(t){return p(t,"getUTCMonth")},"month-from-dateTime":function(t){return p(t,"getUTCMonth")},"months-from-duration":function(t){return h(t,1)},name:function(t,e){var r=v.nameOfNode(t[0].next());return Iter.oneString(r?r.toString():"")},"namespace-uri":function(t,e){var r=v.nameOfNode(t[0].next());return Iter.oneString(r?r.uri:"")},"namespace-uri-for-prefix":function(t){var e=s(t[0]),r=t[1].next(),n="xml"==e?"http://www.w3.org/XML/1998/namespace":r.lookupNamespaceURI(e);return Iter.Singleton(Atomic.anyURI.fromString(n))},"namespace-uri-from-QName":function(t){var e=t[0].next();return null==e?Iter.Empty:Iter.oneString(e.uri)},nilled:function(t){var e=t[0].next();return e&&e.nodeType==v.ELEMENT_NODE?Iter.oneBoolean(!1):Iter.Empty},"node-name":function(t,e){return Iter.Singleton(v.nameOfNode(t[0].next()))},"normalize-space":function(t){var e=s(t[0]);return Iter.oneString(e.replace(/\s+/g," ").replace(/^\s|\s$/g,""))},"normalize-unicode":function(t){if(String.normalize){var e=s(t[0]),r=t[1].next().toString();if("NFC"==r||"NFD"==r||"NFKC"==r||"NFKD"==r)return Iter.oneString(e.normalize(r));if(""==r)return singleStringiterator(e)}throw new XError("normalize-unicode(): not supported on this Javascript platform","FOCH0003")},not:function(t){return Iter.oneBoolean(!g.ebv(t[0]))},number:function(t){var e=t[0].next(),r=Atomic["double"];if(null==e)e=r.fromNumber(Number.NaN);else try{e=r.fromString(e.toString())}catch(n){e=r.fromNumber(Number.NaN)}return Iter.Singleton(e)},"one-or-more":function(t){var e=Iter.LookAhead(t[0]);if(null==e.peek())throw new XError("Required length >= 1, actual length zero","FORG0004");return e},outermost:function(t,e,r){var n=g.hasFlag(r,"p"),o=t[0];n||(o=v.inDocumentOrder(o));var i=null;return o.filter(function(t){return null==i?(print("OK: first"),i=t,!0):null==Axis.ancestor(t).filter(function(t){return t===i}).next()?(i=t,!0):!1})},"parse-ietf-date":function(t){return t[0].mapOneToOne(function(t){var e=function(){throw new XError("Invalid IETF date/time "+t.toString(),"FORG0010")},r=function(t){return 1==t.length?"0"+t:t},n=t.toString().trim().toLowerCase();n=n.replace(/^(monday|tuesday|wednesday|thursday|friday|saturday|sunday|mon|tue|wed|thu|fri|sat|sun),?\s+/,"");var o,i,a,u,s,c,l;/^[a-z]/.test(n)?(o=/^([a-z]{3})(?:\s*\-\s*|\s+)(\d\d\d?\d?)\s+([\d:\.]+)\s*([a-z]+|[+\-]\d\d?:?(?:\d\d)?(?:\s*\(\s*[a-z]+\s*\))?)?\s+(\d+)$/,i=o.exec(n),null!=i?(a=i[1],u=i[2],c=i[3],l=i[4],s=i[5]):e()):(o=/^(\d+)(?:\s*\-\s*|\s+)([a-z]{3})(?:\s*\-\s*|\s+)(\d\d\d?\d?)\s+([\d:\.]+)\s*([a-z]+|[+\-]\d\d?:?(?:\d\d)?(?:\s*\(\s*[a-z]+\s*\))?)?$/,i=o.exec(n),null!=i?(u=i[1],a=i[2],s=i[3],c=i[4],l=i[5]):e()),2==s.length&&(s="19"+s);var f="jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec".indexOf(a);0>f&&e();var m={ut:"Z",utc:"Z",gmt:"Z",est:"-05:00",edt:"-04:00",cst:"-06:00",cdt:"-05:00",mst:"-07:00",mdt:"-06:00",pst:"-08:00",pdt:"-07:00"};/^[0-9]:/.test(c)&&(c="0"+c),5==c.length&&(c+=":00"),l&&(l=l.replace(/\s*\(\s*[a-z]+\s*\)\s*/,""),/^[+\-][0-9](:|$)/.test(l)&&(l=l.substring(0,1)+"0"+l.substring(1)),l in m?l=m[l]:3==l.length?l+=":00":4==l.length?l+="00":5==l.length&&(l=l.substring(0,3)+":"+l.substring(3)));var p=s+"-"+r((f/4+1).toString())+"-"+r(u)+"T"+c+(l||"Z");return Atomic.dateTime.fromString(p)})},"parse-json":function(t){var e=t[0].next().toString(),r=t[1]?t[1].next():null;return Iter.Singleton(ConvertJson.parseToMap(e,r))},"parse-xml":function(t,e,r){var n=t[0].next().toString();print("parse-xml:"+n);var o=SaxonJS.getPlatform().parseXmlFromString(n);return o._saxonBaseUri=g.staticBaseUri(r,e),Iter.Singleton(o)},"parse-xml-fragment":function(t,e,r){return t[0].mapOneToOne(function(t){var n=/^<\?xml(?:\s+version\s*=\s*(['"])1.[0-9]+['"])?\s+encoding\s*=\s*(['"][A-Za-z](?:[A-Za-z0-9._\-])*)['"]\s*\?>/,o=t.toString().replace(n,"");print("content: "+o);var i=SaxonJS.getPlatform().parseXmlFromString("<z>"+o+"</z>"),a=new DocumentFragment;return Axis.child(i.documentElement).forEachItem(function(t){a.appendChild(t)}),a._saxonBaseUri=g.staticBaseUri(r,e),a})},path:function(t){return t[0].mapOneToOne(function(t){var e="";return Axis.ancestorOrSelf(t).forEachItem(function(t){var r,n=function(t){return Axis.precedingSibling(t).filter(function(e){return t.nodeType==e.nodeType})},o=function(t){return 1+n(t).count()};switch(t.nodeType){case v.DOCUMENT_NODE:case v.DOCUMENT_FRAGMENT_NODE:default:break;case v.ELEMENT_NODE:r=v.nameOfNode(t),e="/"+r.toEQName()+"["+(1+n(t).filter(function(t){return v.nameOfNode(t).equals(r)}).count())+"]"+e;break;case v.TEXT_NODE:e="/text()["+o(t)+"]";break;case v.COMMENT_NODE:e="/comment()["+o(t)+"]";break;case v.PROCESSING_INSTRUCTION_NODE:e="/processing-instruction("+t.target+")["+(1+n(t).filter(function(e){return t.target==e.target}).count())+"]";break;case v.ATTRIBUTE_NODE:e="/@"+(t.name.indexOf(":")<0?t.name:v.nameOfNode(t).toEQName())}}),Atomic.string.fromString(e)})},"prefix-from-QName":function(t){return t[0].mapOneToOne(function(t){return Atomic.string.fromString(t.prefix)})},position:function(t,e){return Iter.oneInteger(e.focus.position)},QName:function(t,e){var r=t[1].next().value.split(":"),n=2==r.length?r[0]:"",o=s(t[0]),i=2==r.length?r[1]:r[0];return Iter.Singleton(Atomic.QName.fromParts(n,o,i))},"regex-group":function(t,e){var r=t[0].next().toNumber();try{return Iter.oneString(e.focus.regexGroups[r]||"")}catch(n){return Iter.oneString("")}},remove:function(t,e){var r=t[1].next().toNumber(),n=Iter.Tracker(t[0]);return n.filter(function(t){return n.position!=r})},replace:function(t,e){var r=s(t[0]),n=t[3]?t[3].next():"",o=Regex.prepareRegex(t[1].next().toString(),n+"g");if(o.test(""))throw new XError("Regular expression matches zero-length string","FORX0003");var i=Regex.convertReplacement(t[2].next().toString(),n);return Iter.oneString(r.replace(o,i))},"resolve-QName":function(t){var e=t[1].next();return t[0].mapOneToOne(function(t){try{return v.resolveLexicalQName(e,t.toString(),!0)}catch(r){throw r instanceof XError&&"FORG0001"==r.code&&(r.code=Regex.isQName(t)?"FONS0004":"FOCA0002"),r}})},"resolve-uri":function(t,e,r){var n=t[1]?t[1].next().toString():g.staticBaseUri(r,e),o=t[0].next();if(null==o)return Iter.Empty;n=n.replace(/^file:\/(?!\/)/,"file:///");var i=new URI(o.toString(),n).toString();return Iter.oneString(i)},reverse:function(t,e){return Iter.ForArray(t[0].expand().reverse())},root:function(t){return t[0].mapOneToMany(function(t){return Axis.ancestorOrSelf(t)}).filter(function(t){return null==v.xdmParentNode(t)})},round:function(t){return t[0].mapOneToOne(function(e){return e.round(t[1]?t[1].next().value:0)})},"round-half-to-even":function(t){return t[0].mapOneToOne(function(e){return e.roundHalfToEven(t[1]?t[1].next().value:0)})},"seconds-from-dateTime":function(t){return p(t,"seconds")},"seconds-from-duration":function(t){return h(t,5)},"seconds-from-time":function(t){return p(t,"seconds")},serialize:function(t){return Iter.oneString(g.serialize(t[0],t[1]?t[1].next():void 0))},"starts-with":function(t){var e=s(t[0]),r=s(t[1]);return Iter.oneBoolean(e.substring(0,r.length)==r)},"static-base-uri":function(t,e,r){return g.staticBaseUri(r,e)},"stream-available":function(){return Iter.oneBoolean(!1)},string:function(t){var e=t[0].next();return e?g.atomize(e).mapOneToOne(function(t){return Atomic.string.cast(t)}):Iter.oneString("")},"string-join":function(t){for(var e,r="",n=t[1]?t[1].next().value:"",o=!0;null!=(e=t[0].next());)o||(r+=n),r+=e.toString(),o=!1;return Iter.oneString(r)},"string-length":function(t){return Iter.oneInteger(c(t[0]).length)},"string-to-codepoints":function(t){return Iter.ForArray(c(t[0]).map(Atomic.integer.fromNumber))},subsequence:function(t){return Iter.ForArray(l(t[0].expand(),t[1],t[2]))},substring:function(t){var e=c(t[0]);return Iter.oneString(g.codepointsToString(l(e,t[1],t[2])))},"substring-after":function(t){var e,r="",n=s(t[0]),o=s(t[1]);return-1!=(e=n.indexOf(o))&&(r=n.substring(e+o.length)),Iter.oneString(r)},"substring-before":function(t){var e,r="",n=s(t[0]),o=s(t[1]);return-1!=(e=n.indexOf(o))&&(r=n.substring(0,e)),Iter.oneString(r)},sum:function(t){var e=t[0].mapOneToOne(g.untypedToDouble),r=e.next();return null==r?1==t.length?Iter.oneInteger(0):t[1]:(Calculate["a+a"](r,r),Iter.Singleton(f(e,r,Calculate["a+a"])))},"system-property":function(t,e,r){var n,o=Atomic.QName.fromEQName(i(t[0],r,"XTDE1390"));return"http://www.w3.org/1999/XSL/Transform"==o.uri&&(n={version:"3.0",vendor:"Saxonica","vendor-url":"http://www.saxonica.com/","product-name":"Saxon-JS","product-version":"9.8","is-schema-aware":"no","supports-serialization":"no","supports-backwards-compatibility":"yes","supports-namespace-axis":"yes","supports-streaming":"no","supports-dynamic-evaluation":"no","supports-higher-order-functions":"no","xpath-version":"3.1","xsd-version":"1.1"}[o.local]),Iter.oneString(n||"")},tail:function(t){var e=Iter.Tracker(t[0]);return e.filter(function(){return 1!=e.position})},"timezone-from-date":function(t){return p(t,"timezone")},"timezone-from-dateTime":function(t){return p(t,"timezone")},"timezone-from-time":function(t){return p(t,"timezone")},tokenize:function(t,e){var r=s(t[0]);if(""==r)return Iter.Empty;var n=t[1]?t[1].next().toString():"[ \\n\\r\\t]+",o=Expr.analyze(r,n,t[2]?t[2].next().toString():"",!1),i=t[1]&&o[0].matching,a=o[o.length-1],u=t[1]&&a.matching,c=o.filter(function(t){return!t.matching}),l=c.map(function(t){return t.string});return i&&l.unshift(Atomic.string.fromString("")),u&&l.push(Atomic.string.fromString("")),Iter.ForArray(l)},trace:function(t){var e=t[0].expand();return print((t[1]?t[1].next().toString()+": ":"")+showValue(e)),Iter.ForArray(e)},transform:function(t){throw new XError("No XSLT processor available","FOXT0001")},translate:function(t){var e=c(t[0]),r=c(t[1]),n=c(t[2]),o=[];return e.forEach(function(t){var e;-1!=(e=r.indexOf(t))?e<n.length&&o.push(n[e]):o.push(t)}),Iter.oneString(g.codepointsToString(o))},"true":function(){return Iter.oneBoolean(!0)},"type-available":function(t,e,r){var n=i(t[0],r,"XTDE1428").split("}");return"Q{http://www.w3.org/2001/XMLSchema"==n[0]&&n[1]in Atomic},unordered:function(t,e){return t[0]},"unparsed-entity-public-id":function(t,e){return Iter.Empty},"unparsed-entity-uri":function(t,e){return Iter.Empty},"unparsed-text":function(t,e,r){return Iter.oneString(n(t,e,r))},"unparsed-text-available":function(t,e,r){return o(function(){n(t,e,r)})},"unparsed-text-lines":function(t,e,r){var o=n(t,e,r);return Iter.ForArray(o.split(/\r?\n/)).mapOneToOne(function(t){return Atomic.string.fromString(t)})},"upper-case":function(t){return Iter.oneString(s(t[0]).toUpperCase())},"uri-collection":function(t){return Iter.Empty},"xml-to-json":function(t){var e=t[1]?t[1].next():new HashTrie;return t[0].mapOneToOne(function(t){return Atomic.string.fromString(ConvertJson.xmlToJson(t,e))})},"year-from-date":function(t){return p(t,"getUTCFullYear")},"year-from-dateTime":function(t){return p(t,"getUTCFullYear")},"years-from-duration":function(t){return h(t,0)},"zero-or-one":function(t){var e=t[0].expand();if(e.length>1)throw new XError("Required length 0-1, actual length "+e.length,"FORG0003");return Iter.Singleton(e[0])}}}(),ExtraFn=function(){"use strict";var mathFunction=function(t,e,r,n){function o(t){return null==t?(s=!0,Number.NaN):t.toNumber()}function i(){return o(Expr.evalChild1(n,r).next())}function a(){return o(Expr.evalChild2(n,r).next())}function u(){switch(t){case"pi":return Math.PI;case"exp":return Math.exp(i());case"exp10":return Math.pow(10,i());case"log":return Math.log(i());case"log10":return Math.log(i())/Math.LN10;case"pow":return Math.pow(i(),a());case"sqrt":return Math.sqrt(i());case"sin":return Math.sin(i());case"cos":return Math.cos(i());case"tan":return Math.tan(i());case"asin":return Math.asin(i());case"acos":return Math.acos(i());case"atan":return Math.atan(i());case"atan2":return Math.atan2(i(),a());default:throw new XError("Unknown math function "+n.getAttribute("name"),"XPST0017")}}var s=!1,c=u();return s?Iter.Empty:Iter.oneDouble(c)},mapFunction=function(t,e){var r={contains:function(t){var e=t[0].next(),r=t[1].next();return Iter.oneBoolean(e.containsKey(r))},create:function(t){var e=new HashTrie;return t[0].forEachItem(function(t){t.forAllPairs(function(t){e.inSituPut(t.k,t.v)})}),Iter.Singleton(e)},get:function(t){var e=t[0].next(),r=t[1].next();return Iter.ForArray(e.get(r))},entry:function(t){var e=new HashTrie;return e.inSituPut(t[0].next(),t[1].expand()),Iter.Singleton(e)},keys:function(t){var e=t[0].next();return Iter.ForArray(e.keys())},merge:function(t){var e=new HashTrie;return t[0].forEachItem(function(t){t.forAllPairs(function(t){e.inSituPut(t.k,t.v)})}),Iter.Singleton(e)},_new:function(t){var e=new HashTrie;return t[0].forEachItem(function(t){t.forAllPairs(function(t){if(e.containsKey(t.k))throw XError("Duplicate key value '"+t.k.toString()+"'","XQDY0137");e.inSituPut(t.k,t.v)})}),Iter.Singleton(e)},put:function(t){var e=t[0].next(),r=t[1].next(),n=t[2].expand();return Iter.Singleton(e.put(r,n))},remove:function(t){var e=t[0].next();return t[1].forEachItem(function(t){e=e.remove(t)}),Iter.Singleton(e)},size:function(t){var e=t[0].next(),r=0;return e.forAllPairs(function(){r++}),Iter.oneInteger(r)},"untyped-contains":function(t){var e=t[0].next(),r=t[1].next();return Iter.oneBoolean(e.containsKey(r))}};if(!r[t])throw"Unknown map function: "+t;return r[t](e)},arrayFunction=function(t,e){function r(t,e){if(1>t||t>e)throw new XError("Array index ("+t+") out of bounds (1 to "+e+")","FOAY0001")}function n(t){return t[0].next().value}function o(t){return t[1].next().toNumber()}function i(t){return Iter.Singleton(new Expr.XdmArray(t))}var a={"_to-sequence":function(t){var e=[];return n(t).forEach(function(t){t.forEach(function(t){e.push(t)})}),Iter.ForArray(e)},"_from-sequence":function(t){var e=[];return t[0].forEachItem(function(t){e.push([t])}),i(e)},size:function(t){return Iter.oneInteger(n(t).length)},get:function(t){var e=n(t),i=o(t);return r(i,e.length),Iter.ForArray(e[i-1])},append:function(t){return i(n(t).concat([t[1].expand()]))},subarray:function(t){var e=n(t),a=o(t);r(a,e.length+1);var u=t[2]?t[2].next().toNumber():e.length-a+1;return XError.test(0>u,"Length is negative","FOAY0002"),r(a+u,e.length+1),i(e.slice(a-1,a+u-1))},remove:function(t){var e=n(t),o=[];return t[1].forEachItem(function(t){var n=t.toNumber();r(n,e.length),o.push(n-1)}),i(e.filter(function(t,e){return o.indexOf(e)<0}))},put:function(t){var e=n(t),a=o(t);r(a,e.length);var u=t[2].expand();return i(e.slice(0,a-1).concat([u]).concat(e.slice(a)))},"insert-before":function(t){var e=n(t),a=o(t);r(a,e.length+1);var u=t[2].expand();return i(e.slice(0,a-1).concat([u]).concat(e.slice(a-1)))},head:function(t){var e=n(t);return r(1,e.length),Iter.ForArray(e[0])},tail:function(t){var e=n(t);return r(1,e.length),i(e.slice(1))},reverse:function(t){return i(n(t).slice().reverse())},join:function(t){var e=[];return t[0].forEachItem(function(t){t.value.forEach(function(t){e.push(t)})}),i(e)},sort:function(t){function e(t,e){var r=function(t){return Iter.ForArray(t).mapOneToMany(Expr.atomize)};return Compare.lexicographicCompare(r(t),r(e))}return i(n(t).slice().sort(e))},flatten:function(t){return Expr.flatten(t[0])}};if(!a[t])throw"Unknown array function: "+t;return a[t](e)},interactiveFunction=function(local,args,context,expr){function getProp(t,e){for(var r=e.split("."),n=t,o=0;o<r.length;o++){try{n=n[r[o]]}catch(i){}if("undefined"==typeof n||""==n)return}return n}var f={page:function(){return Iter.Singleton(window.document)},source:function(t,e){return Iter.Singleton(e.fixed.globalContextItem)},window:function(){return Iter.Singleton(window)},call:function(t){var e=t[0].next(),r=t[1].next().toString(),n=getProp(e,r);if("undefined"==typeof n)throw new XError("ixsl:call: object method not found");var o=Expr.convertToJS(t[2].next()),i=o.length;if(n.length!=i)throw new XError("ixsl:call: wrong number of args supplied for function "+n.name);var a=n.apply(null,o);if(null==a||"undefined"==typeof a)return Iter.Empty;var u=Expr.convertFromJS(a);return Array.isArray(u)?Iter.ForArray(u):Iter.Singleton(u)},eval:function(args){return Iter.Singleton(eval(args[0].next().toString()))},event:function(t,e){return Iter.Singleton(e.currentEvent)},get:function(t){var e=t[0].next(),r=t[1].next().toString(),n=getProp(e,r);return Iter.Singleton(Expr.convertFromJS(n))},location:function(){return Iter.Singleton(Atomic.string.fromString(window.location.toString()))},style:function(t){var e=t[0].next(),r=window.getComputedStyle(e);return Iter.Singleton(Expr.convertFromJS(r))},map:function(t){var e=t[0].next(),r=new JWLTrie;r.source=function(t){var r=getProp(e,t);return"string"==typeof r||"boolean"==typeof r?[Atomic.untypedAtomic.fromString(r.toString())]:"number"==typeof r?[Atomic.integer.fromNumber(r)]:r};var n=["checked","style.display","style.color","width","foobar"];for(i=0;i<n.length;i++){var o=n[i];if("selectionStart"==o)var i=0;var a=getProp(e,o);if(void 0!==a){a=convertFromJS(a);var u=convertFromJS(o);null!=u&&r.inSituPut(u,a)}}return Iter.Singleton(r)},"query-params":function(){for(var t,e=/\+/g,r=/([^&=]+)=?([^&]*)/g,n=function(t){return Atomic.string.fromString(decodeURIComponent(t.replace(e," ")))},o=window.location.search.substring(1),i=new HashTrie;t=r.exec(o);)i.inSituPut(n(t[1]),[n(t[2])]);return Iter.Singleton(i)},"remove-attribute":function(t,e,r){var n=t[0].next().toString(),o=Atomic.QName.fromString(n,Expr.stylesheetResolver(r,!1)),i=e.focus.current;if(!(i instanceof HTMLElement))throw new XError("Context item for ixsl:remove-attribute must be an HTML element node","XXXX9999",r);return i.removeAttribute(o.local),Iter.Empty},"schedule-action":function(){throw new XError("ixsl:schedule-action - shouldn't be here")},"set-attribute":function(t,e,r){var n=t[0].next().toString(),o=t[1].next().toString(),i=Atomic.QName.fromString(n,Expr.stylesheetResolver(r,!1));if(null==i)throw new XError("Invalid attribute name "+n,"XTDE1260",r);var a=e.focus.current;if(!(a instanceof HTMLElement))throw new XError("Context item for ixsl:set-attribute must be an HTML element node","XXXX9999",r);return"http://saxonica.com/ns/html-property"===i.uri?a[i.local]=o:"http://saxonica.com/ns/html-style-property"==i.uri?a.style[i.local]=o:a.setAttribute(i.local,o),Iter.Empty},"set-property":function(t,e,r){for(var n=t[0].next().toString(),o=Expr.convertToJS(t[1].next()),i=t[2].next(),a=n.split("."),u=i,s=0;s<a.length-1;s++){try{u=u[a[s]]}catch(c){}if("undefined"==typeof u||""==u)return print("set-property fail"),Iter.Empty}return u[a[a.length-1]]=o,Iter.Empty},"set-style":function(t,e,r){var n=t[0].next().toString(),o=Expr.convertToJS(t[1].next()),i=t[2]?t[2].next():e.focus.current;return i.style[n]=o,Iter.Empty}};if(!f[local])throw"Unknown ixsl function: "+local;return f[local](args,context,expr)},saxonFunction=function(t,e,r,n){var o={"dynamic-error-info":function(t){var e=r.currentError;if(null==e)return Iter.Empty;var n=t[0].next().toString();switch(n){case"description":return Iter.oneString(e.message);case"code":return Iter.Singleton(Atomic.QName.fromParts("err","http://www.w3.org/2005/xqt-errors",e.code));case"value":return null;case"module":return Iter.oneString(e.xsltModule);case"line-number":return Iter.oneInteger(e.xsltLineNr);case"column-number":return Iter.oneInteger(-1);default:throw"unknown error info field "+n}},"parse-XPath":function(t){var e,r=t[0].next().toString(),n="parse";t.length>1&&(n=t[1].next().toString()),t.length>2&&(e=t[2]);var o=SaxonJS.XPath.parse(r,n,e);return o}};if(!o[t])throw"Unknown saxon function: "+t;return o[t](e,r,n)};return function(t,e,r,n,o){switch(t){case"http://www.w3.org/2005/xpath-functions/math":return mathFunction(e,r,n,o);case"http://www.w3.org/2005/xpath-functions/map":return mapFunction(e,r);case"http://www.w3.org/2005/xpath-functions/array":return arrayFunction(e,r);case"http://saxonica.com/ns/interactiveXSLT":return interactiveFunction(e,r,n,o);case"http://saxon.sf.net/":return saxonFunction(e,r,n,o);default:throw"Unknown namespace "+t}}}();JWLTrie.prototype=Object.create(HashTrie.prototype),JWLTrie.prototype.get=function(t){var e=HashTrie.prototype.get.call(this,t);return e instanceof Array&&0==e.length&&(e=this.source(t.value),void 0!==e&&HashTrie.prototype.inSituPut.call(this,t,e)),e};var Calculate=function(){"use strict";function t(t){return Math.abs(t)<Math.pow(2,52)}function e(t,e){return i.matches(t)&&i.matches(e)?i:o}function r(t,e,r){function s(t){return Atomic.dateTime.matches(t)||Atomic.date.matches(t)||Atomic.time.matches(t)}var c,l,f,m=Atomic.dayTimeDuration,p=Atomic.yearMonthDuration;if((m.matches(t)||p.matches(t))&&Atomic.numeric.matches(e))f="u"+r+"n",c=t.type,l=e.type;else if((m.matches(e)||p.matches(e))&&Atomic.numeric.matches(t))f="n"+r+"u",c=t.type,l=e.type;else if(i.matches(t)&&i.matches(e))f="i"+r+"i",c=l="integer";else if(n.matches(t)||n.matches(e))f="d"+r+"d",c=l="double";else if(a.matches(t)||a.matches(e))f="f"+r+"f",c=l="float";else if(o.matches(t)||o.matches(e))f="c"+r+"c",c=l="decimal";else if(s(t)&&s(e))f="t"+r+"t",c=t.type,l=e.type;else if(s(t)&&(m.matches(e)||p.matches(e)))f="t"+r+"u",c=t.type,l=e.type;else if((m.matches(t)||p.matches(t))&&s(e))f="u"+r+"t",c=t.type,l=e.type;else{if(!(m.matches(t)&&m.matches(e)||p.matches(t)&&p.matches(e)))throw new XError("Arithmetic operation '"+r+"' not available for operands "+t.type+" and "+e.type,"XPTY0004");f="u"+r+"u",c=l=t.type}if(!u[f])throw new XError("Arithmetic operation '"+r+"' not available for operands "+t.type+" and "+e.type,"XPTY0004");return u[f](Expr.promote(t,c),Expr.promote(e,l))}var n=Atomic["double"],o=Atomic.decimal,i=Atomic.integer,a=Atomic["float"],u={"d+d":function(t,e){var r=t.toNumber(),o=e.toNumber();return n.fromNumber(r+o)},"d-d":function(t,e){var r=t.toNumber(),o=e.toNumber();return n.fromNumber(r-o)},"d*d":function(t,e){var r=t.toNumber(),o=e.toNumber();return n.fromNumber(r*o)},"d/d":function(t,e){var r=t.toNumber(),o=e.toNumber();return n.fromNumber(r/o)},"d%d":function(t,e){var r=t.toNumber(),o=e.toNumber();return isNaN(r)||isNaN(o)||r==1/0||r==-(1/0)||0==o?n.fromNumber(NaN):o==1/0||o==-(1/0)?t:0==r?t:n.fromNumber(r%o)},"d~d":function(e,r){try{var o=e.toNumber(),a=r.toNumber(),u=n.fromNumber(Math.trunc(o/a));if(u==1/0||u==-(1/0)||isNaN(u))throw new XError("Division by zero","FOAR0001");return u=t(u)?i.fromNumber(u):u}catch(s){throw new XError("Division by zero","FOAR0001")}},"f+f":function(t,e){var r=t.toNumber(),n=e.toNumber();return a.fromNumber(r+n)},"f-f":function(t,e){var r=t.toNumber(),n=e.toNumber();return a.fromNumber(r-n)},"f*f":function(t,e){var r=t.toNumber(),n=e.toNumber();return a.fromNumber(r*n)},"f/f":function(t,e){var r=t.toNumber(),n=e.toNumber();return a.fromNumber(r/n)},"f%f":function(t,e){var r=t.toNumber(),n=e.toNumber();if(isNaN(r)||isNaN(n)||r==1/0||r==-(1/0)||0==n)return a.fromNumber(NaN);if(n==1/0||n==-(1/0))return t;if(0==r)return t;var o=a.fromNumber(r%n);if(o==1/0||o==-(1/0)||isNaN(o))throw new XError("Division by zero","FOAR0001");return o},"f~f":function(e,r){try{var n=e.toNumber(),o=r.toNumber(),u=a.fromNumber(Math.trunc(n/o));if(u==1/0||u==-(1/0)||isNaN(u))throw new XError("Division by zero","FOAR0001");return u=t(u)?i.fromNumber(u):u}catch(s){throw new XError("Division by zero","FOAR0001")}},"i+i":function(e,r){var n=e.toNumber()+r.toNumber();return t(n)?i.fromNumber(n):i.fromBig(Big(e.toBig().plus(r.toBig())))},"i-i":function(e,r){var n=e.toNumber()-r.toNumber();return t(n)?i.fromNumber(n):i.fromBig(Big(e.toBig().minus(r.toBig())))},"i*i":function(e,r){var n=e.toNumber()*r.toNumber();return t(n)?i.fromNumber(n):i.fromBig(Big(e.toBig().times(r.toBig())))},"i/i":function(t,e){try{var r=t.toBig(),n=e.toBig();return o.fromBig(r.div(n))}catch(i){throw new XError("Division by zero","FOAR0001")}},"i%i":function(e,r){var n=e.toNumber(),o=r.toNumber();if(isNaN(n)||isNaN(o)||n==1/0||n==-(1/0)||0==o)return i.fromNumber(NaN);if(o==1/0||o==-(1/0))return e;if(0==n)return e;var a=e.toNumber()%r.toNumber();if(a==1/0||a==-(1/0)||isNaN(a))throw new XError("Division by zero","FOAR0001");return t(a)?i.fromNumber(a):i.fromBig(Big(e.toBig().mod(r.toBig())))},"i~i":function(e,r){var n=e.toNumber()/r.toNumber();if(n==1/0||n==-(1/0)||isNaN(n))throw new XError("Division by zero","FOAR0001");return t(n)?i.fromNumber(Math.trunc(n)):i.fromBig(Big(e.toBig().div(r.toBig())).round(0,0))},"c+c":function(t,r){var n=t.toBig(),o=r.toBig();return e(t,r).fromBig(n.plus(o))},"c-c":function(t,r){var n=t.toBig(),o=r.toBig();return e(t,r).fromBig(n.minus(o))},"c*c":function(t,r){var n=t.toBig(),o=r.toBig();return e(t,r).fromBig(n.times(o))},"c/c":function(t,e){try{var r=t.toBig(),n=e.toBig();return o.fromBig(r.div(n))}catch(i){throw new XError("Division by zero","FOAR0001")}},"c%c":function(t,e){try{var r=t.toBig(),n=e.toBig();return o.fromBig(r.mod(n))}catch(i){throw new XError("Division by zero","FOAR0001")}},"c~c":function(e,r){try{var n=e.toBig(),a=r.toBig(),u=n.div(a).round(0,0);return t(u)?i.fromNumber(u):o.fromBig(u)}catch(s){throw new XError("Division by zero","FOAR0001")}},"a+a":function(t,e){return r(t,e,"+")},"a-a":function(t,e){return r(t,e,"-")},"a*a":function(t,e){return r(t,e,"*")},"a/a":function(t,e){return r(t,e,"/")},"a%a":function(t,e){return r(t,e,"%")},"a~a":function(t,e){return r(t,e,"~")},"u+u":function(t,e){var r=Atomic.dayTimeDuration,n=Atomic.yearMonthDuration;if(!(r.matches(t)&&r.matches(e)||n.matches(t)&&n.matches(e)))throw new XError("Cannot add "+t.type+" and "+e.type,"XPTY0004");if(n.matches(t))return n.fromMonthsMilliseconds(t.months+e.months,0);if(r.matches(t))return r.fromMonthsMilliseconds(0,t.milliseconds+e.milliseconds);throw"problem in u+u"},"u-u":function(t,e){var r=Atomic.dayTimeDuration,n=Atomic.yearMonthDuration;if(!(r.matches(t)&&r.matches(e)||n.matches(t)&&n.matches(e)))throw new XError("Cannot subtract "+t.type+" minus "+e.type,"XPTY0004");if(n.matches(t))return n.fromMonthsMilliseconds(t.months-e.months,0);if(r.matches(t))return r.fromMonthsMilliseconds(0,t.milliseconds-e.milliseconds);throw"problem in u-u"},"u*n":function(t,e){var r=e.toNumber();if(r==1/0||r==-(1/0))throw new XError("Cannot multiply duration by +/-INF","FODT0002");if(isNaN(r))throw new XError("Cannot multiply duration by NaN","FOCA0005");var n=Atomic.dayTimeDuration,o=Atomic.yearMonthDuration;if(o.matches(t))return o.fromMonthsMilliseconds(Math.round(t.months*r),0);if(n.matches(t))return n.fromMonthsMilliseconds(0,Math.round(t.milliseconds*r));throw"problem in u*n"},"n*u":function(t,e){return Calculate["u*n"](e,t)},"u/n":function(t,e){var r,n=Atomic.dayTimeDuration,o=Atomic.yearMonthDuration;if(o.matches(t)){if(r=t.months/e.toNumber(),r==1/0||r==-(1/0)||isNaN(r))throw new XError("Division by zero","FODT0002");return o.fromMonthsMilliseconds(Math.round(t.months/e.toNumber()),0)}if(n.matches(t)){if(r=t.milliseconds/e.toNumber(),r==1/0||r==-(1/0)||isNaN(r))throw new XError("Division by zero","FODT0002");return n.fromMonthsMilliseconds(0,Math.round(t.milliseconds/e.toNumber()))}if(Atomic.duration.matches(t))throw new XError("Arithmetic not available for xs:duration","XPTY0004");throw"problem in u/n"},"u/u":function(t,e){var r=Atomic.dayTimeDuration,n=Atomic.yearMonthDuration;if(!(r.matches(t)&&r.matches(e)||n.matches(t)&&n.matches(e)))throw new XError("Cannot divide "+t.type+" by "+e.type,"XPTY0004");var i,a;n.matches(t)?(i=new Big(t.months),a=new Big(e.months)):r.matches(t)&&(i=new Big(t.milliseconds),a=new Big(e.milliseconds));try{return o.fromBig(i.div(a))}catch(u){throw new XError("Division by zero","FOAR0001")}},"t+u":function(t,e){if(Atomic.dayTimeDuration.matches(e))return Atomic[t.type].fromDate(new Date(t.UTCdate.getTime()+e.milliseconds),t.timezoneOffset);if(Atomic.yearMonthDuration.matches(e))return t.addMonths(e.months);throw"problem in t+u"},"u+t":function(t,e){return Calculate["t+u"](e,t)},"t-u":function(t,e){if(Atomic.dayTimeDuration.matches(e))return Atomic[t.type].fromDate(new Date(t.UTCdate.getTime()-e.milliseconds),t.timezoneOffset);if(Atomic.yearMonthDuration.matches(e))return t.addMonths(-e.months);throw"problem in t-u"},"t-t":function(t,e){return Atomic.dayTimeDuration.fromMonthsMilliseconds(0,t.UTCdate.getTime()-e.UTCdate.getTime())}};return u}(),Numberer=function(){function t(t,e){function r(t){var e,r;if(""==t&&(t="1"),/^[\x01-\x7f]*$/.test(t))e=t.split(/\b/),r=function(t,e){return/\w+/.test(t)};else{if(t.length!=o.stringToCodepoints(t).length)throw XError("Cannot handle non-BMP characters in format-number picture","SXER0003");var n=o.analyze(t,"[\\p{Nd}\\p{Nl}\\p{No}\\p{Lu}\\p{Ll}\\p{Lt}\\p{Lm}\\p{Lo}]+","",!0);r=function(t,e){return n[e].matching},e=n.map(function(t){return t.string.toString()})}var i,a={prefix:"",fTokens:[],suffix:""},u=".";for(i=0;i<e.length;i++){var s=e[i];r(s,i)?(a.fTokens.push({chars:s,sep:u}),u="."):(0==i&&(a.prefix=s),i==e.length-1?a.suffix=s:0!=i&&(u=s))}return 0==a.fTokens.length&&(a.fTokens.push({chars:"1",sep:"."}),a.suffix=a.prefix),a}function n(n){var i=o.argRole(t,"format"),a=null==i?"1":o.evaluate(i,e).next().toString(),u=o.evaluateIfPresent(o.argRole(t,"gpSep"),e).next(),s=o.evaluateIfPresent(o.argRole(t,"gpSize"),e).next(),c=o.evaluateIfPresent(o.argRole(t,"ordinal"),e).next(),l=r(a),f=l.prefix;
return n.forEach(function(t,e){var r=e>=l.fTokens.length?l.fTokens[l.fTokens.length-1]:l.fTokens[e];0!=e&&(f+=r.sep);var n=r.chars;"yes"==c&&(n+=";o");var o=Numberer.formatInteger(t,n);null!=u&&null!=s&&(o=Numberer.addGroupingSeparators(o,u,s)),f+=o}),f+=l.suffix,Iter.oneString(f)}var o=Expr,i=DomUtils,a=o.evaluateIfPresent(o.argRole(t,"lang"),e).next();if(null!=a)try{Atomic.language.cast(a)}catch(u){throw XError("@lang="+a+": invalid language code","XTDE0030")}var s=t.getAttribute("flags")||"",c=/1/.test(s),l=o.argRole(t,"startAt"),f=[1];null!=l&&(f=o.evaluate(l,e).next().toString().split(/\s+/).map(function(t){return parseInt(t)}));var m=o.argRole(t,"value");if(null!=m){var p=o.evaluate(m,e);if(c){var h=p.next();if(null==h)return Iter.oneString("NaN");try{h=Atomic.integer.cast(h.round(0))}catch(u){return Iter.oneString("NaN")}p=Iter.ForArray([h])}var d=function(t,e){if(t=Atomic.numeric.matches(t)?t.toDouble():Atomic["double"].fromStringUnfailing(t.toString()),t.toNumber()<0)throw XError("xsl:number/@value is less than zero","XTDE0980");try{t=Atomic.integer.cast(t.round(0))}catch(r){throw r.code="XTDE0980",r}var n=e>=f.length?f[f.length-1]:f[e];return 1!=n&&(t=Atomic.integer.fromNumber(t.toNumber()+(n-1))),t},g=p.mapOneToOne(d);return n(g.expand())}var v,x=t.getAttribute("level"),y=o.argRole(t,"select");v=y?o.evaluate(y,e).next():e.focus.current;var b=i.nameOfNode(v),E=function(t){return null==i.xdmParentNode(t)},N=function(t){return t.nodeType==v.nodeType&&(null==b?!0:i.nameOfNode(t).equals(b))},S=o.argRole(t,"count"),w=N;if(null!=S){var A=makePattern(S);w=function(t){return A(t,e)}}var T,I=o.argRole(t,"from");if(null==I)T=E;else{var D=makePattern(I);T=function(t){return E(t)||D(t,e)}}var O,_,C,U;switch(x){case"simple":return O=Axis.precedingSibling(v).filter(N),n([O.count()+f[0]]);case"single":return _=Axis.ancestorOrSelf(v).filter(w).next(),U=Axis.ancestorOrSelf(v).filter(T).next(),C=null==_?null:null!=Axis.ancestorOrSelf(_).filter(function(t){return i.isSameNode(t,U)}).next()?_:null,null==C?n([]):(O=Axis.precedingSibling(C).filter(w),n([O.count()+f[0]]));case"multi":_=Iter.ForArray(Axis.ancestorOrSelf(v).filter(w).expand().reverse()),U=Axis.ancestorOrSelf(v).filter(T).next(),C=_.filter(function(t){var e=Axis.ancestorOrSelf(t).filter(function(t){return i.isSameNode(t,U)});return null!=e.next()});var M=Atomic.integer.fromNumber,P=C.mapOneToOne(function(t,e){return M(Axis.precedingSibling(t).filter(w).count()+(e>=f.length?f[f.length-1]:f[e]))});return n(P.expand());case"any":var F=function(t,e){return i.compareDocumentOrder(e,t)};_=Iter.Union(Axis.preceding(v).filter(w),Axis.ancestorOrSelf(v).filter(w),F),U=Iter.Union(Axis.preceding(v).filter(T),Axis.ancestorOrSelf(v).filter(T),F).next(),null==U&&internalError("from pattern selected empty"),C=_.filter(function(t){return i.compareDocumentOrder(t,U)>=0});var X=C.count();return n(0==X?[]:[X-1+f[0]]);default:internalError("unknown xsl:number/@level "+x,t)}return Iter.Empty}function e(t){if(1>t||t>4999)return t.toString();var e,r="",n=["m","cm","d","cd","c","xc","l","xl","x","ix","v","iv","i"],o=[1e3,900,500,400,100,90,50,40,10,9,5,4,1];for(e=0;e<n.length;e++)for(;t>=o[e];)r+=n[e],t-=o[e];return r}function r(t,e){function r(t){return(t>n?r(Math.floor((t-1)/n)):"")+e.charAt((t-1)%n)}if(1>t)return t.toString();var n=e.length;return r(t)}function n(t,e){return t<e.length?e[t]:t.toString()}function o(t,e){for(var r=Math.abs(t),n=999999>r?r.toString():Big(r).toFixed();n.length<e;)n="0"+n;return 0>t&&(n="-"+n),n}function i(t){var e,r=Expr,n=r.stringToCodepoints(t),o={},i=!0,a=0,u=Regex.prepareRegex("\\p{Nd}",null),s=t.search(u);if(0>s)i=!1;else{var c,l=Regex.obtainCategoryEscapes().Nd;for(e=0;e<l.length;e++){var f=l[e];if(c=parseInt(f[0],16),c<=n[s]&&n[s]<=c+10)break}for(e=0;e<n.length;e++)if(n[e]>=128){var m=String.fromCharCode(n[e]);if(u.test(m)){if(c>n[e]||n[e]>c+10)throw new XError("Picture string mixes digits from different digit families: "+t,"FODF1310")}else{var p=Regex.prepareRegex("\\p{N}\\p{L}",null);if(p.test(m))throw new XError("Picture string is invalid: "+t,"FODF1310")}}var h=[];a=c-48,n.forEach(function(t){t>=c&&c+10>=t?h.push(48):h.push(t)}),t=r.codepointsToString(h)}return o.isDecimalDigitPattern=i,o.format=t,o.diff=a,o.zeroDigit=c,o}function a(t,e){var r=[];return Expr.stringToCodepoints(t).forEach(function(t){t>=48&&57>=t?r.push(t+e):r.push(t)}),Expr.codepointsToString(r)}function u(t,e,r,n,o){var i,a=0,u=t;for(i=0;i<u.length;i++)if(i==e[a]){var s=o?i+1:u.length-i;s>0&&(u=u.substring(0,s)+(r?r[o?a:r.length-a-1]:n)+u.substring(s)),a++}return u}function s(t,e){function r(t,e){if(!/^(([0-9]|#|[^A-Za-z0-9])+?)$/.test(e))throw new XError("The decimal digit pattern in the picture string is invalid: "+e,"FODF1310");var r,n,i=e,a=!0;if(/[^0-9A-Za-z#]/.test(i)){if(r=i.match(/[^0-9A-Za-z#]/g),r.length>1)for(n=1;n<r.length;n++)if(r[0]!=r[n]){a=!1;break}i=i.replace(/[^0-9A-Za-z#]/g,",")}if(/^,|,,|,$/.test(i))throw new XError("Grouping in picture string is invalid: "+e,"FODF1310");if(/[0-9].*#/.test(i))throw new XError("Picture string is invalid: "+e,"FODF1310");var s=i.replace(/[#,]/g,"").length,c=o(t,s);if(null!=r){var l=Expr.stringToCodepoints(i).reverse(),f=[];for(n=0;n<l.length;n++)44==l[n]&&f.push(n);var m=!0;if(l.length-f[f.length-1]-1>f[0]&&(m=!1),m)for(n=1;n<f.length;n++)if((f[n]+1)%(f[0]+1)!=0){m=!1;break}c=m&&a?Numberer.addGroupingSeparators(c,r[0],f[0]):u(c,f,r)}return c}var n=Expr.stringToCodepoints(e),s=!0,c=!0,l=0;if(n.length!=e.length)throw XError("Cannot handle non-BMP characters in format-integer picture","SXER0003");if(/^[\x01-\x7f]*$/.test(e)||(s=!1),s)c=/[0-9]/.test(e);else{var f=i(e);e=f.format,c=f.isDecimalDigitPattern,l=f.diff}c||(e="1");var m=r(t,e);return s||(m=a(m,l)),m}function c(t){var e=["Zero","One","Two","Three","Four","Five","Six","Seven","Eight","Nine","Ten","Eleven","Twelve","Thirteen","Fourteen","Fifteen","Sixteen","Seventeen","Eighteen","Nineteen"],r=["","","Twenty","Thirty","Forty","Fifty","Sixty","Seventy","Eighty","Ninety"];return 20>t?e[t]:100>t?r[Math.floor(t/10)]+(t%10==0?"":" "+e[t%10]):1e3>t?c(Math.floor(t/100))+" Hundred"+(t%100==0?"":" and "+c(t%100)):1e6>t?c(Math.floor(t/1e3))+" Thousand"+(t%1e3==0?"":(100>t%1e3?" and ":" ")+c(t%1e3)):1e9>t?c(Math.floor(t/1e6))+" Million"+(t%1e3==0?"":(100>t%1e3?" and ":" ")+c(t%1e6)):t.toString()}function l(t){var e=["Zeroth","First","Second","Third","Fourth","Fifth","Sixth","Seventh","Eighth","Ninth","Tenth","Eleventh","Twelfth","Thirteenth","Fourteenth","Fifteenth","Sixteenth","Seventeenth","Eighteenth","Nineteenth"],r=["","","Twent","Thirt","Fort","Fift","Sixt","Sevent","Eight","Ninet"];return 20>t?e[t]:100>t?r[Math.floor(t/10)]+(t%10==0?"ieth":"y "+e[t%10]):1e3>t?c(Math.floor(t/100))+" Hundred"+(t%100==0?"th":" and "+l(t%100)):1e6>t?c(Math.floor(t/1e3))+" Thousand"+(t%1e3==0?"th":(100>t%1e3?" and ":" ")+l(t%1e3)):1e9>t?c(Math.floor(t/1e6))+" Million"+(t%1e3==0?"th":(100>t%1e3?" and ":" ")+l(t%1e6)):t.toString()}function f(t){return t%10==1&&t%100!=11?"st":t%10==2&&t%100!=12?"nd":t%10==3&&t%100!=13?"rd":"th"}function m(t,o){function i(t,e){for(var r="",n=t.charCodeAt(0),o=0;e>o;n++,o++)r+=String.fromCharCode(n);return r}var a,u=null;if(-1!=(a=o.lastIndexOf(";"))){if(u=o.substring(a+1),!/^([co](\(.+\))?)?[at]?$/.test(u))throw new XError("Invalid format modifier in picture string: "+u,"FODF1310");u=u.charAt(0),o=o.substring(0,a)}if(""==o)throw new XError("In the picture string, the picture cannot be empty","FODF1310");var m=0>t?"-":"";if("o"==u)switch(o.toString()){case"a":case"A":case"i":case"I":break;case"Ww":return m+l(Math.abs(t));case"W":return m+l(Math.abs(t)).toUpperCase();case"w":return m+l(Math.abs(t)).toLowerCase();default:return s(t,o)+f(Math.abs(t))}switch(o.toString()){case"a":return r(t,i("a",26));case"A":return r(t,i("A",26));case"":return r(t,i("",25));case"":return r(t,i("",25));case"i":return e(t);case"I":return e(t).toUpperCase();case"Ww":return m+c(Math.abs(t));case"W":return m+c(Math.abs(t)).toUpperCase();case"w":return m+c(Math.abs(t)).toLowerCase();case"":return n(t,""+i("",20)+i("",15)+i("",15));case"":return n(t,"0"+i("",20));case"":return n(t,"0"+i("",20));default:return s(t,o)}}function p(t,e,r){var n,o="";for(n=0;n<t.length;n++){var i=t.charAt(n),a=e.indexOf(i);0>a?o+=i:a<r.length&&(o+=r.charAt(a))}return o}function h(t,e){return String.fromCharCode(parseInt(t.getAttribute(e)))}function d(t,e){function r(t){var e=[["$gs","grouping separator"],["$es","exponent separator"],["$ds","decimal separator"],["$pc","non-prefix passive character"],["$pp","percent|permille"],["$od","optional digit"],["$md","mandatory digit"],["$ip","integer part"],["$fp","fractional part"]];throw e.forEach(function(e){t=t.replace(e[0],e[1])}),XError("Invalid picture: "+t,"FODF1310")}var n,o={},i=t.indexOf(e.decimalSeparator),a=i>=0,u=e.zeroDigit.charCodeAt(0),s=0,c=0,l=[],f=[],m=[],p=-1,h=-1,d=!1,g=!1,v=-1,x=0,y=a?i:t.length;for(n=0;y>n;n++){var b=t.charCodeAt(n);b>=u&&u+10>b?(h>0&&r("digit follows $pc"),d?x++:(1>s&&0>p&&(p=n),s++,c++)):b==e.digit.charCodeAt(0)?(h>0&&r("digit follows $pc"),d&&r("$od follows $es"),s>0&&r("$od follows $md in $ip"),0>p&&(p=n,g=!0),c++):b==e.groupingSeparator.charCodeAt(0)?(0>p&&r("$gs before any digit"),m.length>0&&r("$gs follows $pc"),d&&r("$gs follows $es"),l.push(n)):b==e.percent.charCodeAt(0)||b==e.permille.charCodeAt(0)?a?r("$pp before $ds"):(0>p&&r("$pp before any digit"),h>0&&r("$pp follows $pc"),d&&r("$pp follows $es"),m.push(b),0>h&&(h=n),b==e.percent.charCodeAt(0)?o.percent=!0:o.permille=!0):!a&&p>=0&&b==e.exponentSeparator.charCodeAt(0)&&0>h?d?(m.push(b),x>0?0>h&&(h=n):(m.push(b),d=!1,v=-1,0>h&&(h=n-1))):(d=!0,v=n):p>=0&&a?r("$pc before $ds"):d&&0==x?(d=!1,v=-1,m.push(e.exponentSeparator.charCodeAt(0)),m.push(b),0>h&&(h=n-1)):p>=0?(m.push(b),0>h&&(h=n)):f.push(b)}if(l.length>0){var E=a?i:d?v:h>0?h:t.length,N=l.map(function(t){return E-t-1});l=N.reverse()}if(0!=l.length){0==l[0]&&r("$gs at end of $ip");for(var S=0;S<l.length-1;S++)l[S]+1==l[S+1]&&r("consecutive $gs in $ip")}var w=0,A=0,T=[];if(a){var I=-1,D=t.substring(i+1);for(n=0;n<D.length;n++)b=D.charCodeAt(n),b>=u&&u+10>b?d&&0>h?x++:I>=0||h>=0?r("$md follows $od or $pc in $fp"):(w++,A++):b==e.digit.charCodeAt(0)?((h>=0||d)&&r("$od follows $pc or $es"),0>I&&(I=n),A++):b==e.groupingSeparator.charCodeAt(0)?((h>=0||d)&&r("$gs follows $pc or $es"),T.push(n-i+1)):b==e.decimalSeparator.charCodeAt(0)?r("more than one $ds"):b==e.percent.charCodeAt(0)||b==e.permille.charCodeAt(0)?((h>=0||d)&&r("$pp follows $pc or $es"),m.push(b),h=n,b==e.percent.charCodeAt(0)?o.percent=!0:o.permille=!0):b==e.exponentSeparator.charCodeAt(0)&&0>h?d?(m.push(b),x>0?0>h&&(h=n):(m.push(b),d=!1,v=-1,0>h&&(h=n-1))):(d=!0,v=n):d&&0==x?(d=!1,v=-1,m.push(e.exponentSeparator.charCodeAt(0)),m.push(b),0>h&&(h=n-1)):(m.push(b),0>h&&(h=n))}if(0>p&&0==A&&r("mantissa contains no digits"),0!=T.length){0==T[0]&&r("$gs at beginning of $fp");for(var S=0;S<T.length-1;S++)T[S]+1==T[S+1]&&r("consecutive $gs in $fp")}return 0==s&&0==A&&(d?(w=1,A=1):s=1),d&&0==s&&g&&(s=1),0==s&&0==w&&(w=1),o.minimumIntegerPartSize=s,o.prefix=f,o.intGpPos=l,o.picIntPartContainsOptDigit=g,o.picIntPartSize=c,o.minimumFractionalPartSize=w,o.maximumFractionalPartSize=A,o.fracGpPos=T,o.expPartSize=x,o.suffix=m,o}function g(t,e){var r=["January","February","March","April","May","June","July","August","September","October","November","December"],n=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];return"M"==e?r[t-1]:"F"==e?n[t-1]:t}function v(t){var e=new Date(Date.UTC(t.getUTCFullYear(),0,1));return Math.floor((t.getTime()-e.getTime())/864e5)+1}function x(t,e){var r=e?v(t):t.getUTCDate(),n=new Date(Date.UTC(t.getUTCFullYear(),e?0:t.getUTCMonth(),1)),o=n.getUTCDay();if(0==o&&(o=7),o>4&&8>=o+r)return x(new Date(n.getTime()-864e5),e);var i=5>o?1:0;return Math.floor((r+o-2)/7)+i}function y(t){return x(t,!0)}function b(t){return x(t,!1)}function E(t){return t.getUTCHours()<13?0==t.getUTCHours()?12:t.getUTCHours():t.getUTCHours()-12}function N(t){return t.getUTCHours()<12?"Am":"Pm"}function S(t,e,r,n,o,u,s){if(""==t)return"Z"==r?"J":"";var c="z"==e?"GMT":"";if("t"==n&&"+00:00"==t&&"Z"!=r&&"N"!=r)return"Z";if(""==r)return c+t;var l,f=t.match(/^([+\-])([0-9])([0-9]):([0-9]{2})$/);if("Z"==r||"N"==r){if("Z"==r){var m=parseInt(f[1]+f[2]+f[3],10);l=-12>m||m>12||"00"!=f[4]?t:"YXWVUTSRQPONZABCDEFGHIKLM".charAt(m+12)}else if("N"==r)throw"Timezone names not yet implemented"}else{s&&!/[0-9]+/.test(r)&&(r="00:00");var p=function(t,e){return"0"==e[2]&&1==t.length?e[3]:e[2]+e[3]},h=function(t,e){var r="0"!=e[2]||1!=t.length&&3!=t.length?e[2]+e[3]:e[3],n=t.length>2?e[4]:"00"!=e[4]?":"+e[4]:"";return r+n},d=0;if(!s){var g=i(r);r=g.format,d=g.diff}var v;/[^0-9A-Za-z]/.test(r)?(v=r.match(/^([0-9]+)([^0-9A-Za-z])([0-9]+)$/),l=f[1]+p(v[1],f)+v[2]+f[4]):(v=r.match(/^[0-9]+$/),l=f[1]+h(v[0],f)),s||(l=a(l,d))}return c+l}function w(t,e,r,n,o,u){function s(t,e,r,n,o){var u,s=0;if(o&&!/^[0-9]+$/.test(e))e="1";else if(!o){var c=i(e);e=c.format,s=c.diff,/^[0-9]+$/.test(e)||(e="1",o=!1)}var l=3;if(r||n?n&&"*"!=n&&3>n&&(l=parseInt(n,10)):(e.length>1&&(l=e.length),3==l&&3==t.toString().length&&(u=t.toString())),!u){var f="0."+(1e3+t).toString().substring(1),m=Big(f).round(l,1);u=0!=m?m.toString().substring(2):"0";for(var p=r?r:l;u.length<p;)u+="0"}return 1==e.length&&"0"==u.charAt(u.length)&&(u=u.substring(0,u.length-1),"0"==u.charAt(u.length)&&(u=u.substring(0,u.length-1))),o||(u=a(u,s)),u}var c,l=r.match(/^([YMDdWwFHhmsfZzPCE])(.*)$/);if(null==l)throw new XError("Date/time component ["+r+"] not recognised","FOFD1340");var f=l[1],p=l[2]||"";if("date"==t&&/[HhPmsf]/.test(f)||"time"==t&&/[YMDdFWwCE]/.test(f))throw new XError("Date/time component ["+r+"] not available in "+t,"FOFD1350");var h,d,v;if(-1!=(h=p.lastIndexOf(","))){var x=p.substring(h+1).split("-");p=p.substring(0,h),d=x[0],v=x[1]||"*"}var y,b=null;p.length>1&&/[atco]/.test(p.charAt(p.length-1))?(y=p.substring(0,p.length-1),b=p.charAt(p.length-1)):y=p;var E=!0;if(/^[\x01-\x7f]*$/.test(y));else{if(y.length!=Expr.stringToCodepoints(y).length)throw XError("Cannot handle non-BMP characters in date/time formatting picture","SXER0003");E=!1}if(/[Zz]/.test(f)){var N="Z"==e.tzOffsetToString()?"+00:00":e.tzOffsetToString();return S(N,f,y,b,d,v,E)}var w=e.proxy(),A=I[f]?w[I[f]]():D[f]?D[f](w):null;if(null==A)throw"Component specifier not implemented: ["+f+"]";if("M"==f?A++:"F"==f&&0==A&&(A=7),""==y&&(y=/[FPCE]/.test(f)?"n":/[ms]/.test(f)?"01":"1"),"f"==f)return s(A,y,d,v,E);if(/[nN]/.test(y))c=g(A,f),"n"==y?c=c.toLowerCase():"N"==y&&(c=c.toUpperCase()),v&&"*"!=v&&c.length>v&&(c=c.substring(0,v));else{var T=/;/.test(y)?y+";":y;if(b&&(T+=(";"==T.charAt(T.length-1)?"":";")+b),c=m(A,T),"Y"==f&&/[^iIwWnN]/.test(y.charAt(y.length-1))&&(!d&&2==y.length||2==v))for(;c.length>2;)c=c.substring(1);if(d){var O="*"==d?0:parseInt(d,10);if(O>0&&c.length<O)if(/[YMDdWwHhms]/.test(f)&&/[^iIwWnN]/.test(y.charAt(y.length-1))){var _="0";for(E||(_=String.fromCharCode(i(T).zeroDigit));c.length<O;)c=_+c}else{if("Y"!=f||!/[iIwWnN]/.test(y.charAt(y.length-1)))throw"Not implemented min width modification with specifier "+f+" and format "+y;for(;c.length<O;)c+=" "}}}return c}function A(t,e,r,n){var o=0>t?!0:0==t?0>1/t:!1,i=n.fixed.decimalFormats[null!=r?r:"Q{}"];if(!i)throw new XError("Unknown decimal format "+r,"FODF1280");var a={decimalSeparator:h(i,"decimal-separator"),groupingSeparator:h(i,"grouping-separator"),digit:h(i,"digit"),minusSign:h(i,"minus-sign"),percent:h(i,"percent"),permille:h(i,"per-mille"),zeroDigit:h(i,"zero-digit"),exponentSeparator:h(i,"exponent-separator"),patternSeparator:h(i,"pattern-separator"),infinity:i.getAttribute("infinity"),nan:i.getAttribute("NaN")};if(isNaN(t))return a.nan;var s=e.includes(a.patternSeparator)?e.split(a.patternSeparator):[e];if(s.length>2)throw new XError("Invalid picture: multiple pattern separators","FODF1310");var c,l=s.length>1&&0>t?s[1]:s[0],f=d(l,a);if(isFinite(t)){var m;if(f.expPartSize>0)m=T(t,f);else{var g=Math.abs(t);f.percent&&(g=Math.abs(100*t)),f.permille&&(g=Math.abs(1e3*t)),m=g+""=="Infinity"?g+"":999999>g?g.toString():Big(g).toFixed();var v=m.indexOf(".");for(0>v&&(v=m.length,f.minimumFractionalPartSize>0&&(m+="."));v<f.minimumIntegerPartSize;)m="0"+m,v++;if(f.maximumFractionalPartSize>=0&&"."!=m.substring(v)&&v!=m.length)if(f.maximumFractionalPartSize>0){var x=Big(m.substring(v)).round(f.maximumFractionalPartSize,1);m=m.substring(0,v)+x.toString().substring(1)}else m=Big(m).round(0,1).toString();var y=m.length-1-v;if(f.minimumFractionalPartSize>0)for(;y<f.minimumFractionalPartSize;)m+="0",y++;y>0&&0==f.minimumIntegerPartSize&&"0"==m.substring(0,v)&&(m=m.substring(v)),"0"==m&&0==f.minimumIntegerPartSize&&0==f.minimumFractionalPartSize&&f.maximumFractionalPartSize>0&&(m=".0")}var b,E="";for(b=0;10>b;b++)E+=String.fromCharCode(a.zeroDigit.charCodeAt(0)+b);if(E+=a.decimalSeparator,c=p(m,"0123456789.",E),f.intGpPos.length>0||f.fracGpPos.length>0){var N=c.indexOf(a.decimalSeparator);0>N&&(N=c.length);var S=c.substring(0,N),x=c.substring(N);if(f.intGpPos.length>0){for(var w=!0,A=1;A<f.intGpPos.length;A++)if((f.intGpPos[A]+1)%(f.intGpPos[0]+1)!=0){w=!1;break}w&&f.picIntPartSize+f.intGpPos.length-f.intGpPos[f.intGpPos.length-1]-1>f.intGpPos[0]&&(w=!1),S=w?Numberer.addGroupingSeparators(S,a.groupingSeparator,f.intGpPos[0]):u(S,f.intGpPos,null,a.groupingSeparator)}f.fracGpPos.length>0&&(x=u(x,f.fracGpPos,null,a.groupingSeparator,!0)),c=S+x}}else c=a.infinity;return f.prefix.length>0&&(c=Expr.codepointsToString(f.prefix)+c),f.suffix.length>0&&(c+=Expr.codepointsToString(f.suffix)),o&&1==s.length&&(c=a.minusSign+c),c}function T(t,e){var r=e.minimumIntegerPartSize,n=e.minimumFractionalPartSize,i=e.maximumFractionalPartSize;1==r&&e.picIntPartContainsOptDigit&&(r=0,0==n&&(n=1,0==i&&(i=1)));var a=e.expPartSize,u=Big(t),s=u.c,c=0!=r?r+n:n,l=0!=r?r+i:i;for(s.length>l&&(u=Big(u.toPrecision(l))),r>1?u=u.div(Big(10).pow(r-1)):0==r&&(u=u.times(Big(10))),s=u.c;s.length<c;)s.push(0);var f="";if(!(s.length>0))throw"empty mantissa";if(0==r&&e.picIntPartContainsOptDigit)f+="0";else for(var m=0;r>m;m++)f+=s[m];return i>0&&s.length>r&&(f+="."+s.join("").slice(r)),f+"e"+o(u.e,a)}var I={Y:"getUTCFullYear",M:"getUTCMonth",D:"getUTCDate",F:"getUTCDay",H:"getUTCHours",m:"getUTCMinutes",s:"getUTCSeconds",f:"getUTCMilliseconds"},D={d:v,W:y,w:b,h:E,P:N,E:function(){return"AD"}};return{xslNumber:t,formatInteger:m,addGroupingSeparators:function(t,e,r){var n="",o=0;for(o=0;o<t.length;o++)n+=t.charAt(o),(1==r||(t.length-o)%r==1)&&o<t.length-1&&(n+=e);return n},formatNumber:A,formatDateTime:function(t,e,r,n,o,i){function a(r){return"[["==r?"[":"]]"==r?"]":w(t,e,r.substring(1,r.length-1).replace(/\s+/g,""),n,o,i)}if(!/\[(\[|[^\]]*\])|\]\]/g.test(r))throw XError("Date format picture doesn't match required syntax","FOFD1340");return r.replace(/\[(\[|[^\]]*\])|\]\]/g,a)}}}();!function(t){"use strict";function e(){function t(r){var o=this;return o instanceof t?(r instanceof t?(o.s=r.s,o.e=r.e,o.c=r.c.slice()):n(o,r),void(o.constructor=t)):void 0===r?e():new t(r)}return t.prototype=p,t.DP=u,t.RM=s,t.E_NEG=f,t.E_POS=m,t}function r(t,e,r){var n=t.constructor,i=e-(t=new n(t)).e,a=t.c;for(a.length>++e&&o(t,i,n.RM),a[0]?r?i=e:(a=t.c,i=t.e+i+1):++i;a.length<i;a.push(0));return i=t.e,1===r||r&&(i>=e||i<=n.E_NEG)?(t.s<0&&a[0]?"-":"")+(a.length>1?a[0]+"."+a.join("").slice(1):a[0])+(0>i?"e":"e+")+i:t.toString()}function n(t,e){var r,n,o;for(0===e&&0>1/e?e="-0":h.test(e+="")||i(NaN),t.s="-"==e.charAt(0)?(e=e.slice(1),-1):1,(r=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(0>r&&(r=n),r+=+e.slice(n+1),e=e.substring(0,n)):0>r&&(r=e.length),n=0;"0"==e.charAt(n);n++);if(n==(o=e.length))t.c=[t.e=0];else{for(;"0"==e.charAt(--o););for(t.e=r-n-1,t.c=[],r=0;o>=n;t.c[r++]=+e.charAt(n++));}return t}function o(t,e,r,n){var o,a=t.c,u=t.e+e+1;if(1===r?n=a[u]>=5:2===r?n=a[u]>5||5==a[u]&&(n||0>u||a[u+1]!==o||1&a[u-1]):3===r?n=n||a[u]!==o||0>u:(n=!1,0!==r&&i("!Big.RM!")),1>u||!a[0])n?(t.e=-e,t.c=[1]):t.c=[t.e=0];else{if(a.length=u--,n)for(;++a[u]>9;)a[u]=0,u--||(++t.e,a.unshift(1));for(u=a.length;!a[--u];a.pop());}return t}function i(t){var e=new Error(t);throw e.name="BigError",e}var a,u=20,s=1,c=1e6,l=1e6,f=-7,m=21,p={},h=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;p.abs=function(){var t=new this.constructor(this);return t.s=1,t},p.cmp=function(t){var e,r=this,n=r.c,o=(t=new r.constructor(t)).c,i=r.s,a=t.s,u=r.e,s=t.e;if(!n[0]||!o[0])return n[0]?i:o[0]?-a:0;if(i!=a)return i;if(e=0>i,u!=s)return u>s^e?1:-1;for(i=-1,a=(u=n.length)<(s=o.length)?u:s;++i<a;)if(n[i]!=o[i])return n[i]>o[i]^e?1:-1;return u==s?0:u>s^e?1:-1},p.div=function(t){var e=this,r=e.constructor,n=e.c,a=(t=new r(t)).c,u=e.s==t.s?1:-1,s=r.DP;if((s!==~~s||0>s||s>c)&&i("!Big.DP!"),!n[0]||!a[0])return n[0]==a[0]&&i(NaN),a[0]||i(u/0),new r(0*u);var l,f,m,p,h,d,g=a.slice(),v=l=a.length,x=n.length,y=n.slice(0,l),b=y.length,E=t,N=E.c=[],S=0,w=s+(E.e=e.e-t.e)+1;for(E.s=u,u=0>w?0:w,g.unshift(0);b++<l;y.push(0));do{for(m=0;10>m;m++){if(l!=(b=y.length))p=l>b?1:-1;else for(h=-1,p=0;++h<l;)if(a[h]!=y[h]){p=a[h]>y[h]?1:-1;break}if(!(0>p))break;for(f=b==l?a:g;b;){if(y[--b]<f[b]){for(h=b;h&&!y[--h];y[h]=9);--y[h],y[b]+=10}y[b]-=f[b]}for(;!y[0];y.shift());}N[S++]=p?m:++m,y[0]&&p?y[b]=n[v]||0:y=[n[v]]}while((v++<x||y[0]!==d)&&u--);return N[0]||1==S||(N.shift(),E.e--),S>w&&o(E,s,r.RM,y[0]!==d),E},p.eq=function(t){return!this.cmp(t)},p.gt=function(t){return this.cmp(t)>0},p.gte=function(t){return this.cmp(t)>-1},p.lt=function(t){return this.cmp(t)<0},p.lte=function(t){return this.cmp(t)<1},p.sub=p.minus=function(t){var e,r,n,o,i=this,a=i.constructor,u=i.s,s=(t=new a(t)).s;if(u!=s)return t.s=-s,i.plus(t);var c=i.c.slice(),l=i.e,f=t.c,m=t.e;if(!c[0]||!f[0])return f[0]?(t.s=-s,t):new a(c[0]?i:0);if(u=l-m){for((o=0>u)?(u=-u,n=c):(m=l,n=f),n.reverse(),s=u;s--;n.push(0));n.reverse()}else for(r=((o=c.length<f.length)?c:f).length,u=s=0;r>s;s++)if(c[s]!=f[s]){o=c[s]<f[s];break}if(o&&(n=c,c=f,f=n,t.s=-t.s),(s=(r=f.length)-(e=c.length))>0)for(;s--;c[e++]=0);for(s=e;r>u;){if(c[--r]<f[r]){for(e=r;e&&!c[--e];c[e]=9);--c[e],c[r]+=10}c[r]-=f[r]}for(;0===c[--s];c.pop());for(;0===c[0];)c.shift(),--m;return c[0]||(t.s=1,c=[m=0]),t.c=c,t.e=m,t},p.mod=function(t){var e,r=this,n=r.constructor,o=r.s,a=(t=new n(t)).s;return t.c[0]||i(NaN),r.s=t.s=1,e=1==t.cmp(r),r.s=o,t.s=a,e?new n(r):(o=n.DP,a=n.RM,n.DP=n.RM=0,r=r.div(t),n.DP=o,n.RM=a,this.minus(r.times(t)))},p.add=p.plus=function(t){var e,r=this,n=r.constructor,o=r.s,i=(t=new n(t)).s;if(o!=i)return t.s=-i,r.minus(t);var a=r.e,u=r.c,s=t.e,c=t.c;if(!u[0]||!c[0])return c[0]?t:new n(u[0]?r:0*o);if(u=u.slice(),o=a-s){for(o>0?(s=a,e=c):(o=-o,e=u),e.reverse();o--;e.push(0));e.reverse()}for(u.length-c.length<0&&(e=c,c=u,u=e),o=c.length,i=0;o;)i=(u[--o]=u[o]+c[o]+i)/10|0,u[o]%=10;for(i&&(u.unshift(i),++s),o=u.length;0===u[--o];u.pop());return t.c=u,t.e=s,t},p.pow=function(t){var e=this,r=new e.constructor(1),n=r,o=0>t;for((t!==~~t||-l>t||t>l)&&i("!pow!"),t=o?-t:t;1&t&&(n=n.times(e)),t>>=1,t;)e=e.times(e);return o?r.div(n):n},p.round=function(t,e){var r=this,n=r.constructor;return null==t?t=0:(t!==~~t||0>t||t>c)&&i("!round!"),o(r=new n(r),t,null==e?n.RM:e),r},p.sqrt=function(){var t,e,r,n=this,a=n.constructor,u=n.c,s=n.s,c=n.e,l=new a("0.5");if(!u[0])return new a(n);0>s&&i(NaN),s=Math.sqrt(n.toString()),0===s||s===1/0?(t=u.join(""),t.length+c&1||(t+="0"),e=new a(Math.sqrt(t).toString()),e.e=((c+1)/2|0)-(0>c||1&c)):e=new a(s.toString()),s=e.e+(a.DP+=4);do r=e,e=l.times(r.plus(n.div(r)));while(r.c.slice(0,s).join("")!==e.c.slice(0,s).join(""));return o(e,a.DP-=4,a.RM),e},p.mul=p.times=function(t){var e,r=this,n=r.constructor,o=r.c,i=(t=new n(t)).c,a=o.length,u=i.length,s=r.e,c=t.e;if(t.s=r.s==t.s?1:-1,!o[0]||!i[0])return new n(0*t.s);for(t.e=s+c,u>a&&(e=o,o=i,i=e,c=a,a=u,u=c),e=new Array(c=a+u);c--;e[c]=0);for(s=u;s--;){for(u=0,c=a+s;c>s;)u=e[c]+i[s]*o[c-s-1]+u,e[c--]=u%10,u=u/10|0;e[c]=(e[c]+u)%10}for(u&&++t.e,e[0]||e.shift(),s=e.length;!e[--s];e.pop());return t.c=e,t},p.toString=p.valueOf=p.toJSON=function(){var t=this,e=t.constructor,r=t.e,n=t.c.join(""),o=n.length;if(r<=e.E_NEG||r>=e.E_POS)n=n.charAt(0)+(o>1?"."+n.slice(1):"")+(0>r?"e":"e+")+r;else if(0>r){for(;++r;n="0"+n);n="0."+n}else if(r>0)if(++r>o)for(r-=o;r--;n+="0");else o>r&&(n=n.slice(0,r)+"."+n.slice(r));else o>1&&(n=n.charAt(0)+"."+n.slice(1));return t.s<0&&t.c[0]?"-"+n:n},p.toExponential=function(t){return null==t?t=this.c.length-1:(t!==~~t||0>t||t>c)&&i("!toExp!"),r(this,t,1)},p.toFixed=function(t){var e,n=this,o=n.constructor,a=o.E_NEG,u=o.E_POS;return o.E_NEG=-(o.E_POS=1/0),null==t?e=n.toString():t===~~t&&t>=0&&c>=t&&(e=r(n,n.e+t),n.s<0&&n.c[0]&&e.indexOf("-")<0&&(e="-"+e)),o.E_NEG=a,o.E_POS=u,e||i("!toFix!"),e},p.toPrecision=function(t){return null==t?this.toString():((t!==~~t||1>t||t>c)&&i("!toPre!"),r(this,t-1,2))},a=e(),"function"==typeof define&&define.amd?define(function(){return a}):"undefined"!=typeof module&&module.exports?module.exports=a:t.Big=a}(this),function(t,e){"use strict";"object"==typeof exports?module.exports=e(require("./punycode"),require("./IPv6"),require("./SecondLevelDomains")):"function"==typeof define&&define.amd?define(["./punycode","./IPv6","./SecondLevelDomains"],e):t.URI=e(t.punycode,t.IPv6,t.SecondLevelDomains,t)}(this,function(t,e,r,n){"use strict";function o(t,e){var r=arguments.length>=1,n=arguments.length>=2;if(!(this instanceof o))return r?n?new o(t,e):new o(t):new o;if(void 0===t){if(r)throw new TypeError("undefined is not a valid argument for URI");t="undefined"!=typeof location?location.href+"":""}return this.href(t),void 0!==e?this.absoluteTo(e):this}function i(t){return t.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function a(t){return void 0===t?"Undefined":String(Object.prototype.toString.call(t)).slice(8,-1)}function u(t){return"Array"===a(t)}function s(t,e){var r,n,o={};if("RegExp"===a(e))o=null;else if(u(e))for(r=0,n=e.length;n>r;r++)o[e[r]]=!0;else o[e]=!0;for(r=0,n=t.length;n>r;r++){var i=o&&void 0!==o[t[r]]||!o&&e.test(t[r]);i&&(t.splice(r,1),n--,r--)}return t}function c(t,e){var r,n;if(u(e)){for(r=0,n=e.length;n>r;r++)if(!c(t,e[r]))return!1;return!0}var o=a(e);for(r=0,n=t.length;n>r;r++)if("RegExp"===o){if("string"==typeof t[r]&&t[r].match(e))return!0}else if(t[r]===e)return!0;return!1}function l(t,e){if(!u(t)||!u(e))return!1;if(t.length!==e.length)return!1;t.sort(),e.sort();for(var r=0,n=t.length;n>r;r++)if(t[r]!==e[r])return!1;return!0}function f(t){var e=/^\/+|\/+$/g;return t.replace(e,"")}function m(t){return escape(t)}function p(t){return encodeURIComponent(t).replace(/[!'()*]/g,m).replace(/\*/g,"%2A")}function h(t){return function(e,r){return void 0===e?this._parts[t]||"":(this._parts[t]=e||null,this.build(!r),this)}}function d(t,e){return function(r,n){return void 0===r?this._parts[t]||"":(null!==r&&(r+="",r.charAt(0)===e&&(r=r.substring(1))),this._parts[t]=r,this.build(!n),this)}}var g=n&&n.URI;o.version="1.17.0";var v=o.prototype,x=Object.prototype.hasOwnProperty;o._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,duplicateQueryParameters:o.duplicateQueryParameters,escapeQuerySpace:o.escapeQuerySpace}},o.duplicateQueryParameters=!1,o.escapeQuerySpace=!0,o.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,o.idn_expression=/[^a-z0-9\.-]/i,o.punycode_expression=/(xn--)/i,o.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,o.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,o.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?]))/gi,o.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?]+$/},o.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},o.invalid_hostname_characters=/[^a-zA-Z0-9\.-]/,o.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},o.getDomAttribute=function(t){if(t&&t.nodeName){var e=t.nodeName.toLowerCase();if("input"!==e||"image"===t.type)return o.domAttributes[e]}},o.encode=p,o.decode=decodeURIComponent,o.iso8859=function(){o.encode=escape,o.decode=unescape},o.unicode=function(){o.encode=p,o.decode=decodeURIComponent},o.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},o.encodeQuery=function(t,e){var r=o.encode(t+"");return void 0===e&&(e=o.escapeQuerySpace),e?r.replace(/%20/g,"+"):r},o.decodeQuery=function(t,e){t+="",void 0===e&&(e=o.escapeQuerySpace);try{return o.decode(e?t.replace(/\+/g,"%20"):t)}catch(r){return t}};var y,b={encode:"encode",decode:"decode"},E=function(t,e){return function(r){try{return o[e](r+"").replace(o.characters[t][e].expression,function(r){return o.characters[t][e].map[r]})}catch(n){return r}}};for(y in b)o[y+"PathSegment"]=E("pathname",b[y]),o[y+"UrnPathSegment"]=E("urnpath",b[y]);var N=function(t,e,r){return function(n){var i;i=r?function(t){return o[e](o[r](t))}:o[e];for(var a=(n+"").split(t),u=0,s=a.length;s>u;u++)a[u]=i(a[u]);return a.join(t)}};o.decodePath=N("/","decodePathSegment"),o.decodeUrnPath=N(":","decodeUrnPathSegment"),o.recodePath=N("/","encodePathSegment","decode"),o.recodeUrnPath=N(":","encodeUrnPathSegment","decode"),o.encodeReserved=E("reserved","encode"),o.parse=function(t,e){var r;return e||(e={}),r=t.indexOf("#"),r>-1&&(e.fragment=t.substring(r+1)||null,t=t.substring(0,r)),r=t.indexOf("?"),r>-1&&(e.query=t.substring(r+1)||null,t=t.substring(0,r)),"//"===t.substring(0,2)?(e.protocol=null,t=t.substring(2),t=o.parseAuthority(t,e)):(r=t.indexOf(":"),r>-1&&(e.protocol=t.substring(0,r)||null,e.protocol&&!e.protocol.match(o.protocol_expression)?e.protocol=void 0:"//"===t.substring(r+1,r+3)?(t=t.substring(r+3),t=o.parseAuthority(t,e)):(t=t.substring(r+1),e.urn=!0))),e.path=t,e},o.parseHost=function(t,e){t=t.replace(/\\/g,"/");var r,n,o=t.indexOf("/");if(-1===o&&(o=t.length),"["===t.charAt(0))r=t.indexOf("]"),e.hostname=t.substring(1,r)||null,e.port=t.substring(r+2,o)||null,
"/"===e.port&&(e.port=null);else{var i=t.indexOf(":"),a=t.indexOf("/"),u=t.indexOf(":",i+1);-1!==u&&(-1===a||a>u)?(e.hostname=t.substring(0,o)||null,e.port=null):(n=t.substring(0,o).split(":"),e.hostname=n[0]||null,e.port=n[1]||null)}return e.hostname&&"/"!==t.substring(o).charAt(0)&&(o++,t="/"+t),t.substring(o)||"/"},o.parseAuthority=function(t,e){return t=o.parseUserinfo(t,e),o.parseHost(t,e)},o.parseUserinfo=function(t,e){var r,n=t.indexOf("/"),i=t.lastIndexOf("@",n>-1?n:t.length-1);return i>-1&&(-1===n||n>i)?(r=t.substring(0,i).split(":"),e.username=r[0]?o.decode(r[0]):null,r.shift(),e.password=r[0]?o.decode(r.join(":")):null,t=t.substring(i+1)):(e.username=null,e.password=null),t},o.parseQuery=function(t,e){if(!t)return{};if(t=t.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,""),!t)return{};for(var r,n,i,a={},u=t.split("&"),s=u.length,c=0;s>c;c++)r=u[c].split("="),n=o.decodeQuery(r.shift(),e),i=r.length?o.decodeQuery(r.join("="),e):null,x.call(a,n)?(("string"==typeof a[n]||null===a[n])&&(a[n]=[a[n]]),a[n].push(i)):a[n]=i;return a},o.build=function(t){var e="";return t.protocol&&(e+=t.protocol+":"),t.urn||!e&&!t.hostname||(e+="//"),e+=o.buildAuthority(t)||"","string"==typeof t.path&&("/"!==t.path.charAt(0)&&"string"==typeof t.hostname&&(e+="/"),e+=t.path),"string"==typeof t.query&&t.query&&(e+="?"+t.query),"string"==typeof t.fragment&&t.fragment&&(e+="#"+t.fragment),e},o.buildHost=function(t){var e="";return t.hostname?(e+=o.ip6_expression.test(t.hostname)?"["+t.hostname+"]":t.hostname,t.port&&(e+=":"+t.port),e):""},o.buildAuthority=function(t){return o.buildUserinfo(t)+o.buildHost(t)},o.buildUserinfo=function(t){var e="";return t.username&&(e+=o.encode(t.username),t.password&&(e+=":"+o.encode(t.password)),e+="@"),e},o.buildQuery=function(t,e,r){var n,i,a,s,c="";for(i in t)if(x.call(t,i)&&i)if(u(t[i]))for(n={},a=0,s=t[i].length;s>a;a++)void 0!==t[i][a]&&void 0===n[t[i][a]+""]&&(c+="&"+o.buildQueryParameter(i,t[i][a],r),e!==!0&&(n[t[i][a]+""]=!0));else void 0!==t[i]&&(c+="&"+o.buildQueryParameter(i,t[i],r));return c.substring(1)},o.buildQueryParameter=function(t,e,r){return o.encodeQuery(t,r)+(null!==e?"="+o.encodeQuery(e,r):"")},o.addQuery=function(t,e,r){if("object"==typeof e)for(var n in e)x.call(e,n)&&o.addQuery(t,n,e[n]);else{if("string"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===t[e])return void(t[e]=r);"string"==typeof t[e]&&(t[e]=[t[e]]),u(r)||(r=[r]),t[e]=(t[e]||[]).concat(r)}},o.removeQuery=function(t,e,r){var n,i,c;if(u(e))for(n=0,i=e.length;i>n;n++)t[e[n]]=void 0;else if("RegExp"===a(e))for(c in t)e.test(c)&&(t[c]=void 0);else if("object"==typeof e)for(c in e)x.call(e,c)&&o.removeQuery(t,c,e[c]);else{if("string"!=typeof e)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==r?"RegExp"===a(r)?!u(t[e])&&r.test(t[e])?t[e]=void 0:t[e]=s(t[e],r):t[e]!==String(r)||u(r)&&1!==r.length?u(t[e])&&(t[e]=s(t[e],r)):t[e]=void 0:t[e]=void 0}},o.hasQuery=function(t,e,r,n){if("object"==typeof e){for(var i in e)if(x.call(e,i)&&!o.hasQuery(t,i,e[i]))return!1;return!0}if("string"!=typeof e)throw new TypeError("URI.hasQuery() accepts an object, string as the name parameter");switch(a(r)){case"Undefined":return e in t;case"Boolean":var s=Boolean(u(t[e])?t[e].length:t[e]);return r===s;case"Function":return!!r(t[e],e,t);case"Array":if(!u(t[e]))return!1;var f=n?c:l;return f(t[e],r);case"RegExp":return u(t[e])?n?c(t[e],r):!1:Boolean(t[e]&&t[e].match(r));case"Number":r=String(r);case"String":return u(t[e])?n?c(t[e],r):!1:t[e]===r;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},o.commonPath=function(t,e){var r,n=Math.min(t.length,e.length);for(r=0;n>r;r++)if(t.charAt(r)!==e.charAt(r)){r--;break}return 1>r?t.charAt(0)===e.charAt(0)&&"/"===t.charAt(0)?"/":"":(("/"!==t.charAt(r)||"/"!==e.charAt(r))&&(r=t.substring(0,r).lastIndexOf("/")),t.substring(0,r+1))},o.withinString=function(t,e,r){r||(r={});var n=r.start||o.findUri.start,i=r.end||o.findUri.end,a=r.trim||o.findUri.trim,u=/[a-z0-9-]=["']?$/i;for(n.lastIndex=0;;){var s=n.exec(t);if(!s)break;var c=s.index;if(r.ignoreHtml){var l=t.slice(Math.max(c-3,0),c);if(l&&u.test(l))continue}var f=c+t.slice(c).search(i),m=t.slice(c,f).replace(a,"");if(!r.ignore||!r.ignore.test(m)){f=c+m.length;var p=e(m,c,f,t);t=t.slice(0,c)+p+t.slice(f),n.lastIndex=c+p.length}}return n.lastIndex=0,t},o.ensureValidHostname=function(e){if(e.match(o.invalid_hostname_characters)){if(!t)throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-] and Punycode.js is not available');if(t.toASCII(e).match(o.invalid_hostname_characters))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]')}},o.noConflict=function(t){if(t){var e={URI:this.noConflict()};return n.URITemplate&&"function"==typeof n.URITemplate.noConflict&&(e.URITemplate=n.URITemplate.noConflict()),n.IPv6&&"function"==typeof n.IPv6.noConflict&&(e.IPv6=n.IPv6.noConflict()),n.SecondLevelDomains&&"function"==typeof n.SecondLevelDomains.noConflict&&(e.SecondLevelDomains=n.SecondLevelDomains.noConflict()),e}return n.URI===this&&(n.URI=g),this},v.build=function(t){return t===!0?this._deferred_build=!0:(void 0===t||this._deferred_build)&&(this._string=o.build(this._parts),this._deferred_build=!1),this},v.clone=function(){return new o(this)},v.valueOf=v.toString=function(){return this.build(!1)._string},v.protocol=h("protocol"),v.username=h("username"),v.password=h("password"),v.hostname=h("hostname"),v.port=h("port"),v.query=d("query","?"),v.fragment=d("fragment","#"),v.search=function(t,e){var r=this.query(t,e);return"string"==typeof r&&r.length?"?"+r:r},v.hash=function(t,e){var r=this.fragment(t,e);return"string"==typeof r&&r.length?"#"+r:r},v.pathname=function(t,e){if(void 0===t||t===!0){var r=this._parts.path||(this._parts.hostname?"/":"");return t?(this._parts.urn?o.decodeUrnPath:o.decodePath)(r):r}return this._parts.urn?this._parts.path=t?o.recodeUrnPath(t):"":this._parts.path=t?o.recodePath(t):"/",this.build(!e),this},v.path=v.pathname,v.href=function(t,e){var r;if(void 0===t)return this.toString();this._string="",this._parts=o._parts();var n=t instanceof o,i="object"==typeof t&&(t.hostname||t.path||t.pathname);if(t.nodeName){var a=o.getDomAttribute(t);t=t[a]||"",i=!1}if(!n&&i&&void 0!==t.pathname&&(t=t.toString()),"string"==typeof t||t instanceof String)this._parts=o.parse(String(t),this._parts);else{if(!n&&!i)throw new TypeError("invalid input");var u=n?t._parts:t;for(r in u)x.call(this._parts,r)&&(this._parts[r]=u[r])}return this.build(!e),this},v.is=function(t){var e=!1,n=!1,i=!1,a=!1,u=!1,s=!1,c=!1,l=!this._parts.urn;switch(this._parts.hostname&&(l=!1,n=o.ip4_expression.test(this._parts.hostname),i=o.ip6_expression.test(this._parts.hostname),e=n||i,a=!e,u=a&&r&&r.has(this._parts.hostname),s=a&&o.idn_expression.test(this._parts.hostname),c=a&&o.punycode_expression.test(this._parts.hostname)),t.toLowerCase()){case"relative":return l;case"absolute":return!l;case"domain":case"name":return a;case"sld":return u;case"ip":return e;case"ip4":case"ipv4":case"inet4":return n;case"ip6":case"ipv6":case"inet6":return i;case"idn":return s;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var S=v.protocol,w=v.port,A=v.hostname;v.protocol=function(t,e){if(void 0!==t&&t&&(t=t.replace(/:(\/\/)?$/,""),!t.match(o.protocol_expression)))throw new TypeError('Protocol "'+t+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return S.call(this,t,e)},v.scheme=v.protocol,v.port=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t&&(0===t&&(t=null),t&&(t+="",":"===t.charAt(0)&&(t=t.substring(1)),t.match(/[^0-9]/))))throw new TypeError('Port "'+t+'" contains characters other than [0-9]');return w.call(this,t,e)},v.hostname=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0!==t){var r={},n=o.parseHost(t,r);if("/"!==n)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');t=r.hostname}return A.call(this,t,e)},v.origin=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){var r=this.protocol(),n=this.authority();return n?(r?r+"://":"")+this.authority():""}var i=o(t);return this.protocol(i.protocol()).authority(i.authority()).build(!e),this},v.host=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?o.buildHost(this._parts):"";var r=o.parseHost(t,this._parts);if("/"!==r)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},v.authority=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t)return this._parts.hostname?o.buildAuthority(this._parts):"";var r=o.parseAuthority(t,this._parts);if("/"!==r)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-]');return this.build(!e),this},v.userinfo=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.username)return"";var r=o.buildUserinfo(this._parts);return r.substring(0,r.length-1)}return"@"!==t[t.length-1]&&(t+="@"),o.parseUserinfo(t,this._parts),this.build(!e),this},v.resource=function(t,e){var r;return void 0===t?this.path()+this.search()+this.hash():(r=o.parse(t),this._parts.path=r.path,this._parts.query=r.query,this._parts.fragment=r.fragment,this.build(!e),this)},v.subdomain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,r)||""}var n=this._parts.hostname.length-this.domain().length,a=this._parts.hostname.substring(0,n),u=new RegExp("^"+i(a));return t&&"."!==t.charAt(t.length-1)&&(t+="."),t&&o.ensureValidHostname(t),this._parts.hostname=this._parts.hostname.replace(u,t),this.build(!e),this},v.domain=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var r=this._parts.hostname.match(/\./g);if(r&&r.length<2)return this._parts.hostname;var n=this._parts.hostname.length-this.tld(e).length-1;return n=this._parts.hostname.lastIndexOf(".",n-1)+1,this._parts.hostname.substring(n)||""}if(!t)throw new TypeError("cannot set domain empty");if(o.ensureValidHostname(t),!this._parts.hostname||this.is("IP"))this._parts.hostname=t;else{var a=new RegExp(i(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(a,t)}return this.build(!e),this},v.tld=function(t,e){if(this._parts.urn)return void 0===t?"":this;if("boolean"==typeof t&&(e=t,t=void 0),void 0===t){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.lastIndexOf("."),o=this._parts.hostname.substring(n+1);return e!==!0&&r&&r.list[o.toLowerCase()]?r.get(this._parts.hostname)||o:o}var a;if(!t)throw new TypeError("cannot set TLD empty");if(t.match(/[^a-zA-Z0-9-]/)){if(!r||!r.is(t))throw new TypeError('TLD "'+t+'" contains characters other than [A-Z0-9]');a=new RegExp(i(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,t)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");a=new RegExp(i(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(a,t)}return this.build(!e),this},v.directory=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var r=this._parts.path.length-this.filename().length-1,n=this._parts.path.substring(0,r)||(this._parts.hostname?"/":"");return t?o.decodePath(n):n}var a=this._parts.path.length-this.filename().length,u=this._parts.path.substring(0,a),s=new RegExp("^"+i(u));return this.is("relative")||(t||(t="/"),"/"!==t.charAt(0)&&(t="/"+t)),t&&"/"!==t.charAt(t.length-1)&&(t+="/"),t=o.recodePath(t),this._parts.path=this._parts.path.replace(s,t),this.build(!e),this},v.filename=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r=this._parts.path.lastIndexOf("/"),n=this._parts.path.substring(r+1);return t?o.decodePathSegment(n):n}var a=!1;"/"===t.charAt(0)&&(t=t.substring(1)),t.match(/\.?\//)&&(a=!0);var u=new RegExp(i(this.filename())+"$");return t=o.recodePath(t),this._parts.path=this._parts.path.replace(u,t),a?this.normalizePath(e):this.build(!e),this},v.suffix=function(t,e){if(this._parts.urn)return void 0===t?"":this;if(void 0===t||t===!0){if(!this._parts.path||"/"===this._parts.path)return"";var r,n,a=this.filename(),u=a.lastIndexOf(".");return-1===u?"":(r=a.substring(u+1),n=/^[a-z0-9%]+$/i.test(r)?r:"",t?o.decodePathSegment(n):n)}"."===t.charAt(0)&&(t=t.substring(1));var s,c=this.suffix();if(c)s=t?new RegExp(i(c)+"$"):new RegExp(i("."+c)+"$");else{if(!t)return this;this._parts.path+="."+o.recodePath(t)}return s&&(t=o.recodePath(t),this._parts.path=this._parts.path.replace(s,t)),this.build(!e),this},v.segment=function(t,e,r){var n=this._parts.urn?":":"/",o=this.path(),i="/"===o.substring(0,1),a=o.split(n);if(void 0!==t&&"number"!=typeof t&&(r=e,e=t,t=void 0),void 0!==t&&"number"!=typeof t)throw new Error('Bad segment "'+t+'", must be 0-based integer');if(i&&a.shift(),0>t&&(t=Math.max(a.length+t,0)),void 0===e)return void 0===t?a:a[t];if(null===t||void 0===a[t])if(u(e)){a=[];for(var s=0,c=e.length;c>s;s++)(e[s].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(f(e[s])))}else(e||"string"==typeof e)&&(e=f(e),""===a[a.length-1]?a[a.length-1]=e:a.push(e));else e?a[t]=f(e):a.splice(t,1);return i&&a.unshift(""),this.path(a.join(n),r)},v.segmentCoded=function(t,e,r){var n,i,a;if("number"!=typeof t&&(r=e,e=t,t=void 0),void 0===e){if(n=this.segment(t,e,r),u(n))for(i=0,a=n.length;a>i;i++)n[i]=o.decode(n[i]);else n=void 0!==n?o.decode(n):void 0;return n}if(u(e))for(i=0,a=e.length;a>i;i++)e[i]=o.encode(e[i]);else e="string"==typeof e||e instanceof String?o.encode(e):e;return this.segment(t,e,r)};var T=v.query;return v.query=function(t,e){if(t===!0)return o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof t){var r=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace),n=t.call(this,r);return this._parts.query=o.buildQuery(n||r,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this}return void 0!==t&&"string"!=typeof t?(this._parts.query=o.buildQuery(t,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!e),this):T.call(this,t,e)},v.setQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof t||t instanceof String)n[t]=void 0!==e?e:null;else{if("object"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var i in t)x.call(t,i)&&(n[i]=t[i])}return this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},v.addQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.addQuery(n,t,void 0===e?null:e),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},v.removeQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.removeQuery(n,t,e),this._parts.query=o.buildQuery(n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof t&&(r=e),this.build(!r),this},v.hasQuery=function(t,e,r){var n=o.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return o.hasQuery(n,t,e,r)},v.setSearch=v.setQuery,v.addSearch=v.addQuery,v.removeSearch=v.removeQuery,v.hasSearch=v.hasQuery,v.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},v.normalizeProtocol=function(t){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!t)),this},v.normalizeHostname=function(r){return this._parts.hostname&&(this.is("IDN")&&t?this._parts.hostname=t.toASCII(this._parts.hostname):this.is("IPv6")&&e&&(this._parts.hostname=e.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!r)),this},v.normalizePort=function(t){return"string"==typeof this._parts.protocol&&this._parts.port===o.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!t)),this},v.normalizePath=function(t){var e=this._parts.path;if(!e)return this;if(this._parts.urn)return this._parts.path=o.recodeUrnPath(this._parts.path),this.build(!t),this;if("/"===this._parts.path)return this;e=o.recodePath(e);var r,n,i,a="";for("/"!==e.charAt(0)&&(r=!0,e="/"+e),("/.."===e.slice(-3)||"/."===e.slice(-2))&&(e+="/"),e=e.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),r&&(a=e.substring(1).match(/^(\.\.\/)+/)||"",a&&(a=a[0]));;){if(n=e.search(/\/\.\.(\/|$)/),-1===n)break;0!==n?(i=e.substring(0,n).lastIndexOf("/"),-1===i&&(i=n),e=e.substring(0,i)+e.substring(n+3)):e=e.substring(3)}return r&&this.is("relative")&&(e=a+e.substring(1)),this._parts.path=e,this.build(!t),this},v.normalizePathname=v.normalizePath,v.normalizeQuery=function(t){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(o.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!t)),this},v.normalizeFragment=function(t){return this._parts.fragment||(this._parts.fragment=null,this.build(!t)),this},v.normalizeSearch=v.normalizeQuery,v.normalizeHash=v.normalizeFragment,v.absoluteTo=function(t){var e,r,n,i=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(t instanceof o||(t=new o(t)),i._parts.protocol||(i._parts.protocol=t._parts.protocol),this._parts.hostname)return i;for(r=0;n=a[r];r++)i._parts[n]=t._parts[n];return i._parts.path?".."===i._parts.path.substring(-2)&&(i._parts.path+="/"):(i._parts.path=t._parts.path,i._parts.query||(i._parts.query=t._parts.query)),"/"!==i.path().charAt(0)&&(e=t.directory(),e=e?e:0===t.path().indexOf("/")?"/":"",i._parts.path=(e?e+"/":"")+i._parts.path,i.normalizePath()),i.build(),i},o});var ConvertJson=function(){"use strict";function t(t,e,r,n,o){var i=Atomic.string.fromString(e);if(t&&t.containsKey(i)){var a=t.get(i);if("function"==r)throw XError("Option "+i+" must be a function","XPTY0004");if(1==a.length&&Atomic[r].matches(a[0])){if(o&&o.indexOf(a[0].value)<0)throw XError("Invalid value "+i+"="+a[0],"FOJS0005");return a[0].value}throw XError("Invalid option: "+e+": must be "+r,"XPTY0004")}return n}function e(t,e,r){function n(t){throw XError(t,"FOJS0001")}function o(){return h=i()}function i(){var e,r;for(h="";;){if(p>=t.length)return["eof"];if(r=t.charAt(p++),!/[ \n\r\t]/.test(r))break}switch(r){case"[":case"{":case"]":case"}":case":":case",":return[r];case'"':for(var o=!1;;){if(e=t.charAt(p++),'"'==e&&!o)return["string",h];h+=e,o="\\"==e&&!o,p>=t.length&&n("Unclosed quotes in string literal")}return["string",h];case"-":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(h+=r;p<t.length;){if(e=t.charAt(p++),!/[0-9\-+\.eE]/.test(e)){p--;break}h+=e}return["number",a(h)];case"t":case"f":case"n":for(h+=r;;){if(e=t.charAt(p),!(e>="a"&&"z">=e))break;if(h+=e,++p>=t.length)break}if(/^(true|false|null)$/.test(h))return[h];n("Unknown constant "+h);break;default:return n("Unexpected character '"+r+"' ("+Expr.stringToCodepoints(r)+") at position "+p),-1}}function a(t){return/^-?(0|[1-9][0-9]*)(\.[0-9]+)?([eE][+-]?[0-9]+)?$/.test(t)?t:n("Invalid JSON number "+t)}function u(t){h[0]!==t&&n("Expected "+t+", found "+h[0])}function s(t){return h[0]===t?(o(),!0):!1}function c(t){return h[0]===t?(o(),!0):","===h[0]?(o(),!1):void n("Expected ',' or '"+t+"', found '"+h[0]+"'")}function l(){switch(h[0]){case"[":o(),f();break;case"{":o(),m();break;case"string":r.emitString(h[1]),o();break;case"number":r.emitNumber(h[1]),o();break;case"true":case"false":r.emitBoolean(h[0]),o();break;case"null":r.emitNull(),o();break;default:n("Unexpected token "+h[0])}}function f(){if(r.startArray(),!s("]"))do l();while(!c("]"));r.endArray()}function m(){if(r.startMap(),!s("}"))do u("string"),r.emitKey(h[1]),o(),u(":"),o(),l();while(!c("}"));r.endMap()}var p=0,h=o();return l(),u("eof"),r.result()}function r(t){try{return JSON.parse('"'+t+'"')}catch(e){throw XError(e.toString(),"FOJS0001")}}function n(t){return t.replace(s,"").replace(/[\uD800-\uDFFF]+/g,function(t){for(var e="",r=0;r<t.length;r++){var n=t.charAt(r);e+=r%2=="">n||r==t.length-1&&"">n?"":n}return e})}function o(e){this._valStack=[],this._keyStack=[],t(e,"liberal","boolean",!1),this._escape=t(e,"escape","boolean",!1),this._duplicates=t(e,"duplicates","string","use-first",["reject","use-first","use-last"])}function i(e,r){this._valStack=[],this._keyStack=[],this._mapStack=[],this._context=r,t(e,"liberal","boolean",!1),t(e,"validate","boolean",!1),t(e,"fallback","function"),this._escape=t(e,"escape","boolean",!1),this._duplicates=t(e,"duplicates","string","use-first",["reject","use-first","retain"])}function a(e,r){function n(t){throw new XError("Invalid input to xml-to-json(): "+t,"FOJS0006")}function o(t){0!=l.getChildElements(t).length&&n("node "+t.tagName+" must have no element children")}function i(t){Axis.child(t).filter(function(e){return e.nodeType==l.TEXT_NODE&&t.nodeValue&&""!=Regex.trim(t.nodeValue)}).next()&&n("node "+t.tagName+" must have no text content")}function a(t){try{return Atomic["boolean"].fromString(t).toBoolean()}catch(e){n("invalid boolean: '"+t+"'")}}function s(t){try{JSON.parse('"'+t+'"')}catch(e){throw XError("invalid escape sequence: "+e.toString(),"FOJS0007")}}function c(t){if(t.nodeType==l.DOCUMENT_NODE||t.nodeType==l.DOCUMENT_FRAGMENT_NODE){var e=l.getChildElements(t);return 1!=e.length&&n("document node has "+e.length+" element children"),c(e[0])}if(t.nodeType==l.ELEMENT_NODE){var r=!1;if(t.namespaceURI==u)switch(Axis.attribute(t).forEachItem(function(e){if(e.name.indexOf(":")<0||e.namespaceURI==u)if("key"==e.name||"escaped-key"==e.name){if(l.xdmParentNode(t)&&"map"==l.xdmParentNode(t).localName||n("@key/@escaped-key are allowed only on children of map"),"escaped-key"==e.name){var o=a(e.value);o&&s(t.getAttribute("key"))}}else(e.name="escaped")?("string"!=t.localName&&n("@escaped is allowed only on string"),r=a(e.value)):n("invalid attribute "+e.name)}),!t.hasAttribute("key")&&!t.hasAttribute("escaped-key")||l.xdmParentNode&&"map"!=l.xdmParentNode.localName||n("key/escaped-key are allowed only on children of map"),t.localName){case"null":return Axis.child(t).filter(function(t){return t.nodeType!=l.COMMENT_NODE&&t.nodeType!=l.PROCESSING_INSTRUCTION_NODE}).next()&&n("null element must have no content"),"null";case"string":o(t);var f=t.textContent;return print("str/escaped: "+r),r?(f=f.replace(/\\(["\\/bfnrt]|u[0-9a-fA-f]{4})/g),s(f),f=f.replace(/^"/g,'\\"').replace(/^\b/g,"\\\b").replace(/^\f/g,"\\\f").replace(/^\n/g,"\\\n").replace(/^\r/g,"\\\r").replace(/^\t/g,"\\	").replace(/([^\\])"/g,'$1\\"').replace(/([^\\])\b/g,"$1\\\b").replace(/([^\\])\f/g,"$1\\\f").replace(/([^\\])\n/g,"$1\\\n").replace(/([^\\])\r/g,"$1\\\r").replace(/([^\\])\t/g,"$1\\	").replace(/[\u0001-\u001F\u007F-\u009F]/g,function(t){return"\\u"+t.charCodeAt(0).toString(16).toUpperCase()}),'"'+f+'"'):JSON.stringify(f);case"number":o(t);try{var m=Atomic["double"].fromString(t.textContent)}catch(p){n("invalid number")}return isFinite(m.toNumber())||n("NaN and INF not allowed"),m.toString();case"boolean":return o(t),a(t.textContent),Atomic["boolean"].fromString(t.textContent).toString();case"array":i(t);var h="[",d="";return l.getChildElements(t).forEach(function(t){h+=d+c(t),d=","}),h+"]";case"map":i(t);var g="{",v="",x={};return l.getChildElements(t).forEach(function(t){t.hasAttribute("key")||n("child element of map must have a key");var e=t.getAttribute("key");x[e]&&n("duplicate key '"+e+"'"),x[e]=!0,g+=v+'"'+e+'":'+c(t),v=","}),g+"}";default:n("unknown local name "+t.localName)}else n("wrong namespace "+t.namespaceURI)}else l.isNode(t)||(print("Not a node "+showValue(t)),n("not a node")),Error.dumpStack(),n("wrong node kind "+t.nodeType)}var l=DomUtils;return t(r,"indent","boolean",!1),c(e)}var u="http://www.w3.org/2005/xpath-functions",s=/[\x00-\x08\x0B\x0C\x0E-\x0F\x80-\x9F]/;return o.prototype={_valStack:[],_keyStack:[],_optionsMap:{},_escape:!1,_duplicates:"use-first",reEscape:function(t){return this._escape?JSON.stringify(t).replace(/^\"|\"$/g,"").replace(/\\"/g,'"').replace(/[\uD800-\uDFFF]/g,function(t){return"\\u"+t.charCodeAt(0).toString(16).toUpperCase()}):n(t)},peek:function(){return this._valStack[this._valStack.length-1]},writeItem:function(t){if(0==this._valStack.length)this._valStack.push(t);else if(this.peek()instanceof Expr.XdmArray)this.peek().value.push(t);else{var e=this.peek(),r=Atomic.string.fromString(this._keyStack.pop());if(e.containsKey(r))switch(this._duplicates){case"reject":throw XError("json-to-xml: duplicate key '"+r.toString()+"'","FOJS0003");case"use-first":return}e.inSituPut(r,t)}},emitNull:function(){this.writeItem([])},emitBoolean:function(t){this.writeItem([Atomic["boolean"].fromString(t)])},emitNumber:function(t){this.writeItem([Atomic["double"].fromNumber(parseFloat(t))])},emitString:function(t){this.writeItem([Atomic.string.fromString(this.reEscape(r(t)))])},emitKey:function(t){this._keyStack.push(this.reEscape(r(t)))},startArray:function(){this._valStack.push(new Expr.XdmArray([]))},endArray:function(){this.writeItem([this._valStack.pop()])},startMap:function(){this._valStack.push(new HashTrie)},endMap:function(){this.writeItem([this._valStack.pop()])},result:function(){return this.peek()[0]}},i.prototype={_valStack:[],_keyStack:[{}],_mapStack:[],_context:null,_optionsMap:{},_escape:!1,_duplicates:"use-first",reEscape:function(t){return print("reEscape "+t+" escaping "+this._escape),this._escape?JSON.stringify(t).replace(/^\"|\"$/g,"").replace(/\\"/g,'"').replace(/[\uD800-\uDFFF]/g,function(t){return"\\u"+t.charCodeAt(0).toString(16).toUpperCase()}):n(t)},peek:function(){return this._valStack[this._valStack.length-1]},writeItem:function(t){if(0==this._valStack.length)t.setAttributeNS("","xmlns",u),this._valStack.push(t);else{var e=this.peek();if("map"==e.tagName){var r=this._keyStack.pop(),n=this._mapStack[this._mapStack.length-1];if(r in n)switch(this._duplicates){case"reject":throw XError("parse-json: duplicate key '"+r.toString()+"'","FOJS0003");case"use-first":return}n[r]=t,t.setAttribute("key",r),this._escape&&t.setAttribute("escaped-key","true")}e.appendChild(t)}},emitNull:function(){var t=this._context.resultDocument.createElementNS(u,"null");this.writeItem(t)},emitBoolean:function(t){var e=this._context.resultDocument.createElementNS(u,"boolean"),r=this._context.resultDocument.createTextNode(t.toString());e.appendChild(r),this.writeItem(e)},emitNumber:function(t){var e=this._context.resultDocument.createElementNS(u,"number"),r=this._context.resultDocument.createTextNode(t.toString());e.appendChild(r),this.writeItem(e)},emitString:function(t){var e=this._context.resultDocument.createElementNS(u,"string"),n=this._context.resultDocument.createTextNode(this.reEscape(r(t)));this._escape&&e.setAttribute("escaped","true"),e.appendChild(n),this.writeItem(e)},emitKey:function(t){this._keyStack.push(this.reEscape(r(t)))},startArray:function(){var t=this._context.resultDocument.createElementNS(u,"array");this._valStack.push(t)},endArray:function(){this.writeItem(this._valStack.pop())},startMap:function(){var t=this._context.resultDocument.createElementNS(u,"map");this._valStack.push(t),this._mapStack.push({})},endMap:function(){this._mapStack.pop(),this.writeItem(this._valStack.pop())},result:function(){return this.peek()}},{parseToMap:function(t,r){return e(t,r,new o(r))},parseToXml:function(t,r,n){return e(t,r,new i(r,n))},xmlToJson:a}}(),inBrowser="undefined"!=typeof window;inBrowser&&(console.log("in browser"),setPlatform(BrowserPlatform.platform));var spaceStripper=null,timeStamp=platform.inBrowser&&window.performance&&window.performance.now?window.performance.now:function(){return Date.now().valueOf()};Context.prototype={depth:0,focus:null,resultDocument:null,tempOutputState:!1,fixed:{},localParams:{},tunnelParams:{},currentTemplate:null,currentMode:null,currentError:null,currentEvent:null,localVars:[],toString:function(){var t="{";for(var e in this.localParams)this.localParams.hasOwnProperty(e)&&(t+=e+":("+this.localParams[e]+"),");return t+="}","context: "+this.focus.current+" localParams: "+t},newContext:function(t){var e=this,r=new Context;return r.depth=e.depth+1,r.focus=e.focus,r.resultDocument=e.resultDocument,r.currentMode=e.currentMode,r.currentTemplate=e.currentTemplate,r.currentError=e.currentError,r.fixed=e.fixed,r.tempOutputState=e.tempOutputState,r.currentEvent=e.currentEvent,t?(r.localParams={},r.tunnelParams={},r.localVars=[]):(r.localParams=e.localParams,r.tunnelParams=e.tunnelParams,r.localVars=e.localVars),r},createElement:function(t,e){return""!=t&&"http://www.w3.org/1999/xhtml"!=t||!platform.inBrowser||this.resultDocument!==window.document?this.resultDocument.createElementNS(t,e):this.resultDocument.createElement(e)}};var XPath=function(){function load(){var content=SaxonJS.getPlatform().readResource("lib/xpath/XPathJS.js");content+="XPath;",SaxonJS.XPath=eval(content)}return{parse:function(t,e,r){return load(),SaxonJS.XPath.parse(t,e,r)},evaluate:function(t,e,r){return load(),SaxonJS.XPath.parse(t,e,r)}}}();return{transform:transform,getProcessorInfo:getProcessorInfo,setPlatform:setPlatform,getPlatform:function(){return platform},timeStamp:timeStamp,DomUtils:DomUtils,Iter:Iter,XError:XError,HashTrie:HashTrie,getSpaceStripper:function(){return spaceStripper},U:{Atomic:Atomic,Axis:Axis,Context:Context,nameOfNode:DomUtils.nameOfNode,isNode:DomUtils.isNode,isAttr:function(t){return t instanceof Attr},isNamespaceNode:function(t){return t instanceof NamespaceNode},isMap:function(t){return t instanceof HashTrie},isArray:function(t){return t instanceof Expr.XdmArray},ForArray:Iter.ForArray,evaluate:Expr.evaluate},XPath:XPath}}();if("function"==typeof require){var DOMImplementation=require("xmldom").DOMImplementation,Node=require("xmldom").Node,Document=require("xmldom").Document,DocumentFragment=require("xmldom").DocumentFragment;module.exports=SaxonJS}